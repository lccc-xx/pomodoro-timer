<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- iPhoneå…¨å±å…³é”®è®¾ç½® -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <title>ç•ªèŒ„é’Ÿ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; overflow: hidden; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            flex-direction: column;
            padding: 20px;
            -webkit-tap-highlight-color: transparent;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            height: 100%;
            gap: 20px;
        }
        
        .pomodoro-section, .interrupt-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            flex: 1;
        }
        
        h2 {
            margin-bottom: 15px;
            font-size: 1.2rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 8px;
        }
        
        .timer-display {
            font-size: 4rem;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            font-variant-numeric: tabular-nums;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            max-width: 120px;
        }
        
        button:hover { background: rgba(255, 255, 255, 0.3); }
        button:active { transform: scale(0.95); }
        
        .time-settings {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .time-setting {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .time-setting label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .time-setting input {
            width: 80px;
            padding: 8px;
            border: none;
            border-radius: 10px;
            text-align: center;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1rem;
        }
        
        .interrupt-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        #interruptDuration {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1rem;
        }
        
        #interruptReason {
            flex: 2;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1rem;
        }
        
        .interrupt-history {
            margin-top: 20px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .history-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        @media (min-width: 768px) {
            .container { flex-direction: row; }
            .pomodoro-section, .interrupt-section { flex: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ç•ªèŒ„é’Ÿä¸»åŒºåŸŸ -->
        <div class="pomodoro-section">
            <h2>ğŸ… ç•ªèŒ„é’Ÿ</h2>
            <div class="timer-display" id="timer">25:00</div>
            <div class="controls">
                <button id="startBtn">å¼€å§‹</button>
                <button id="pauseBtn">æš‚åœ</button>
                <button id="resetBtn">é‡ç½®</button>
            </div>
            <div class="time-settings">
                <div class="time-setting">
                    <label>ä¸“æ³¨æ—¶é—´ï¼ˆåˆ†ï¼‰</label>
                    <input type="number" id="focusTime" value="25" min="1" max="120">
                </div>
                <div class="time-setting">
                    <label>ä¼‘æ¯æ—¶é—´ï¼ˆåˆ†ï¼‰</label>
                    <input type="number" id="breakTime" value="5" min="1" max="60">
                </div>
            </div>
        </div>
        
        <!-- ä¸­æ–­åŠŸèƒ½åŒºåŸŸ -->
        <div class="interrupt-section">
            <h2>â¸ï¸ ä¸´æ—¶ä¸­æ–­</h2>
            <div class="interrupt-controls">
                <input type="number" id="interruptDuration" placeholder="åˆ†é’Ÿ" min="1" max="60">
                <input type="text" id="interruptReason" placeholder="ä¸­æ–­åŸå› ">
                <button id="startInterruptBtn">å¼€å§‹ä¸­æ–­</button>
            </div>
            <div class="interrupt-history">
                <h3>ä¸­æ–­è®°å½•</h3>
                <div id="historyList"></div>
            </div>
        </div>
    </div>

    <script>
        // ç•ªèŒ„é’Ÿé€»è¾‘
        let pomodoroTimer = null;
        let pomodoroSeconds = 25 * 60;
        let isPomodoroRunning = false;
        let isFocusTime = true;
        
        // ä¸­æ–­è®¡æ—¶å™¨
        let interruptTimer = null;
        let interruptSeconds = 0;
        let isInterruptRunning = false;
        
        // å…ƒç´ å¼•ç”¨
        const timerDisplay = document.getElementById('timer');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const focusTimeInput = document.getElementById('focusTime');
        const breakTimeInput = document.getElementById('breakTime');
        const interruptDurationInput = document.getElementById('interruptDuration');
        const interruptReasonInput = document.getElementById('interruptReason');
        const startInterruptBtn = document.getElementById('startInterruptBtn');
        const historyList = document.getElementById('historyList');
        
        // åˆå§‹åŒ–
        loadSettings();
        updateTimerDisplay();
        loadHistory();
        
        // ç•ªèŒ„é’ŸåŠŸèƒ½
        function startPomodoro() {
            if (isPomodoroRunning) return;
            isPomodoroRunning = true;
            pomodoroTimer = setInterval(updatePomodoro, 1000);
            startBtn.textContent = 'è¿è¡Œä¸­';
        }
        
        function pausePomodoro() {
            if (!isPomodoroRunning) return;
            clearInterval(pomodoroTimer);
            isPomodoroRunning = false;
            startBtn.textContent = 'ç»§ç»­';
        }
        
        function resetPomodoro() {
            clearInterval(pomodoroTimer);
            isPomodoroRunning = false;
            isFocusTime = true;
            pomodoroSeconds = parseInt(focusTimeInput.value) * 60;
            updateTimerDisplay();
            startBtn.textContent = 'å¼€å§‹';
        }
        
        function updatePomodoro() {
            if (pomodoroSeconds <= 0) {
                clearInterval(pomodoroTimer);
                isPomodoroRunning = false;
                
                if (isFocusTime) {
                    // ä¸“æ³¨æ—¶é—´ç»“æŸï¼Œå¼€å§‹ä¼‘æ¯
                    isFocusTime = false;
                    pomodoroSeconds = parseInt(breakTimeInput.value) * 60;
                    playNotification('ä¸“æ³¨æ—¶é—´ç»“æŸï¼å¼€å§‹ä¼‘æ¯ã€‚');
                } else {
                    // ä¼‘æ¯æ—¶é—´ç»“æŸï¼Œå¼€å§‹æ–°çš„ç•ªèŒ„é’Ÿ
                    isFocusTime = true;
                    pomodoroSeconds = parseInt(focusTimeInput.value) * 60;
                    playNotification('ä¼‘æ¯æ—¶é—´ç»“æŸï¼å¼€å§‹æ–°çš„ç•ªèŒ„é’Ÿã€‚');
                }
                
                startPomodoro();
            } else {
                pomodoroSeconds--;
            }
            
            updateTimerDisplay();
            saveSettings();
        }
        
        function updateTimerDisplay() {
            const minutes = Math.floor(pomodoroSeconds / 60);
            const seconds = pomodoroSeconds % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // æ›´æ–°æ ‡é¢˜æ˜¾ç¤ºå‰©ä½™æ—¶é—´
            document.title = `${minutes}:${seconds.toString().padStart(2, '0')} - ç•ªèŒ„é’Ÿ`;
        }
        
        // ä¸­æ–­åŠŸèƒ½
        function startInterrupt() {
            if (isInterruptRunning) return;
            
            const duration = parseInt(interruptDurationInput.value);
            const reason = interruptReasonInput.value.trim();
            
            if (!duration || duration < 1) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ä¸­æ–­æ—¶é—´');
                return;
            }
            
            if (!reason) {
                alert('è¯·è¾“å…¥ä¸­æ–­åŸå› ');
                return;
            }
            
            // æš‚åœç•ªèŒ„é’Ÿ
            if (isPomodoroRunning) {
                pausePomodoro();
            }
            
            // å¼€å§‹ä¸­æ–­è®¡æ—¶
            interruptSeconds = duration * 60;
            isInterruptRunning = true;
            
            // è®°å½•ä¸­æ–­
            const interruptRecord = {
                time: new Date().toLocaleTimeString(),
                duration: duration,
                reason: reason,
                remainingPomodoro: pomodoroSeconds
            };
            
            addToHistory(interruptRecord);
            saveHistory();
            
            interruptTimer = setInterval(() => {
                if (interruptSeconds <= 0) {
                    clearInterval(interruptTimer);
                    isInterruptRunning = false;
                    playNotification(`ä¸­æ–­æ—¶é—´åˆ°ï¼${reason}`);
                    
                    // è‡ªåŠ¨æ¢å¤ç•ªèŒ„é’Ÿ
                    startPomodoro();
                } else {
                    interruptSeconds--;
                }
            }, 1000);
            
            // æ¸…ç©ºè¾“å…¥
            interruptDurationInput.value = '';
            interruptReasonInput.value = '';
        }
        
        function playNotification(message) {
            // å°è¯•æ’­æ”¾å£°éŸ³
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==');
                audio.play();
            } catch (e) {}
            
            // æ˜¾ç¤ºæµè§ˆå™¨é€šçŸ¥
            if ("Notification" in window && Notification.permission === "granted") {
                new Notification("ç•ªèŒ„é’Ÿæé†’", { body: message });
            }
            
            alert(message);
        }
        
        // å†å²è®°å½•åŠŸèƒ½
        function addToHistory(record) {
            const item = document.createElement('div');
            item.className = 'history-item';
            item.innerHTML = `
                <strong>${record.time}</strong><br>
                ä¸­æ–­: ${record.duration}åˆ†é’Ÿ - ${record.reason}<br>
                å‰©ä½™ç•ªèŒ„é’Ÿ: ${Math.floor(record.remainingPomodoro / 60)}:${(record.remainingPomodoro % 60).toString().padStart(2, '0')}
            `;
            historyList.prepend(item);
        }
        
        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('pomodoroInterruptHistory') || '[]');
            history.forEach(record => addToHistory(record));
        }
        
        function saveHistory() {
            const items = Array.from(historyList.children).slice(0, 10).map(item => {
                const text = item.textContent;
                const parts = text.split('\n');
                return {
                    time: parts[0].trim(),
                    duration: parseInt(parts[1].match(/\d+/)[0]),
                    reason: parts[1].split('-')[1]?.trim() || '',
                    remainingPomodoro: 0
                };
            });
            localStorage.setItem('pomodoroInterruptHistory', JSON.stringify(items));
        }
        
        // è®¾ç½®ä¿å­˜
        function saveSettings() {
            const settings = {
                focusTime: focusTimeInput.value,
                breakTime: breakTimeInput.value,
                pomodoroSeconds: pomodoroSeconds,
                isFocusTime: isFocusTime,
                isPomodoroRunning: isPomodoroRunning
            };
            localStorage.setItem('pomodoroSettings', JSON.stringify(settings));
        }
        
        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('pomodoroSettings') || '{}');
            if (settings.focusTime) focusTimeInput.value = settings.focusTime;
            if (settings.breakTime) breakTimeInput.value = settings.breakTime;
            if (settings.pomodoroSeconds) pomodoroSeconds = settings.pomodoroSeconds;
            if (settings.isFocusTime !== undefined) isFocusTime = settings.isFocusTime;
            if (settings.isPomodoroRunning) startPomodoro();
        }
        
        // äº‹ä»¶ç›‘å¬
        startBtn.addEventListener('click', startPomodoro);
        pauseBtn.addEventListener('click', pausePomodoro);
        resetBtn.addEventListener('click', resetPomodoro);
        startInterruptBtn.addEventListener('click', startInterrupt);
        
        focusTimeInput.addEventListener('change', () => {
            if (!isPomodoroRunning && isFocusTime) {
                pomodoroSeconds = parseInt(focusTimeInput.value) * 60;
                updateTimerDisplay();
            }
            saveSettings();
        });
        
        breakTimeInput.addEventListener('change', () => {
            if (!isPomodoroRunning && !isFocusTime) {
                pomodoroSeconds = parseInt(breakTimeInput.value) * 60;
                updateTimerDisplay();
            }
            saveSettings();
        });
        
        // è¯·æ±‚é€šçŸ¥æƒé™
        if ("Notification" in window && Notification.permission === "default") {
            Notification.requestPermission();
        }
        
        // é¡µé¢å…³é—­å‰ä¿å­˜
        window.addEventListener('beforeunload', saveSettings);
    </script>
</body>
</html>
