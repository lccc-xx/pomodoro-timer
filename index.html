<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>ç•ªèŒ„æ—¶é’Ÿ Pomodoro Timer v6.2.0</title>
    <style>
        /* å…¨å±€é‡ç½®å’ŒåŸºç¡€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
        }
        /* === æ–°å¢ï¼šä»»åŠ¡ç®¡ç†æ ·å¼ === */
        .task-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .task-header h2 {
            color: #2c3e50;
            font-size: 1.4em;
        }

        .task-item {
            padding: 10px 12px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.2s;
            cursor: move; /* è¡¨ç¤ºå¯æ‹–åŠ¨æ’åº */
        }

        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .task-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
            background: #f1f1f1;
        }

        .task-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .task-name {
            font-weight: 500;
            margin-bottom: 3px;
        }

        .task-meta {
            font-size: 0.8em;
            color: #666;
        }

        .task-actions {
            display: flex;
            gap: 8px;
        }

        .task-action-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            font-size: 0.8em;
            cursor: pointer;
        }

        .task-action-btn.start {
            background: #4CAF50;
            color: white;
        }

        .task-action-btn.delete {
            background: #f44336;
            color: white;
        }

        .task-action-btn.complete {
            background: #2196F3;
            color: white;
        }

        .empty-quadrant {
            text-align: center;
            padding: 20px;
            color: #999;
            font-style: italic;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            padding: 25px;
            position: relative;
            overflow: hidden;
        }
        
        /* å…¼å®¹æ€§è­¦å‘Š */
        .compatibility-warning {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 10px;
            font-size: 14px;
        }
        
        .compatibility-warning.hidden {
            display: none;
        }
        
        .compatibility-warning.warning {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
        }
        
        .compatibility-warning.success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        /* æ ‡é¢˜åŒºåŸŸ */
        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1em;
            margin-bottom: 20px;
        }
        
        /* ç•ªèŒ„é’Ÿä¸»åŒºåŸŸ */
        .main-controls {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .timer-display {
            font-size: 5em;
            font-weight: 700;
            color: white;
            text-align: center;
            margin-bottom: 20px;
            font-variant-numeric: tabular-nums;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.2);
        }
        
        .timer-display span {
            display: inline-block;
            min-width: 2.2ch;
        }
        
        .time-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .time-input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .time-input-group label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9em;
            font-weight: 500;
        }
        
        .time-input {
            width: 80px;
            padding: 12px 15px;
            border: none;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 1.2em;
            font-weight: 600;
            text-align: center;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .time-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.3);
        }
        
        .time-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        /* æŒ‰é’®æ ·å¼ */
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-width: 120px;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
        }
        
        .btn-secondary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
        }
        
        .btn-warning:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            color: white;
        }
        
        .btn-danger:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #00bcd4 0%, #0097a7 100%);
            color: white;
        }
        
        .btn-info:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 188, 212, 0.4);
        }
        
        /* çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .status-indicators {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .pomodoro-status {
            color: white;
            font-size: 1.1em;
            font-weight: 500;
        }
        
        .device-status {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9em;
        }
        
        /* çŠ¶æ€æ  */
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 10px 20px;
            font-size: 0.9em;
            z-index: 1000;
            display: none;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .status-bar.show {
            display: block;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }
        
        /* ä¸­æ–­è®¡æ—¶å™¨ */
        .interrupt-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }
        
        .interrupt-section h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        
        .interrupt-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .interrupt-input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .interrupt-input-group label {
            color: #666;
            font-size: 0.9em;
            font-weight: 500;
        }
        
        .interrupt-input {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        
        .interrupt-input:focus {
            outline: none;
            border-color: #2196F3;
        }
        
        .interrupt-timer-display {
            text-align: center;
            font-size: 2.5em;
            font-weight: bold;
            color: #f44336;
            margin: 20px 0;
            opacity: 0;
            transition: opacity 0.3s;
            font-variant-numeric: tabular-nums;
        }
        
        .interrupt-timer-display.show {
            opacity: 1;
        }
        
        .quick-test-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .quick-test-btn {
            padding: 8px 16px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .quick-test-btn:hover {
            background: #e0e0e0;
            transform: translateY(-1px);
        }
        
        /* é¢„è®¾æ—¶é—´ */
        .preset-times {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .preset-time {
            padding: 8px 20px;
            background: #f0f7ff;
            border: 2px solid #2196F3;
            border-radius: 8px;
            color: #2196F3;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .preset-time.active,
        .preset-time:hover {
            background: #2196F3;
            color: white;
        }
        
        /* è®°å½•åŒºåŸŸ */
        .records-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }
        
        .records-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .records-header h2 {
            color: #2c3e50;
            font-size: 1.4em;
        }
        
        .records-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #2196F3;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        
        .record-list {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .record-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .record-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .record-list::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }
        
        .record-item {
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s;
        }
        
        .record-item:hover {
            background: #e9ecef;
        }
        
        .record-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .record-time {
            color: #666;
            font-size: 0.9em;
        }
        
        .record-duration {
            color: #333;
            font-weight: 500;
        }
        
        .record-type {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }
        
        .record-type.focus {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .record-type.break {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        
        .no-records {
            text-align: center;
            padding: 40px 20px;
            color: #999;
            font-style: italic;
        }
        
        /* è®¾ç½®é¢æ¿ */
        .settings-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }
        
        .settings-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4em;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .setting-group {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .setting-group h3 {
            color: #444;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .sound-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .sound-option {
            padding: 8px 15px;
            background: #e9ecef;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .sound-option.active {
            background: #2196F3;
            color: white;
            border-color: #1976d2;
        }
        
        .sound-option:hover:not(.active) {
            background: #dee2e6;
        }
        
        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .volume-control input[type="range"] {
            flex: 1;
            height: 5px;
            -webkit-appearance: none;
            background: #ddd;
            border-radius: 2px;
            outline: none;
        }
        
        .volume-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #2196F3;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        .toggle-switch input:checked + .toggle-slider {
            background-color: #2196F3;
        }
        
        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        /* ä¸­æ–­å†å² */
        .history-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .history-header h2 {
            color: #2c3e50;
            font-size: 1.4em;
        }
        
        .history-list {
            max-height: 200px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .history-item {
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .history-time {
            color: #666;
            font-size: 0.85em;
            margin-bottom: 5px;
        }
        
        .history-details {
            display: flex;
            justify-content: space-between;
            color: #333;
            font-size: 0.9em;
        }
        
        .empty-history {
            text-align: center;
            padding: 30px 20px;
            color: #999;
            font-style: italic;
        }
        
        /* æ—¥å¿—é¢æ¿ */
        .log-section {
            background: #2c3e50;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }
        
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .log-header h2 {
            color: white;
            font-size: 1.4em;
        }
        
        .log-controls {
            display: flex;
            gap: 10px;
        }
        
        .log-content {
            background: #1a252f;
            border-radius: 8px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85em;
        }
        
        .log-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .log-content::-webkit-scrollbar-track {
            background: #1a252f;
        }
        
        .log-content::-webkit-scrollbar-thumb {
            background: #34495e;
            border-radius: 3px;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding-left: 10px;
            border-left: 3px solid transparent;
        }
        
        .log-entry.info {
            border-left-color: #3498db;
            color: #3498db;
        }
        
        .log-entry.success {
            border-left-color: #2ecc71;
            color: #2ecc71;
        }
        
        .log-entry.warning {
            border-left-color: #f39c12;
            color: #f39c12;
        }
        
        .log-entry.error {
            border-left-color: #e74c3c;
            color: #e74c3c;
        }
        
        .log-timestamp {
            color: #7f8c8d;
            font-size: 0.8em;
        }
        
        .log-module {
            color: #bdc3c7;
            background: #34495e;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8em;
            margin: 0 5px;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                border-radius: 15px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .timer-display {
                font-size: 3.5em;
            }
            
            .time-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                min-width: auto;
            }
            
            .records-stats {
                grid-template-columns: 1fr;
            }
            
            .interrupt-controls {
                grid-template-columns: 1fr;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .timer-display {
                font-size: 2.5em;
            }
            
            .header h1 {
                font-size: 1.5em;
            }
            
            .time-input {
                width: 100%;
            }
            
            .status-indicators {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .records-header,
            .history-header,
            .log-header {
                flex-direction: column;
                gap: 10px;
            }
            
            .log-controls {
                width: 100%;
                justify-content: stretch;
            }
            
            .log-controls .btn {
                flex: 1;
            }
        }
        
        /* è§¦æ‘¸åé¦ˆ */
        .touch-feedback {
            opacity: 0.8;
            transform: scale(0.98);
        }
        
        /* åŠ¨ç”» */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ… ç•ªèŒ„æ—¶é’Ÿ Pomodoro Timer</h1>
            <div class="subtitle">ä¸“æ³¨ã€ä¼‘æ¯ã€è®°å½•ï¼Œæé«˜æ‚¨çš„å·¥ä½œæ•ˆç‡ v6.2.0</div>
        </div>

        <div class="main-controls">
            <div id="timerDisplay" class="timer-display">25:00</div>
            
            <div class="time-controls">
                <div class="time-input-group">
                    <label for="focusTime">ä¸“æ³¨æ—¶é—´ (åˆ†é’Ÿ)</label>
                    <input type="number" id="focusTime" class="time-input" value="25" min="1" max="120">
                </div>
                <div class="time-input-group">
                    <label for="breakTime">ä¼‘æ¯æ—¶é—´ (åˆ†é’Ÿ)</label>
                    <input type="number" id="breakTime" class="time-input" value="5" min="1" max="60">
                </div>
            </div>
            
<div class="button-group">
                <button id="startBtn" class="btn btn-primary">â–¶ å¼€å§‹</button>
                <button id="pauseBtn" class="btn btn-secondary" disabled>â¸ æš‚åœ</button>
                <button id="resetBtn" class="btn btn-warning">ğŸ”„ é‡ç½®</button>
                <!-- === æ–°å¢ï¼šè·³è¿‡ä¼‘æ¯æŒ‰é’® === -->
                <button id="skipBreakBtn" class="btn btn-info" style="display: none;">â­ï¸ è·³è¿‡ä¼‘æ¯</button>
                <!-- === æ–°å¢ç»“æŸ === -->
            </div>
            
            <div class="preset-times">
                <button class="preset-time" data-minutes="15">15åˆ†é’Ÿ</button>
                <button class="preset-time active" data-minutes="25">25åˆ†é’Ÿ</button>
                <button class="preset-time" data-minutes="30">30åˆ†é’Ÿ</button>
                <button class="preset-time" data-minutes="45">45åˆ†é’Ÿ</button>
                <button class="preset-time" data-minutes="60">60åˆ†é’Ÿ</button>
            </div>
            
            <div class="time-controls" style="margin-top: 20px;">
                <div class="time-input-group">
                    <label>è‡ªå®šä¹‰æ—¶é—´</label>
                    <input type="number" id="customMinutes" class="time-input" placeholder="åˆ†é’Ÿ" min="1" max="120">
                </div>
                <button id="setCustomTimeBtn" class="btn" style="background: #9c27b0; color: white; margin-top: 25px;">åº”ç”¨è‡ªå®šä¹‰æ—¶é—´</button>
            </div>
            <!-- === æ–°å¢ï¼šä»»åŠ¡åç§°è¾“å…¥åŒºåŸŸ === -->
            <div class="time-controls" style="margin-top: 15px;">
                <div class="time-input-group" style="flex: 1;">
                    <label for="taskNameInput">ğŸ“ ä»»åŠ¡åç§° (å¯é€‰)</label>
                    <input type="text" id="taskNameInput" class="time-input" placeholder="ä¾‹å¦‚ï¼šå†™æŠ¥å‘Šã€é˜…è¯»Chapter 3" maxlength="50">
                </div>
            </div>
            <!-- === æ–°å¢ç»“æŸ === -->
            <div class="status-indicators">
                <div id="pomodoroStatus" class="pomodoro-status">ğŸ¯ å‡†å¤‡å¼€å§‹ä¸“æ³¨</div>
                <div id="deviceStatus" class="device-status">ğŸ”§ éŸ³é¢‘ç³»ç»Ÿåˆå§‹åŒ–ä¸­...</div>
            </div>
        </div>

        <div class="settings-section">
            <h2>âš™ï¸ è®¾ç½®</h2>
            <div class="settings-grid">
                <div class="setting-group">
                    <h3>ğŸ”Š å£°éŸ³è®¾ç½®</h3>
                    <div class="volume-control">
                        <span>éŸ³é‡</span>
                        <input type="range" id="volumeControl" min="0" max="100" value="50">
                        <span id="volumeValue">50%</span>
                    </div>
                    <div class="sound-options">
                        <div class="sound-option active" data-sound="beep">èœ‚é¸£</div>
                        <div class="sound-option" data-sound="bell">é“ƒå£°</div>
                        <div class="sound-option" data-sound="chord">å’Œå¼¦</div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button id="testSoundBtn" class="btn btn-info" style="padding: 8px 16px; font-size: 0.9em;">æµ‹è¯•å£°éŸ³</button>
                        <button id="stopSoundBtn" class="btn btn-warning" style="padding: 8px 16px; font-size: 0.9em;">åœæ­¢æ‰€æœ‰å£°éŸ³</button>
                    </div>
                </div>
                
                <div class="setting-group">
                    <h3>ğŸ“³ è®¾å¤‡æ§åˆ¶</h3>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <span>éœ‡åŠ¨åŠŸèƒ½</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="vibrationToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>ç‚¹å‡»éŸ³æ•ˆ</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="clickSoundToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <button id="testSoundBtn2" class="btn btn-info" style="width: 100%; margin-top: 15px; padding: 10px;">å®Œæ•´éŸ³é¢‘æµ‹è¯•</button>
                </div>
            </div>
        </div>
<!-- === æ–°å¢ï¼šä»»åŠ¡ç®¡ç†åŒºåŸŸï¼ˆå››è±¡é™æ³•ï¼‰ === -->
        <div class="task-section">
            <div class="task-header">
                <h2>ğŸ“‹ ä»»åŠ¡ç®¡ç†ï¼ˆå››è±¡é™æ³•ï¼‰</h2>
                <div class="button-group" style="gap: 10px;">
                    <button id="sortTasksBtn" class="btn btn-secondary" style="padding: 10px 20px;">ğŸ”„ æ™ºèƒ½æ’åº</button>
                    <button id="clearTasksBtn" class="btn btn-danger" style="padding: 10px 20px;">ğŸ—‘ï¸ æ¸…ç©ºä»»åŠ¡</button>
                </div>
            </div>

            <!-- ä»»åŠ¡è¾“å…¥è¡¨å• -->
            <div class="task-input-area" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 10px; align-items: end;">
                    <div>
                        <label for="newTaskName" style="display: block; margin-bottom: 5px; color: #666; font-size: 0.9em;">ä»»åŠ¡å†…å®¹</label>
                        <input type="text" id="newTaskName" class="interrupt-input" placeholder="ä¾‹å¦‚ï¼šå®Œæˆé¡¹ç›®æŠ¥å‘Š" style="width: 100%;">
                    </div>
                    <div>
                        <label for="taskImportance" style="display: block; margin-bottom: 5px; color: #666; font-size: 0.9em;">é‡è¦æ€§</label>
                        <select id="taskImportance" class="interrupt-input" style="width: 100%;">
                            <option value="high">é«˜</option>
                            <option value="medium" selected>ä¸­</option>
                            <option value="low">ä½</option>
                        </select>
                    </div>
                    <div>
                        <label for="taskUrgency" style="display: block; margin-bottom: 5px; color: #666; font-size: 0.9em;">ç´§æ€¥æ€§</label>
                        <select id="taskUrgency" class="interrupt-input" style="width: 100%;">
                            <option value="high">é«˜</option>
                            <option value="medium" selected>ä¸­</option>
                            <option value="low">ä½</option>
                        </select>
                    </div>
                    <div>
                        <button id="addTaskBtn" class="btn btn-primary" style="padding: 12px 24px;">â• æ·»åŠ ä»»åŠ¡</button>
                    </div>
                </div>
            </div>

            <!-- å››è±¡é™ä»»åŠ¡å±•ç¤º -->
            <div class="quadrants-container" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                <!-- ç¬¬ä¸€è±¡é™ï¼šé‡è¦ä¸”ç´§æ€¥ -->
                <div class="quadrant" data-quadrant="1" style="border: 2px solid #e74c3c; border-radius: 10px; padding: 15px; background-color: #ffebee;">
                    <h3 style="color: #c62828; margin-bottom: 10px;">ğŸ”¥ ç¬¬ä¸€è±¡é™ï¼šé‡è¦ä¸”ç´§æ€¥</h3>
                    <div class="task-list" id="quadrant1List" style="min-height: 80px;"></div>
                </div>
                <!-- ç¬¬äºŒè±¡é™ï¼šé‡è¦ä¸ç´§æ€¥ -->
                <div class="quadrant" data-quadrant="2" style="border: 2px solid #2ecc71; border-radius: 10px; padding: 15px; background-color: #e8f5e9;">
                    <h3 style="color: #2e7d32; margin-bottom: 10px;">ğŸ“ˆ ç¬¬äºŒè±¡é™ï¼šé‡è¦ä¸ç´§æ€¥</h3>
                    <div class="task-list" id="quadrant2List" style="min-height: 80px;"></div>
                </div>
                <!-- ç¬¬ä¸‰è±¡é™ï¼šç´§æ€¥ä¸é‡è¦ -->
                <div class="quadrant" data-quadrant="3" style="border: 2px solid #f39c12; border-radius: 10px; padding: 15px; background-color: #fff3e0;">
                    <h3 style="color: #ef6c00; margin-bottom: 10px;">âš ï¸ ç¬¬ä¸‰è±¡é™ï¼šç´§æ€¥ä¸é‡è¦</h3>
                    <div class="task-list" id="quadrant3List" style="min-height: 80px;"></div>
                </div>
                <!-- ç¬¬å››è±¡é™ï¼šä¸ç´§æ€¥ä¸é‡è¦ -->
                <div class="quadrant" data-quadrant="4" style="border: 2px solid #95a5a6; border-radius: 10px; padding: 15px; background-color: #f5f5f5;">
                    <h3 style="color: #546e7a; margin-bottom: 10px;">ğŸ’¤ ç¬¬å››è±¡é™ï¼šä¸ç´§æ€¥ä¸é‡è¦</h3>
                    <div class="task-list" id="quadrant4List" style="min-height: 80px;"></div>
                </div>
            </div>

            <!-- æ‰§è¡Œå»ºè®®åŒºåŸŸ -->
            <div class="recommendation-area" style="padding: 15px; background: #e3f2fd; border-radius: 10px; margin-top: 20px;">
                <h3 style="color: #1565c0; margin-bottom: 10px;">ğŸš€ æ™ºèƒ½æ‰§è¡Œå»ºè®®</h3>
                <div id="taskRecommendation">æš‚æ— ä»»åŠ¡ï¼Œè¯·å…ˆæ·»åŠ ä»»åŠ¡ã€‚</div>
            </div>
        </div>
        <div class="interrupt-section">
            <h2>â±ï¸ å¿«é€Ÿä¸­æ–­è®¡æ—¶å™¨</h2>
            <div class="interrupt-controls">
                <div class="interrupt-input-group">
                    <label for="interruptMinutes">åˆ†é’Ÿ</label>
                    <input type="number" id="interruptMinutes" class="interrupt-input" value="0" min="0" max="60">
                </div>
                <div class="interrupt-input-group">
                    <label for="interruptSeconds">ç§’æ•°</label>
                    <input type="number" id="interruptSeconds" class="interrupt-input" value="10" min="0" max="59">
                </div>
                <div class="interrupt-input-group" style="grid-column: span 2;">
                    <label for="interruptReason">ä¸­æ–­åŸå›  (å¯é€‰)</label>
                    <input type="text" id="interruptReason" class="interrupt-input" placeholder="ä¾‹å¦‚ï¼šæ¥ç”µè¯ã€å–æ°´ç­‰">
                </div>
            </div>
            
            <div id="interruptTimerDisplay" class="interrupt-timer-display">00:00</div>
            
            <div class="button-group">
                <button id="startInterruptBtn" class="btn btn-primary">â–¶ å¼€å§‹ä¸­æ–­</button>
                <button id="cancelInterruptBtn" class="btn btn-danger" style="display: none;">âŒ å–æ¶ˆä¸­æ–­</button>
            </div>
            
            <div class="quick-test-buttons">
                <button class="quick-test-btn" data-seconds="5">5ç§’æµ‹è¯•</button>
                <button class="quick-test-btn" data-seconds="10">10ç§’æµ‹è¯•</button>
                <button class="quick-test-btn" data-seconds="30">30ç§’æµ‹è¯•</button>
                <button class="quick-test-btn" data-seconds="60">1åˆ†é’Ÿæµ‹è¯•</button>
            </div>
        </div>
        <div class="records-section">
            <div class="records-header">
                <h2>ğŸ“Š ç•ªèŒ„é’Ÿè®°å½•</h2>
                <div class="button-group" style="gap: 10px;">
                    <button id="exportRecordsBtn" class="btn btn-secondary" style="padding: 10px 20px;">ğŸ“¤ å¯¼å‡ºè®°å½•</button>
                    <button id="clearRecordsBtn" class="btn btn-danger" style="padding: 10px 20px;">ğŸ—‘ï¸ æ¸…ç©ºè®°å½•</button>
                </div>
            </div>
            
            <div class="records-stats">
                <div class="stat-item">
                    <div id="todayCompleted" class="stat-value">0</div>
                    <div class="stat-label">ä»Šæ—¥å®Œæˆ</div>
                </div>
                <div class="stat-item">
                    <div id="totalCompleted" class="stat-value">0</div>
                    <div class="stat-label">æ€»å…±å®Œæˆ</div>
                </div>
                <div class="stat-item">
                    <div id="totalFocusTime" class="stat-value">0</div>
                    <div class="stat-label">æ€»ä¸“æ³¨æ—¶é—´(å°æ—¶)</div>
                </div>
            </div>
            
            <div id="recordList" class="record-list">
                <div class="no-records">æš‚æ— è®°å½•ï¼Œå¼€å§‹æ‚¨çš„ç¬¬ä¸€ä¸ªç•ªèŒ„é’Ÿå§ï¼</div>
            </div>
        </div>

        <div class="history-section">
            <div class="history-header">
                <h2>ğŸ“ˆ ä¸­æ–­å†å²</h2>
                <button id="clearHistoryBtn" class="btn btn-warning" style="padding: 10px 20px;">æ¸…é™¤å†å²</button>
            </div>
            <div id="historyList" class="history-list">
                <div class="empty-history">æš‚æ— ä¸­æ–­è®°å½•</div>
            </div>
        </div>

        <div class="log-section">
            <div class="log-header">
                <h2>ğŸ“‹ ç³»ç»Ÿæ—¥å¿—</h2>
                <div class="log-controls">
                    <button id="clearLogBtn" class="btn btn-danger" style="padding: 8px 16px; font-size: 0.9em;">æ¸…ç©ºæ—¥å¿—</button>
                    <button id="toggleLogBtn" class="btn btn-secondary" style="padding: 8px 16px; font-size: 0.9em;">éšè—æ—¥å¿—</button>
                </div>
            </div>
            <div id="logContent" class="log-content">
                <!-- æ—¥å¿—æ¡ç›®å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
            </div>
        </div>
    </div>

    <div id="statusBar" class="status-bar"></div>

    <script>
        'use strict';
        
        // éŸ³é¢‘ç”Ÿæˆå™¨ç±»
        class AudioGenerator {
            constructor() {
                this.audioContext = null;
                this.activeSounds = new Set();
                this.initialized = false;
                this.initialize();
            }
            
            initialize() {
                try {
                    if (window.AudioContext || window.webkitAudioContext) {
                        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        this.initialized = true;
                        addLogEntry('éŸ³é¢‘ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ', 'success', 'éŸ³é¢‘');
                    } else {
                        addLogEntry('æµè§ˆå™¨ä¸æ”¯æŒWeb Audio API', 'warning', 'éŸ³é¢‘');
                    }
                } catch (error) {
                    addLogEntry(`éŸ³é¢‘ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error', 'éŸ³é¢‘');
                }
            }
            
            async ensureRunning() {
                try {
                    if (!this.audioContext) {
                        this.initialize();
                        if (!this.audioContext) {
                            return false;
                        }
                    }
                    
                    if (this.audioContext.state === 'suspended') {
                        await this.audioContext.resume();
                        addLogEntry('AudioContextæ¢å¤æˆåŠŸ', 'success', 'éŸ³é¢‘');
                    }
                    
                    return this.audioContext.state === 'running';
                } catch (error) {
                    addLogEntry(`AudioContextå¯åŠ¨å¤±è´¥: ${error.message}`, 'error', 'éŸ³é¢‘');
                    return false;
                }
            }
            
            getAudioContext() {
                try {
                    return this.audioContext || null;
                } catch (error) {
                    addLogEntry(`è·å–AudioContextå¤±è´¥: ${error.message}`, 'error', 'éŸ³é¢‘');
                    return null;
                }
            }
            
            playBeep(frequency = 800, duration = 0.5, volume = 0.5) {
                return this.playTone(frequency, duration, volume, 'sine');
            }
            
            playBell(frequency = 440, duration = 1, volume = 0.5) {
                return this.playTone(frequency, duration, volume, 'sine', true);
            }
            
            playChord(duration = 1, volume = 0.5) {
                return this.playTone(440, duration, volume, 'sine', true, [523.25, 659.25]);
            }
            
            playClick(frequency = 1000, duration = 0.1, volume = 0.3) {
                return this.playTone(frequency, duration, volume, 'square');
            }
            
            playTone(baseFrequency, duration, volume, type = 'sine', fadeOut = false, additionalFrequencies = []) {
                if (!this.audioContext || !window.userInteracted) {
                    addLogEntry('éŸ³é¢‘æœªåˆå§‹åŒ–æˆ–æœªæ¿€æ´»', 'warning', 'éŸ³é¢‘');
                    return false;
                }
                
                try {
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    oscillator.type = type;
                    oscillator.frequency.value = baseFrequency;
                    gainNode.gain.value = volume;
                    
                    const now = this.audioContext.currentTime;
                    oscillator.start(now);
                    
                    if (fadeOut) {
                        gainNode.gain.setValueAtTime(volume, now);
                        gainNode.gain.exponentialRampToValueAtTime(0.001, now + duration);
                    }
                    
                    if (additionalFrequencies && additionalFrequencies.length > 0) {
                        additionalFrequencies.forEach(freq => {
                            const extraOsc = this.audioContext.createOscillator();
                            const extraGain = this.audioContext.createGain();
                            
                            extraOsc.connect(extraGain);
                            extraGain.connect(this.audioContext.destination);
                            
                            extraOsc.type = type;
                            extraOsc.frequency.value = freq;
                            extraGain.gain.value = volume * 0.7;
                            
                            extraOsc.start(now);
                            if (fadeOut) {
                                extraGain.gain.setValueAtTime(volume * 0.7, now);
                                extraGain.gain.exponentialRampToValueAtTime(0.001, now + duration);
                            }
                            extraOsc.stop(now + duration);
                        });
                    }
                    
                    oscillator.stop(now + duration);
                    
                    const soundId = Symbol('sound');
                    this.activeSounds.add(soundId);
                    
                    setTimeout(() => {
                        this.activeSounds.delete(soundId);
                    }, duration * 1000 + 100);
                    
                    addLogEntry(`æ’­æ”¾å£°éŸ³: ${baseFrequency}Hz, ç±»å‹: ${type}`, 'info', 'éŸ³é¢‘');
                    return true;
                } catch (error) {
                    addLogEntry(`æ’­æ”¾å£°éŸ³å¤±è´¥: ${error.message}`, 'error', 'éŸ³é¢‘');
                    return false;
                }
            }
            
stopAll() {
                try {
                    if (this.audioContext) {
                        this.audioContext.close();
                        this.audioContext = null;
                    }
                    this.activeSounds.clear();
                    this.continuousSoundInterval && clearInterval(this.continuousSoundInterval);
                    this.continuousSoundInterval = null;
                    this.isContinuousPlaying = false;
                    this.initialized = false;
                    addLogEntry('åœæ­¢æ‰€æœ‰å£°éŸ³', 'info', 'éŸ³é¢‘');
                } catch (error) {
                    addLogEntry(`åœæ­¢å£°éŸ³å¤±è´¥: ${error.message}`, 'error', 'éŸ³é¢‘');
                }
            }

            // === æ–°å¢ï¼šå¾ªç¯æ’­æ”¾å’Œåœæ­¢æ–¹æ³• ===
            playContinuousSound(type = 'beep', interval = 800) {
                if (!this.audioContext || !window.userInteracted) {
                    addLogEntry('éŸ³é¢‘æœªåˆå§‹åŒ–æˆ–æœªæ¿€æ´»ï¼Œæ— æ³•å¼€å§‹è¿ç»­æ’­æ”¾', 'warning', 'éŸ³é¢‘');
                    return false;
                }
                
                if (this.isContinuousPlaying) {
                    addLogEntry('è¿ç»­æ’­æ”¾å·²åœ¨è¿è¡Œä¸­', 'info', 'éŸ³é¢‘');
                    return false;
                }
                
                this.isContinuousPlaying = true;
                addLogEntry(`å¼€å§‹è¿ç»­å£°éŸ³æ’­æ”¾: ${type} (é—´éš”${interval}ms)`, 'info', 'éŸ³é¢‘');
                
                // ç«‹å³æ’­æ”¾ä¸€æ¬¡
                this._playSoundOnce(type);
                
                // è®¾ç½®å¾ªç¯é—´éš”
                this.continuousSoundInterval = setInterval(() => {
                    if (this.isContinuousPlaying) {
                        this._playSoundOnce(type);
                    }
                }, interval);
                
                return true;
            }

            stopContinuousSound() {
                if (this.continuousSoundInterval) {
                    clearInterval(this.continuousSoundInterval);
                    this.continuousSoundInterval = null;
                }
                this.isContinuousPlaying = false;
                addLogEntry('è¿ç»­å£°éŸ³æ’­æ”¾å·²åœæ­¢', 'info', 'éŸ³é¢‘');
            }

            _playSoundOnce(type = 'beep') {
                // å†…éƒ¨æ–¹æ³•ï¼šå•æ¬¡æ’­æ”¾å£°éŸ³
                if (!this.audioContext || !window.userInteracted) {
                    return false;
                }
                try {
                    const currentVolume = volume; // ä½¿ç”¨å…¨å±€éŸ³é‡å˜é‡
                    switch(type) {
                        case 'beep':
                            return this.playBeep(800, 0.5, currentVolume);
                        case 'bell':
                            return this.playBell(440, 1, currentVolume);
                        case 'chord':
                            return this.playChord(1, currentVolume);
                        default:
                            return this.playBeep(800, 0.5, currentVolume);
                    }
                } catch (error) {
                    addLogEntry(`å•æ¬¡æ’­æ”¾å¤±è´¥: ${error.message}`, 'error', 'éŸ³é¢‘');
                    return false;
                }
            }
            // === æ–°å¢ç»“æŸ ===
        }
        
        // ä¸»åº”ç”¨å˜é‡
        let audioGenerator = null;
        let pomodoroSeconds = 1500; // 25åˆ†é’Ÿ
        let isPomodoroRunning = false;
        let isPomodoroBreak = false;
        let pomodoroInterval = null;
        let interruptSeconds = 0;
        let isInterruptRunning = false;
        let interruptInterval = null;
        let soundEnabled = false;
        let vibrationEnabled = true;
        let clickSoundEnabled = true;
        let volume = 0.5;
        let currentSoundType = 'beep';
        let pomodoroRecords = [];
        let currentSessionHistory = [];
        let todayCompleted = 0;
        let totalCompleted = 0;
        let totalFocusTime = 0;
        let isLogVisible = true;
        let currentTaskName = ''; // æ–°å¢ï¼šç”¨äºå­˜å‚¨å½“å‰ç•ªèŒ„é’Ÿçš„ä»»åŠ¡å
        // === æ–°å¢ï¼šä»»åŠ¡ç®¡ç†ç›¸å…³å˜é‡ ===
        let tasks = []; // å­˜å‚¨æ‰€æœ‰ä»»åŠ¡
        let currentQuadrantSort = 'priority'; // å½“å‰æ’åºæ–¹å¼
        // DOMå…ƒç´ å¼•ç”¨
        // === æ–°å¢ï¼šä»»åŠ¡ç®¡ç†DOMå…ƒç´  ===
        const newTaskNameInput = document.getElementById('newTaskName');
        const taskImportanceSelect = document.getElementById('taskImportance');
        const taskUrgencySelect = document.getElementById('taskUrgency');
        const addTaskBtn = document.getElementById('addTaskBtn');
        const sortTasksBtn = document.getElementById('sortTasksBtn');
        const clearTasksBtn = document.getElementById('clearTasksBtn');
        const taskRecommendationEl = document.getElementById('taskRecommendation');
        const quadrantLists = {
            1: document.getElementById('quadrant1List'),
            2: document.getElementById('quadrant2List'),
            3: document.getElementById('quadrant3List'),
            4: document.getElementById('quadrant4List')
        };
        const timerDisplay = document.getElementById('timerDisplay');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const skipBreakBtn = document.getElementById('skipBreakBtn'); // æ–°å¢ï¼šè·³è¿‡ä¼‘æ¯æŒ‰é’®
        const focusTimeInput = document.getElementById('focusTime');
        const breakTimeInput = document.getElementById('breakTime');
        const customMinutesInput = document.getElementById('customMinutes');
        const setCustomTimeBtn = document.getElementById('setCustomTimeBtn');
        const interruptMinutesInput = document.getElementById('interruptMinutes');
        const interruptSecondsInput = document.getElementById('interruptSeconds');
        const interruptReasonInput = document.getElementById('interruptReason');
        const startInterruptBtn = document.getElementById('startInterruptBtn');
        const cancelInterruptBtn = document.getElementById('cancelInterruptBtn');
        const interruptTimerDisplay = document.getElementById('interruptTimerDisplay');
        const volumeControl = document.getElementById('volumeControl');
        const volumeValue = document.getElementById('volumeValue');
        const vibrationToggle = document.getElementById('vibrationToggle');
        const clickSoundToggle = document.getElementById('clickSoundToggle');
        const soundOptions = document.querySelectorAll('.sound-option');
        const testSoundBtn = document.getElementById('testSoundBtn');
        const testSoundBtn2 = document.getElementById('testSoundBtn2');
        const stopSoundBtn = document.getElementById('stopSoundBtn');
        const presetTimeButtons = document.querySelectorAll('.preset-time');
        const quickTestButtons = document.querySelectorAll('.quick-test-btn');
        const exportRecordsBtn = document.getElementById('exportRecordsBtn');
        const clearRecordsBtn = document.getElementById('clearRecordsBtn');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');
        const clearLogBtn = document.getElementById('clearLogBtn');
        const toggleLogBtn = document.getElementById('toggleLogBtn');
        const pomodoroStatus = document.getElementById('pomodoroStatus');
        const deviceStatusElement = document.getElementById('deviceStatus');
        const statusBar = document.getElementById('statusBar');
        const recordList = document.getElementById('recordList');
        const historyList = document.getElementById('historyList');
        const logContent = document.getElementById('logContent');
        const todayCompletedEl = document.getElementById('todayCompleted');
        const totalCompletedEl = document.getElementById('totalCompleted');
        const totalFocusTimeEl = document.getElementById('totalFocusTime');
        
        // åˆå§‹åŒ–éŸ³é¢‘ç³»ç»Ÿ
        async function initAudioSystem() {
            try {
                if (!audioGenerator) {
                    audioGenerator = new AudioGenerator();
                }
                
                const success = await audioGenerator.ensureRunning();
                if (success) {
                    soundEnabled = true;
                    window.userInteracted = true;
                    updateDeviceStatus();
                    addLogEntry('éŸ³é¢‘ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ', 'success', 'éŸ³é¢‘');
                    return true;
                } else {
                    addLogEntry('éŸ³é¢‘ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’', 'warning', 'éŸ³é¢‘');
                    return false;
                }
            } catch (error) {
                addLogEntry(`éŸ³é¢‘ç³»ç»Ÿåˆå§‹åŒ–é”™è¯¯: ${error.message}`, 'error', 'éŸ³é¢‘');
                return false;
            }
        }
        
        // æ’­æ”¾å£°éŸ³
        async function playSound(type = 'beep') {
            if (!soundEnabled || !audioGenerator) {
                addLogEntry('å£°éŸ³æ’­æ”¾è¢«è·³è¿‡: éŸ³é¢‘æœªå¯ç”¨', 'warning', 'éŸ³é¢‘');
                return false;
            }
            
            try {
                let result = false;
                const currentVolume = volume;
                
                switch(type) {
                    case 'beep':
                        result = audioGenerator.playBeep(800, 0.5, currentVolume);
                        break;
                    case 'bell':
                        result = audioGenerator.playBell(440, 1, currentVolume);
                        break;
                    case 'chord':
                        result = audioGenerator.playChord(1, currentVolume);
                        break;
                    default:
                        result = audioGenerator.playBeep(800, 0.5, currentVolume);
                }
                
                if (result && vibrationEnabled && navigator.vibrate) {
                    navigator.vibrate(200);
                }
                
                return result;
            } catch (error) {
                addLogEntry(`æ’­æ”¾å£°éŸ³å¤±è´¥: ${error.message}`, 'error', 'éŸ³é¢‘');
                return false;
            }
        }
        
        // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ
        async function playClickSound(type = 'normal') {
            if (!clickSoundEnabled || !audioGenerator || !window.userInteracted) {
                return false;
            }
            
            try {
                if (type === 'test') {
                    return audioGenerator.playBeep(600, 0.1, volume * 0.3);
                } else {
                    return audioGenerator.playClick(1000, 0.1, volume * 0.3);
                }
            } catch (error) {
                console.error('ç‚¹å‡»éŸ³æ•ˆé”™è¯¯:', error);
                return false;
            }
        }
        
        // éœ‡åŠ¨åŠŸèƒ½
        function vibrate(pattern) {
            if (vibrationEnabled && navigator.vibrate) {
                try {
                    navigator.vibrate(pattern);
                } catch (error) {
                    addLogEntry(`éœ‡åŠ¨å¤±è´¥: ${error.message}`, 'error', 'è®¾å¤‡');
                }
            }
        }
        
        // æ›´æ–°è®¾å¤‡çŠ¶æ€æ˜¾ç¤º
        function updateDeviceStatus() {
            if (!deviceStatusElement) return;
            
            const ctx = audioGenerator ? audioGenerator.getAudioContext() : null;
            let statusText = '';
            
            if (ctx) {
                switch(ctx.state) {
                    case 'running':
                        statusText = 'âœ… éŸ³é¢‘å·²æ¿€æ´»';
                        break;
                    case 'suspended':
                        statusText = 'â¸ï¸ éŸ³é¢‘å·²æš‚åœ';
                        break;
                    case 'closed':
                        statusText = 'âŒ éŸ³é¢‘å·²å…³é—­';
                        break;
                    default:
                        statusText = 'ğŸ”§ éŸ³é¢‘çŠ¶æ€æœªçŸ¥';
                }
            } else {
                statusText = soundEnabled ? 'âœ… éŸ³é¢‘å·²å‡†å¤‡' : 'ğŸ”§ ç­‰å¾…ç”¨æˆ·ç‚¹å‡»æ¿€æ´»';
            }
            
            deviceStatusElement.textContent = statusText;
        }
        
        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(message, duration = 3000) {
            if (!statusBar) return;
            
            statusBar.textContent = message;
            statusBar.classList.add('show');
            
            if (duration > 0) {
                setTimeout(() => {
                    statusBar.classList.remove('show');
                }, duration);
            }
        }
        
        // æ·»åŠ æ—¥å¿—æ¡ç›®
        function addLogEntry(message, type = 'info', module = 'ç³»ç»Ÿ') {
            if (!logContent) return;
            
            const now = new Date();
            const timestamp = now.toLocaleTimeString('zh-CN', { 
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.innerHTML = `
                <span class="log-timestamp">${timestamp}</span>
                <span class="log-module">${module}</span>
                ${message}
            `;
            
            logContent.appendChild(logEntry);
            logContent.scrollTop = logContent.scrollHeight;
            
            console.log(`[${timestamp}] [${module}] ${message}`);
        }
        
        // æ¸…ç©ºæ—¥å¿—
        function clearLogs() {
            if (logContent) {
                logContent.innerHTML = '';
                addLogEntry('æ—¥å¿—å·²æ¸…ç©º', 'info', 'ç³»ç»Ÿ');
            }
        }
        
        // åˆ‡æ¢æ—¥å¿—å¯è§æ€§
        function toggleLogVisibility() {
            if (logContent) {
                isLogVisible = !isLogVisible;
                logContent.style.display = isLogVisible ? 'block' : 'none';
                if (toggleLogBtn) {
                    toggleLogBtn.textContent = isLogVisible ? 'éšè—æ—¥å¿—' : 'æ˜¾ç¤ºæ—¥å¿—';
                }
                addLogEntry(`æ—¥å¿—å·²${isLogVisible ? 'æ˜¾ç¤º' : 'éšè—'}`, 'info', 'ç³»ç»Ÿ');
            }
        }
        
        // æµ‹è¯•å£°éŸ³
        async function testSound() {
            addLogEntry('æµ‹è¯•å£°éŸ³æ’­æ”¾', 'info', 'éŸ³é¢‘');
            
            if (!window.userInteracted) {
                showStatus('è¯·å…ˆç‚¹å‡»é¡µé¢ä»»æ„ä½ç½®æ¿€æ´»éŸ³é¢‘', 3000);
                addLogEntry('éœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½æ’­æ”¾å£°éŸ³', 'warning', 'éŸ³é¢‘');
                return;
            }
            
            try {
                const audioSuccess = await playSound(currentSoundType);
                if (audioSuccess) {
                    showStatus('âœ… å£°éŸ³æµ‹è¯•æˆåŠŸ', 2000);
                } else {
                    showStatus('âŒ å£°éŸ³æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥éŸ³é¢‘è®¾ç½®', 3000);
                }
            } catch (error) {
                addLogEntry(`å£°éŸ³æµ‹è¯•é”™è¯¯: ${error.message}`, 'error', 'éŸ³é¢‘');
                showStatus('âŒ å£°éŸ³æµ‹è¯•å‡ºé”™', 2000);
            }
        }
        
        // åœæ­¢æ‰€æœ‰å£°éŸ³
        function stopAllSounds() {
            if (audioGenerator) {
                audioGenerator.stopAll();
                addLogEntry('å·²åœæ­¢æ‰€æœ‰å£°éŸ³', 'info', 'éŸ³é¢‘');
                showStatus('ğŸ”‡ å·²åœæ­¢æ‰€æœ‰å£°éŸ³', 2000);
            }
        }
        
        // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // æ›´æ–°ç•ªèŒ„é’Ÿæ˜¾ç¤º
        function updateTimerDisplay(seconds) {
            if (timerDisplay) {
                timerDisplay.textContent = formatTime(seconds);
            }
        }
        
        // æ›´æ–°ç•ªèŒ„é’ŸçŠ¶æ€
        function updatePomodoroStatus() {
            if (!pomodoroStatus) return;
            
            let status = '';
            if (isPomodoroRunning) {
                if (isPomodoroBreak) {
                    status = 'â˜• ä¼‘æ¯ä¸­';
                    timerDisplay && timerDisplay.classList.add('pulse');
                } else {
                    status = 'ğŸ¯ ä¸“æ³¨ä¸­';
                    timerDisplay && timerDisplay.classList.remove('pulse');
                }
            } else {
                if (isPomodoroBreak) {
                    status = 'â¸ï¸ ä¼‘æ¯æš‚åœ';
                } else {
                    status = 'ğŸ¯ å‡†å¤‡å¼€å§‹ä¸“æ³¨';
                }
                timerDisplay && timerDisplay.classList.remove('pulse');
            }
            
            pomodoroStatus.textContent = status;
        }
        
        // å¼€å§‹ç•ªèŒ„é’Ÿ
        async function startPomodoro() {
            if (isPomodoroRunning) return;
            // === æ–°å¢ï¼šè·å–å¹¶å­˜å‚¨ä»»åŠ¡åç§° ===
            const taskNameInput = document.getElementById('taskNameInput');
            if (taskNameInput) {
                currentTaskName = taskNameInput.value.trim() || '(æœªå‘½åä»»åŠ¡)';
                // å¯é€‰ï¼šè®°å½•åˆ°æ—¥å¿—
                addLogEntry(`ä»»åŠ¡åç§°è®¾å®šä¸º: "${currentTaskName}"`, 'info', 'ç•ªèŒ„é’Ÿ');
            } else {
                currentTaskName = '(æœªå‘½åä»»åŠ¡)';
            }
            // === æ–°å¢ç»“æŸ ===
            try {
                if (clickSoundEnabled) {
                    await playClickSound('normal');
                }
                
                isPomodoroRunning = true;
                updatePomodoroStatus();
                
                if (startBtn) startBtn.disabled = true;
                if (pauseBtn) pauseBtn.disabled = false;
                
                pomodoroInterval = setInterval(() => {
                    pomodoroSeconds--;
                    updateTimerDisplay(pomodoroSeconds);
                    
                    if (pomodoroSeconds <= 0) {
                        finishPomodoro();
                    }
                }, 1000);
                
                addLogEntry(`å¼€å§‹${isPomodoroBreak ? 'ä¼‘æ¯' : 'ä¸“æ³¨'}è®¡æ—¶`, 'success', 'ç•ªèŒ„é’Ÿ');
                showStatus(`âœ… ${isPomodoroBreak ? 'ä¼‘æ¯' : 'ä¸“æ³¨'}è®¡æ—¶å¼€å§‹`, 2000);
                
            } catch (error) {
                addLogEntry(`å¼€å§‹ç•ªèŒ„é’Ÿå¤±è´¥: ${error.message}`, 'error', 'ç•ªèŒ„é’Ÿ');
                isPomodoroRunning = false;
                updatePomodoroStatus();
                if (startBtn) startBtn.disabled = false;
                if (pauseBtn) pauseBtn.disabled = true;
            }
        }
        
        // æš‚åœç•ªèŒ„é’Ÿ
        async function pausePomodoro() {
            if (!isPomodoroRunning) return;
            
            try {
                if (clickSoundEnabled) {
                    await playClickSound('normal');
                }
                
                isPomodoroRunning = false;
                clearInterval(pomodoroInterval);
                pomodoroInterval = null;
                
                updatePomodoroStatus();
                if (startBtn) startBtn.disabled = false;
                if (pauseBtn) pauseBtn.disabled = true;
                
                addLogEntry(`${isPomodoroBreak ? 'ä¼‘æ¯' : 'ä¸“æ³¨'}å·²æš‚åœ`, 'info', 'ç•ªèŒ„é’Ÿ');
                showStatus('â¸ï¸ å·²æš‚åœ', 2000);
                
            } catch (error) {
                addLogEntry(`æš‚åœç•ªèŒ„é’Ÿå¤±è´¥: ${error.message}`, 'error', 'ç•ªèŒ„é’Ÿ');
            }
        }
        
        // å®Œæˆç•ªèŒ„é’Ÿ
        async function finishPomodoro() {
            try {
                clearInterval(pomodoroInterval);
                pomodoroInterval = null;
                isPomodoroRunning = false;
                
                const isFocusFinished = !isPomodoroBreak;
                const currentTime = new Date().toLocaleTimeString('zh-CN');
                
                if (isFocusFinished) {
                    addLogEntry('ä¸“æ³¨æ—¶é—´åˆ°ï¼', 'success', 'ç•ªèŒ„é’Ÿ');
                    showStatus('ğŸ‰ ä¸“æ³¨æ—¶é—´åˆ°ï¼Œè¯·å¼€å§‹ä¼‘æ¯ï¼', 5000);
                    
                    await playSound('bell');
                    vibrate([200, 100, 200, 100, 200]);
                    
                    todayCompleted++;
                    totalCompleted++;
                    const focusTimeMinutes = parseInt(focusTimeInput ? focusTimeInput.value : 25);
                    totalFocusTime += focusTimeMinutes / 60;
                    
pomodoroRecords.unshift({
                    time: currentTime,
                    duration: `${focusTimeMinutes}åˆ†é’Ÿ`,
                    type: 'focus',
                    date: new Date().toISOString().split('T')[0],
                    // === æ–°å¢å­—æ®µ ===
                    taskName: currentTaskName // è®°å½•å½“å‰ä»»åŠ¡åç§°
                });
                    
                    saveRecords();
                    updateRecordsDisplay();
                    
                    isPomodoroBreak = true;
                    pomodoroSeconds = (breakTimeInput ? parseInt(breakTimeInput.value) : 5) * 60;
                    // === æ–°å¢ï¼šè¿›å…¥ä¼‘æ¯ï¼Œæ˜¾ç¤ºâ€œè·³è¿‡ä¼‘æ¯â€æŒ‰é’® ===
                    if (skipBreakBtn) skipBreakBtn.style.display = 'inline-block';
                } else {
                    addLogEntry('ä¼‘æ¯æ—¶é—´åˆ°ï¼', 'info', 'ç•ªèŒ„é’Ÿ');
                    showStatus('ğŸ”” ä¼‘æ¯æ—¶é—´åˆ°ï¼Œè¯·ç»§ç»­ä¸“æ³¨ï¼', 3000);
                    
                    await playSound('beep');
                    vibrate([300, 100, 300]);
                    
pomodoroRecords.unshift({
                    time: currentTime,
                    duration: `${breakTimeInput ? parseInt(breakTimeInput.value) : 5}åˆ†é’Ÿ`,
                    type: 'break',
                    date: new Date().toISOString().split('T')[0],
                    // === æ–°å¢å­—æ®µ ===
                    taskName: 'ä¼‘æ¯æ—¶æ®µ' // ä¼‘æ¯æ—¶æ®µä½¿ç”¨å›ºå®šåç§°
                });
                    
                    saveRecords();
                    updateRecordsDisplay();
                    
                    isPomodoroBreak = false;
                    pomodoroSeconds = (focusTimeInput ? parseInt(focusTimeInput.value) : 25) * 60;
                    // === æ–°å¢ï¼šä¼‘æ¯ç»“æŸï¼Œéšè—â€œè·³è¿‡ä¼‘æ¯â€æŒ‰é’® ===
                    if (skipBreakBtn) skipBreakBtn.style.display = 'none';
                }
                
                updateTimerDisplay(pomodoroSeconds);
                updatePomodoroStatus();
                
                if (startBtn) startBtn.disabled = false;
                if (pauseBtn) pauseBtn.disabled = true;
                
            } catch (error) {
                addLogEntry(`å®Œæˆç•ªèŒ„é’Ÿå¤±è´¥: ${error.message}`, 'error', 'ç•ªèŒ„é’Ÿ');
            }
        }
        
        // é‡ç½®ç•ªèŒ„é’Ÿ
        async function resetPomodoro() {
            try {
                if (clickSoundEnabled) {
                    await playClickSound('normal');
                }
                
                isPomodoroRunning = false;
                isPomodoroBreak = false;
                
                clearInterval(pomodoroInterval);
                pomodoroInterval = null;
                
                const focusMinutes = focusTimeInput ? parseInt(focusTimeInput.value) : 25;
                pomodoroSeconds = focusMinutes * 60;
                
                updateTimerDisplay(pomodoroSeconds);
                updatePomodoroStatus();
                
                if (startBtn) startBtn.disabled = false;
                if (pauseBtn) pauseBtn.disabled = true;
                
                addLogEntry('ç•ªèŒ„é’Ÿå·²é‡ç½®', 'info', 'ç•ªèŒ„é’Ÿ');
                // === æ–°å¢ï¼šé‡ç½®æ—¶æ¸…ç©ºä»»åŠ¡è¾“å…¥æ¡† ===
                const taskNameInput = document.getElementById('taskNameInput');
                if (taskNameInput) {
                    taskNameInput.value = '';
                }
                currentTaskName = '';
                // === æ–°å¢ç»“æŸ ===
                showStatus('ğŸ”„ ç•ªèŒ„é’Ÿå·²é‡ç½®', 2000);
                // === æ–°å¢ï¼šé‡ç½®æ—¶éšè—â€œè·³è¿‡ä¼‘æ¯â€æŒ‰é’® ===
                if (skipBreakBtn) skipBreakBtn.style.display = 'none';
                
            } catch (error) {
                addLogEntry(`é‡ç½®ç•ªèŒ„é’Ÿå¤±è´¥: ${error.message}`, 'error', 'ç•ªèŒ„é’Ÿ');
            }
        }
        // è·³è¿‡ä¼‘æ¯æ—¶æ®µ
        async function skipBreak() {
            // åªæœ‰å½“å‰å¤„äºä¼‘æ¯çŠ¶æ€ä¸”è®¡æ—¶å™¨åœ¨è¿è¡Œæ—¶ï¼Œæ‰èƒ½è·³è¿‡
            if (!isPomodoroBreak || !isPomodoroRunning) {
                return;
            }
            
            try {
                if (clickSoundEnabled) {
                    await playClickSound('normal');
                }
                
                // 1. åœæ­¢å½“å‰çš„ä¼‘æ¯è®¡æ—¶å™¨
                clearInterval(pomodoroInterval);
                pomodoroInterval = null;
                isPomodoroRunning = false;
                
                // 2. è®°å½•è·³è¿‡çš„ä¼‘æ¯ï¼ˆå¯é€‰ï¼‰
                const currentTime = new Date().toLocaleTimeString('zh-CN');
                pomodoroRecords.unshift({
                    time: currentTime,
                    duration: `0åˆ†é’Ÿï¼ˆå·²è·³è¿‡ï¼‰`,
                    type: 'break',
                    date: new Date().toISOString().split('T')[0],
                    taskName: 'ä¼‘æ¯ï¼ˆå·²è·³è¿‡ï¼‰'
                });
                saveRecords(); // ä¿å­˜è®°å½•
                updateRecordsDisplay(); // æ›´æ–°æ˜¾ç¤º
                
                // 3. ç«‹å³åˆ‡æ¢åˆ°ä¸“æ³¨çŠ¶æ€
                isPomodoroBreak = false;
                const focusMinutes = focusTimeInput ? parseInt(focusTimeInput.value) : 25;
                pomodoroSeconds = focusMinutes * 60;
                
                // 4. æ›´æ–°ç•Œé¢æ˜¾ç¤ºå’ŒçŠ¶æ€
                updateTimerDisplay(pomodoroSeconds);
                updatePomodoroStatus();
                
                // 5. éšè—â€œè·³è¿‡ä¼‘æ¯â€æŒ‰é’®ï¼Œå¯ç”¨â€œå¼€å§‹â€æŒ‰é’®
                if (skipBreakBtn) skipBreakBtn.style.display = 'none';
                if (startBtn) startBtn.disabled = false;
                if (pauseBtn) pauseBtn.disabled = true;
                
                addLogEntry('ä¼‘æ¯æ—¶æ®µå·²è¢«è·³è¿‡', 'info', 'ç•ªèŒ„é’Ÿ');
                showStatus('â­ï¸ å·²è·³è¿‡ä¼‘æ¯ï¼Œå‡†å¤‡å¼€å§‹ä¸‹ä¸€æ®µä¸“æ³¨', 3000);
                
                // å¯é€‰ï¼šæ’­æ”¾ä¸€ä¸ªæç¤ºéŸ³
                if (soundEnabled) {
                    await playSound('beep');
                }
                
            } catch (error) {
                addLogEntry(`è·³è¿‡ä¼‘æ¯å¤±è´¥: ${error.message}`, 'error', 'ç•ªèŒ„é’Ÿ');
            }
        }
        // å¼€å§‹ä¸­æ–­è®¡æ—¶
        async function startInterrupt() {
            if (isInterruptRunning || isPomodoroRunning) return;
            
            try {
                if (clickSoundEnabled) {
                    await playClickSound('normal');
                }
                
                const minutes = interruptMinutesInput ? parseInt(interruptMinutesInput.value) || 0 : 0;
                const seconds = interruptSecondsInput ? parseInt(interruptSecondsInput.value) || 0 : 0;
                const reason = interruptReasonInput ? interruptReasonInput.value.trim() : '';
                
                if (minutes === 0 && seconds === 0) {
                    showStatus('âš ï¸ è¯·è®¾ç½®ä¸­æ–­æ—¶é—´', 2000);
                    addLogEntry('ä¸­æ–­æ—¶é—´æœªè®¾ç½®', 'warning', 'ä¸­æ–­');
                    return;
                }
                
                interruptSeconds = minutes * 60 + seconds;
                isInterruptRunning = true;
                
                if (interruptTimerDisplay) {
                    interruptTimerDisplay.textContent = formatTime(interruptSeconds);
                    interruptTimerDisplay.classList.add('show');
                }
                
                if (startInterruptBtn) startInterruptBtn.style.display = 'none';
                if (cancelInterruptBtn) cancelInterruptBtn.style.display = 'inline-block';
                
                interruptInterval = setInterval(() => {
                    interruptSeconds--;
                    if (interruptTimerDisplay) {
                        interruptTimerDisplay.textContent = formatTime(interruptSeconds);
                    }
                    
                    if (interruptSeconds <= 0) {
                        finishInterrupt(reason);
                    }
                }, 1000);
                
                addLogEntry(`å¼€å§‹ä¸­æ–­è®¡æ—¶: ${minutes}åˆ†${seconds}ç§’${reason ? `, åŸå› : ${reason}` : ''}`, 'info', 'ä¸­æ–­');
                showStatus('â±ï¸ ä¸­æ–­è®¡æ—¶å¼€å§‹', 2000);
                
            } catch (error) {
                addLogEntry(`å¼€å§‹ä¸­æ–­å¤±è´¥: ${error.message}`, 'error', 'ä¸­æ–­');
                isInterruptRunning = false;
                if (interruptTimerDisplay) interruptTimerDisplay.classList.remove('show');
                if (startInterruptBtn) startInterruptBtn.style.display = 'inline-block';
                if (cancelInterruptBtn) cancelInterruptBtn.style.display = 'none';
            }
        }
        
// å®Œæˆä¸­æ–­è®¡æ—¶
        async function finishInterrupt(reason = '') {
            try {
                clearInterval(interruptInterval);
                interruptInterval = null;
                isInterruptRunning = false;
                
                if (interruptTimerDisplay) {
                    interruptTimerDisplay.classList.remove('show');
                }
                
                // ä¿®æ”¹ï¼šä¸å†éšè—å¼€å§‹æŒ‰é’®ï¼Œè€Œæ˜¯æ”¹å˜å…¶çŠ¶æ€
                if (startInterruptBtn) {
                    startInterruptBtn.disabled = true;
                    startInterruptBtn.textContent = 'â±ï¸ ä¸­æ–­å·²ç»“æŸ';
                }
                
                // ä¿®æ”¹ï¼šæ˜¾ç¤ºå–æ¶ˆæŒ‰é’®å¹¶æ”¹å˜å…¶åŠŸèƒ½ä¸ºâ€œåœæ­¢è­¦æŠ¥â€
                if (cancelInterruptBtn) {
                    cancelInterruptBtn.style.display = 'inline-block';
                    cancelInterruptBtn.textContent = 'ğŸ›‘ åœæ­¢è­¦æŠ¥';
                    // ç§»é™¤åŸæœ‰çš„äº‹ä»¶ç›‘å¬å™¨ï¼Œæ·»åŠ æ–°çš„åœæ­¢è­¦æŠ¥ç›‘å¬å™¨
                    cancelInterruptBtn.replaceWith(cancelInterruptBtn.cloneNode(true));
                    const newCancelBtn = document.getElementById('cancelInterruptBtn');
                    newCancelBtn.addEventListener('click', stopInterruptAlarm);
                }
                
                const duration = `${Math.floor((interruptSecondsInput ? parseInt(interruptSecondsInput.value) : 0) + (interruptMinutesInput ? parseInt(interruptMinutesInput.value) : 0) * 60)}ç§’`;
                
                currentSessionHistory.unshift({
                    time: new Date().toLocaleTimeString('zh-CN'),
                    duration: duration,
                    reason: reason || 'æ— åŸå› ',
                    seconds: interruptSeconds
                });
                
                if (currentSessionHistory.length > 10) {
                    currentSessionHistory = currentSessionHistory.slice(0, 10);
                }
                
                updateHistoryDisplay();
                saveHistory();
                
                // ä¿®æ”¹ï¼šå°†å•æ¬¡æ’­æ”¾æ”¹ä¸ºè¿ç»­æ’­æ”¾
                if (audioGenerator && soundEnabled) {
                    audioGenerator.playContinuousSound(currentSoundType, 800); // æ¯800msæ’­æ”¾ä¸€æ¬¡
                }
                
                vibrate([100, 50, 100, 50, 100, 50, 100]);
                
                addLogEntry('ä¸­æ–­æ—¶é—´åˆ°ï¼è­¦æŠ¥æŒç»­å“é“ƒä¸­...', 'success', 'ä¸­æ–­');
                showStatus('ğŸ”” ä¸­æ–­æ—¶é—´åˆ°ï¼è­¦æŠ¥æŒç»­å“é“ƒï¼Œç‚¹å‡»â€œåœæ­¢è­¦æŠ¥â€æŒ‰é’®å…³é—­', 5000);
                
            } catch (error) {
                addLogEntry(`å®Œæˆä¸­æ–­å¤±è´¥: ${error.message}`, 'error', 'ä¸­æ–­');
            }
        }
        
        // å–æ¶ˆä¸­æ–­
        async function cancelInterrupt() {
            try {
                if (clickSoundEnabled) {
                    await playClickSound('normal');
                }
                
                clearInterval(interruptInterval);
                interruptInterval = null;
                isInterruptRunning = false;
                
                if (interruptTimerDisplay) {
                    interruptTimerDisplay.classList.remove('show');
                }
                if (startInterruptBtn) startInterruptBtn.style.display = 'inline-block';
                if (cancelInterruptBtn) cancelInterruptBtn.style.display = 'none';
                
                addLogEntry('ä¸­æ–­å·²å–æ¶ˆ', 'info', 'ä¸­æ–­');
                showStatus('âŒ ä¸­æ–­å·²å–æ¶ˆ', 2000);
                
            } catch (error) {
                addLogEntry(`å–æ¶ˆä¸­æ–­å¤±è´¥: ${error.message}`, 'error', 'ä¸­æ–­');
            }
        }
        // åœæ­¢ä¸­æ–­è­¦æŠ¥
        async function stopInterruptAlarm() {
            try {
                if (clickSoundEnabled) {
                    await playClickSound('normal');
                }
                
                // åœæ­¢è¿ç»­æ’­æ”¾çš„å£°éŸ³
                if (audioGenerator) {
                    audioGenerator.stopContinuousSound();
                }
                
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                if (startInterruptBtn) {
                    startInterruptBtn.disabled = false;
                    startInterruptBtn.textContent = 'â–¶ å¼€å§‹ä¸­æ–­';
                }
                
                if (cancelInterruptBtn) {
                    cancelInterruptBtn.style.display = 'none';
                    cancelInterruptBtn.textContent = 'âŒ å–æ¶ˆä¸­æ–­';
                    // æ¢å¤åŸæœ‰çš„äº‹ä»¶ç›‘å¬å™¨
                    cancelInterruptBtn.replaceWith(cancelInterruptBtn.cloneNode(true));
                    const newCancelBtn = document.getElementById('cancelInterruptBtn');
                    newCancelBtn.addEventListener('click', cancelInterrupt);
                }
                
                addLogEntry('æ‰‹åŠ¨åœæ­¢ä¸­æ–­è­¦æŠ¥', 'info', 'ä¸­æ–­');
                showStatus('ğŸ›‘ è­¦æŠ¥å·²æ‰‹åŠ¨åœæ­¢', 2000);
                
            } catch (error) {
                addLogEntry(`åœæ­¢è­¦æŠ¥å¤±è´¥: ${error.message}`, 'error', 'ä¸­æ–­');
            }
        }
        // åº”ç”¨é¢„è®¾æ—¶é—´
        function applyPresetTime(minutes) {
            try {
                if (clickSoundEnabled) {
                    playClickSound('normal');
                }
                
                pomodoroSeconds = minutes * 60;
                isPomodoroBreak = false;
                isPomodoroRunning = false;
                
                clearInterval(pomodoroInterval);
                pomodoroInterval = null;
                
                updateTimerDisplay(pomodoroSeconds);
                updatePomodoroStatus();
                
                if (startBtn) startBtn.disabled = false;
                if (pauseBtn) pauseBtn.disabled = true;
                
                if (focusTimeInput) {
                    focusTimeInput.value = minutes;
                }
                
                addLogEntry(`åº”ç”¨é¢„è®¾æ—¶é—´: ${minutes}åˆ†é’Ÿ`, 'info', 'è®¾ç½®');
                showStatus(`âœ… å·²è®¾ç½®ä¸º${minutes}åˆ†é’Ÿä¸“æ³¨`, 2000);
                
            } catch (error) {
                addLogEntry(`åº”ç”¨é¢„è®¾æ—¶é—´å¤±è´¥: ${error.message}`, 'error', 'è®¾ç½®');
            }
        }
        
        // åº”ç”¨è‡ªå®šä¹‰æ—¶é—´
        async function applyCustomTime() {
            try {
                if (clickSoundEnabled) {
                    await playClickSound('normal');
                }
                
                const minutes = customMinutesInput ? parseInt(customMinutesInput.value) : 25;
                if (minutes < 1 || minutes > 120) {
                    showStatus('âŒ æ—¶é—´èŒƒå›´: 1-120åˆ†é’Ÿ', 2000);
                    addLogEntry('è‡ªå®šä¹‰æ—¶é—´è¶…å‡ºèŒƒå›´', 'warning', 'è®¾ç½®');
                    return;
                }
                
                applyPresetTime(minutes);
                
            } catch (error) {
                addLogEntry(`åº”ç”¨è‡ªå®šä¹‰æ—¶é—´å¤±è´¥: ${error.message}`, 'error', 'è®¾ç½®');
            }
        }
        
        // å¿«é€Ÿæµ‹è¯•ä¸­æ–­
        async function quickTestInterrupt(seconds) {
            try {
                if (clickSoundEnabled) {
                    await playClickSound('normal');
                }
                
                if (isPomodoroRunning) {
                    showStatus('âš ï¸ è¯·å…ˆæš‚åœç•ªèŒ„é’Ÿ', 2000);
                    addLogEntry('æ— æ³•åœ¨ç•ªèŒ„é’Ÿè¿è¡Œæ—¶æµ‹è¯•ä¸­æ–­', 'warning', 'ä¸­æ–­');
                    return;
                }
                
                if (isInterruptRunning) {
                    showStatus('âš ï¸ å·²æœ‰ä¸­æ–­åœ¨è¿è¡Œ', 2000);
                    addLogEntry('å·²æœ‰ä¸­æ–­åœ¨è¿è¡Œ', 'warning', 'ä¸­æ–­');
                    return;
                }
                
                if (interruptSecondsInput) {
                    interruptSecondsInput.value = seconds;
                }
                if (interruptMinutesInput) {
                    interruptMinutesInput.value = 0;
                }
                
                addLogEntry(`å¿«é€Ÿæµ‹è¯•ä¸­æ–­: ${seconds}ç§’`, 'info', 'ä¸­æ–­');
                showStatus(`â±ï¸ æµ‹è¯•${seconds}ç§’ä¸­æ–­`, 2000);
                
                await startInterrupt();
                
            } catch (error) {
                addLogEntry(`å¿«é€Ÿæµ‹è¯•ä¸­æ–­å¤±è´¥: ${error.message}`, 'error', 'ä¸­æ–­');
            }
        }
        
// æ›´æ–°è®°å½•æ˜¾ç¤º
        function updateRecordsDisplay() {
            if (!recordList) return;
            
            if (todayCompletedEl) todayCompletedEl.textContent = todayCompleted;
            if (totalCompletedEl) totalCompletedEl.textContent = totalCompleted;
            if (totalFocusTimeEl) {
                totalFocusTimeEl.textContent = totalFocusTime.toFixed(1);
            }
            
            if (pomodoroRecords.length === 0) {
                recordList.innerHTML = '<div class="no-records">æš‚æ— è®°å½•ï¼Œå¼€å§‹æ‚¨çš„ç¬¬ä¸€ä¸ªç•ªèŒ„é’Ÿå§ï¼</div>';
                return;
            }
            
            let html = '';
            pomodoroRecords.slice(0, 20).forEach(record => {
                html += `
                    <div class="record-item">
                        <div class="record-info">
                            <div class="record-time">${record.time}</div>
                            <div class="record-duration">${record.duration} â€¢ ${record.taskName || '(æ— ä»»åŠ¡å)'}</div>
                        </div>
                        <div class="record-type ${record.type}">${record.type === 'focus' ? 'ä¸“æ³¨' : 'ä¼‘æ¯'}</div>
                    </div>
                `;
            });
            
            recordList.innerHTML = html;
        }
        
        // ä¿å­˜è®°å½•
        function saveRecords() {
            try {
                const data = {
                    records: pomodoroRecords,
                    todayCompleted: todayCompleted,
                    totalCompleted: totalCompleted,
                    totalFocusTime: totalFocusTime,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem('pomodoroRecords', JSON.stringify(data));
                addLogEntry('è®°å½•å·²ä¿å­˜', 'info', 'å­˜å‚¨');
            } catch (error) {
                addLogEntry(`ä¿å­˜è®°å½•å¤±è´¥: ${error.message}`, 'error', 'å­˜å‚¨');
            }
        }
        
        // åŠ è½½è®°å½•
        function loadRecords() {
            try {
                const savedData = localStorage.getItem('pomodoroRecords');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    pomodoroRecords = data.records || [];
                    todayCompleted = data.todayCompleted || 0;
                    totalCompleted = data.totalCompleted || 0;
                    totalFocusTime = data.totalFocusTime || 0;
                    
                    updateRecordsDisplay();
                    addLogEntry('è®°å½•å·²åŠ è½½', 'success', 'å­˜å‚¨');
                } else {
                    addLogEntry('æ— å†å²è®°å½•', 'info', 'å­˜å‚¨');
                }
            } catch (error) {
                addLogEntry(`åŠ è½½è®°å½•å¤±è´¥: ${error.message}`, 'error', 'å­˜å‚¨');
            }
        }
        
        // å¯¼å‡ºè®°å½•
        function exportRecords() {
            try {
                if (pomodoroRecords.length === 0) {
                    showStatus('ğŸ“­ æš‚æ— è®°å½•å¯å¯¼å‡º', 2000);
                    addLogEntry('æš‚æ— è®°å½•å¯å¯¼å‡º', 'warning', 'è®°å½•');
                    return;
                }
                
                const dataStr = JSON.stringify(pomodoroRecords, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `pomodoro-records-${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                addLogEntry('è®°å½•å·²å¯¼å‡º', 'success', 'è®°å½•');
                showStatus('âœ… è®°å½•å¯¼å‡ºæˆåŠŸ', 2000);
                
            } catch (error) {
                addLogEntry(`å¯¼å‡ºè®°å½•å¤±è´¥: ${error.message}`, 'error', 'è®°å½•');
                showStatus('âŒ è®°å½•å¯¼å‡ºå¤±è´¥', 2000);
            }
        }
        
        // æ¸…ç©ºæ‰€æœ‰è®°å½•
        function clearAllRecords() {
            try {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                    pomodoroRecords = [];
                    todayCompleted = 0;
                    totalCompleted = 0;
                    totalFocusTime = 0;
                    
                    saveRecords();
                    updateRecordsDisplay();
                    
                    addLogEntry('æ‰€æœ‰è®°å½•å·²æ¸…ç©º', 'warning', 'è®°å½•');
                    showStatus('ğŸ—‘ï¸ è®°å½•å·²æ¸…ç©º', 2000);
                }
            } catch (error) {
                addLogEntry(`æ¸…ç©ºè®°å½•å¤±è´¥: ${error.message}`, 'error', 'è®°å½•');
            }
        }
        
        // æ›´æ–°å†å²æ˜¾ç¤º
        function updateHistoryDisplay() {
            if (!historyList) return;
            
            if (currentSessionHistory.length === 0) {
                historyList.innerHTML = '<div class="empty-history">æš‚æ— ä¸­æ–­è®°å½•</div>';
                return;
            }
            
            let html = '';
            currentSessionHistory.forEach(item => {
                html += `
                    <div class="history-item">
                        <div class="history-time">${item.time}</div>
                        <div class="history-details">
                            <span>${item.duration}</span>
                            <span>${item.reason}</span>
                        </div>
                    </div>
                `;
            });
            
            historyList.innerHTML = html;
        }
        
        // ä¿å­˜å†å²è®°å½•
        function saveHistory() {
            try {
                const allHistory = JSON.parse(localStorage.getItem('pomodoroInterruptHistory') || '[]');
                
                const newEntry = {
                    timestamp: new Date().toISOString(),
                    duration: currentSessionHistory[0]?.duration || '0ç§’',
                    reason: currentSessionHistory[0]?.reason || 'æ— åŸå› ',
                    seconds: currentSessionHistory[0]?.seconds || 0
                };
                
                allHistory.unshift(newEntry);
                
                if (allHistory.length > 100) {
                    allHistory.length = 100;
                }
                
                localStorage.setItem('pomodoroInterruptHistory', JSON.stringify(allHistory));
                
            } catch (error) {
                addLogEntry(`ä¿å­˜å†å²è®°å½•å¤±è´¥: ${error.message}`, 'error', 'å­˜å‚¨');
            }
        }
        
        // æ¸…ç©ºå†å²è®°å½•
        function clearHistory() {
            try {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºä¸­æ–­å†å²å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                    currentSessionHistory = [];
                    updateHistoryDisplay();
                    localStorage.removeItem('pomodoroInterruptHistory');
                    
                    addLogEntry('ä¸­æ–­å†å²å·²æ¸…ç©º', 'info', 'å†å²');
                    showStatus('ğŸ—‘ï¸ ä¸­æ–­å†å²å·²æ¸…ç©º', 2000);
                }
            } catch (error) {
                addLogEntry(`æ¸…ç©ºå†å²å¤±è´¥: ${error.message}`, 'error', 'å†å²');
            }
        }
        
        // æ£€æŸ¥éŸ³é¢‘ä¸Šä¸‹æ–‡çŠ¶æ€
        function checkAudioContextStatus() {
            try {
                const ctx = audioGenerator ? audioGenerator.getAudioContext() : null;
                
                if (!ctx) {
                    addLogEntry('AudioContextæœªåˆå§‹åŒ–æˆ–ä¸å¯ç”¨', 'warning', 'éŸ³é¢‘');
                    if (deviceStatusElement) {
                        deviceStatusElement.textContent = 'ğŸ”§ éŸ³é¢‘ç³»ç»Ÿåˆå§‹åŒ–ä¸­...';
                    }
                } else if (typeof ctx === 'object' && ctx.state) {
                    addLogEntry(`AudioContextçŠ¶æ€: ${ctx.state}`, 'info', 'éŸ³é¢‘');
                    
                    if (deviceStatusElement) {
                        if (ctx.state === 'running') {
                            deviceStatusElement.textContent = 'âœ… éŸ³é¢‘å·²æ¿€æ´»';
                        } else if (ctx.state === 'suspended') {
                            deviceStatusElement.textContent = 'â¸ï¸ éŸ³é¢‘å·²æš‚åœ';
                        } else if (ctx.state === 'closed') {
                            deviceStatusElement.textContent = 'âŒ éŸ³é¢‘å·²å…³é—­';
                        }
                    }
                } else {
                    addLogEntry('æ— æ³•è¯»å–AudioContextçŠ¶æ€', 'warning', 'éŸ³é¢‘');
                }
            } catch (error) {
                addLogEntry(`æ£€æŸ¥AudioContextçŠ¶æ€å‡ºé”™: ${error.message}`, 'error', 'éŸ³é¢‘');
                console.error('AudioContextçŠ¶æ€æ£€æŸ¥é”™è¯¯:', error);
            }
        }
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
        function initEventListeners() {
            addLogEntry('åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨...', 'info', 'ç³»ç»Ÿ');
            // === æ–°å¢ï¼šä»»åŠ¡ç®¡ç†æŒ‰é’®äº‹ä»¶ ===
            if (addTaskBtn) {
                addTaskBtn.addEventListener('click', addNewTask);
                addLogEntry('æ·»åŠ ä»»åŠ¡æŒ‰é’®ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'ä»»åŠ¡ç®¡ç†');
            }
            if (sortTasksBtn) {
                sortTasksBtn.addEventListener('click', sortTasksByQuadrant);
                addLogEntry('æ™ºèƒ½æ’åºæŒ‰é’®ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'ä»»åŠ¡ç®¡ç†');
            }
            if (clearTasksBtn) {
                clearTasksBtn.addEventListener('click', clearAllTasks);
                addLogEntry('æ¸…ç©ºä»»åŠ¡æŒ‰é’®ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'ä»»åŠ¡ç®¡ç†');
            }
            // æ”¯æŒæŒ‰å›è½¦é”®æ·»åŠ ä»»åŠ¡
            if (newTaskNameInput) {
                newTaskNameInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addNewTask();
                    }
                });
            }
            // ç•ªèŒ„é’Ÿæ§åˆ¶æŒ‰é’®
            if (startBtn) {
                startBtn.addEventListener('click', startPomodoro);
                addLogEntry('å¼€å§‹æŒ‰é’®ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            } else {
                addLogEntry('å¼€å§‹æŒ‰é’®å…ƒç´ ä¸å­˜åœ¨', 'error', 'ç³»ç»Ÿ');
            }
            
            if (pauseBtn) {
                pauseBtn.addEventListener('click', pausePomodoro);
                addLogEntry('æš‚åœæŒ‰é’®ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            } else {
                addLogEntry('æš‚åœæŒ‰é’®å…ƒç´ ä¸å­˜åœ¨', 'error', 'ç³»ç»Ÿ');
            }
            
            if (resetBtn) {
                resetBtn.addEventListener('click', resetPomodoro);
                addLogEntry('é‡ç½®æŒ‰é’®ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            } else {
                addLogEntry('é‡ç½®æŒ‰é’®å…ƒç´ ä¸å­˜åœ¨', 'error', 'ç³»ç»Ÿ');
            }
           // æ–°å¢ï¼šè·³è¿‡ä¼‘æ¯æŒ‰é’®äº‹ä»¶
            if (skipBreakBtn) {
                skipBreakBtn.addEventListener('click', skipBreak);
                addLogEntry('è·³è¿‡ä¼‘æ¯æŒ‰é’®ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            } else {
                addLogEntry('è·³è¿‡ä¼‘æ¯æŒ‰é’®å…ƒç´ ä¸å­˜åœ¨', 'error', 'ç³»ç»Ÿ');
            } 
            // æ§åˆ¶æŒ‰é’®
            if (exportRecordsBtn) {
                exportRecordsBtn.addEventListener('click', exportRecords);
                addLogEntry('å¯¼å‡ºè®°å½•æŒ‰é’®ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            } else {
                addLogEntry('å¯¼å‡ºè®°å½•æŒ‰é’®å…ƒç´ ä¸å­˜åœ¨', 'error', 'ç³»ç»Ÿ');
            }
            
            if (clearRecordsBtn) {
                clearRecordsBtn.addEventListener('click', clearAllRecords);
                addLogEntry('æ¸…ç©ºè®°å½•æŒ‰é’®ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            } else {
                addLogEntry('æ¸…ç©ºè®°å½•æŒ‰é’®å…ƒç´ ä¸å­˜åœ¨', 'error', 'ç³»ç»Ÿ');
            }
            
            // å£°éŸ³æ§åˆ¶
            if (stopSoundBtn) {
                stopSoundBtn.addEventListener('click', stopAllSounds);
                addLogEntry('åœæ­¢å£°éŸ³æŒ‰é’®ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            } else {
                addLogEntry('åœæ­¢å£°éŸ³æŒ‰é’®å…ƒç´ ä¸å­˜åœ¨', 'error', 'ç³»ç»Ÿ');
            }
            
            if (testSoundBtn) {
                testSoundBtn.addEventListener('click', testSound);
                addLogEntry('æµ‹è¯•å£°éŸ³æŒ‰é’®1ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            } else {
                addLogEntry('æµ‹è¯•å£°éŸ³æŒ‰é’®1å…ƒç´ ä¸å­˜åœ¨', 'error', 'ç³»ç»Ÿ');
            }
            
            if (testSoundBtn2) {
                testSoundBtn2.addEventListener('click', testSound);
                addLogEntry('æµ‹è¯•å£°éŸ³æŒ‰é’®2ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            } else {
                addLogEntry('æµ‹è¯•å£°éŸ³æŒ‰é’®2å…ƒç´ ä¸å­˜åœ¨', 'error', 'ç³»ç»Ÿ');
            }
            
            // ä¸­æ–­æ§åˆ¶
            if (startInterruptBtn) {
                startInterruptBtn.addEventListener('click', startInterrupt);
                addLogEntry('å¼€å§‹ä¸­æ–­æŒ‰é’®ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            } else {
                addLogEntry('å¼€å§‹ä¸­æ–­æŒ‰é’®å…ƒç´ ä¸å­˜åœ¨', 'error', 'ç³»ç»Ÿ');
            }
            
            if (cancelInterruptBtn) {
                cancelInterruptBtn.addEventListener('click', cancelInterrupt);
                addLogEntry('å–æ¶ˆä¸­æ–­æŒ‰é’®ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            } else {
                addLogEntry('å–æ¶ˆä¸­æ–­æŒ‰é’®å…ƒç´ ä¸å­˜åœ¨', 'error', 'ç³»ç»Ÿ');
            }
            
            if (clearHistoryBtn) {
                clearHistoryBtn.addEventListener('click', clearHistory);
                addLogEntry('æ¸…ç©ºå†å²æŒ‰é’®ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            } else {
                addLogEntry('æ¸…ç©ºå†å²æŒ‰é’®å…ƒç´ ä¸å­˜åœ¨', 'error', 'ç³»ç»Ÿ');
            }
            
            // å£°éŸ³è®¾ç½®
            if (volumeControl) {
                volumeControl.addEventListener('input', function() {
                    volume = this.value / 100;
                    if (volumeValue) {
                        volumeValue.textContent = this.value + '%';
                    }
                    addLogEntry(`éŸ³é‡è®¾ç½®ä¸º: ${this.value}%`, 'info', 'éŸ³é¢‘');
                });
                addLogEntry('éŸ³é‡æ§åˆ¶ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            } else {
                addLogEntry('éŸ³é‡æ§åˆ¶å…ƒç´ ä¸å­˜åœ¨', 'error', 'ç³»ç»Ÿ');
            }
            
            // å£°éŸ³ç±»å‹é€‰æ‹©
            if (soundOptions && soundOptions.length > 0) {
                soundOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        soundOptions.forEach(opt => opt.classList.remove('active'));
                        this.classList.add('active');
                        currentSoundType = this.dataset.sound;
                        addLogEntry(`å£°éŸ³ç±»å‹åˆ‡æ¢ä¸º: ${currentSoundType}`, 'info', 'éŸ³é¢‘');
                    });
                });
                addLogEntry('å£°éŸ³é€‰é¡¹ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            } else {
                addLogEntry('å£°éŸ³é€‰é¡¹å…ƒç´ ä¸å­˜åœ¨', 'error', 'ç³»ç»Ÿ');
            }
            
            // éœ‡åŠ¨æ§åˆ¶
            if (vibrationToggle) {
                vibrationToggle.addEventListener('change', function() {
                    vibrationEnabled = this.checked;
                    if (vibrationEnabled) {
                        vibrate(50);
                    }
                    addLogEntry(`éœ‡åŠ¨åŠŸèƒ½: ${vibrationEnabled ? 'å¯ç”¨' : 'ç¦ç”¨'}`, 'info', 'è®¾å¤‡');
                });
                addLogEntry('éœ‡åŠ¨æ§åˆ¶ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            } else {
                addLogEntry('éœ‡åŠ¨æ§åˆ¶å…ƒç´ ä¸å­˜åœ¨', 'error', 'ç³»ç»Ÿ');
            }
            
            // ç‚¹å‡»éŸ³æ•ˆæ§åˆ¶
            if (clickSoundToggle) {
                clickSoundToggle.addEventListener('change', function() {
                    clickSoundEnabled = this.checked;
                    addLogEntry(`ç‚¹å‡»éŸ³æ•ˆ: ${clickSoundEnabled ? 'å¯ç”¨' : 'ç¦ç”¨'}`, 'info', 'éŸ³é¢‘');
                });
                addLogEntry('ç‚¹å‡»éŸ³æ•ˆæ§åˆ¶ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            } else {
                addLogEntry('ç‚¹å‡»éŸ³æ•ˆæ§åˆ¶å…ƒç´ ä¸å­˜åœ¨', 'error', 'ç³»ç»Ÿ');
            }
            
            // é¢„è®¾æ—¶é—´æŒ‰é’®
            if (presetTimeButtons && presetTimeButtons.length > 0) {
                presetTimeButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const minutes = parseInt(this.dataset.minutes) || 25;
                        applyPresetTime(minutes);
                    });
                });
                addLogEntry('é¢„è®¾æ—¶é—´æŒ‰é’®ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            } else {
                addLogEntry('é¢„è®¾æ—¶é—´æŒ‰é’®å…ƒç´ ä¸å­˜åœ¨', 'error', 'ç³»ç»Ÿ');
            }
            
            // è‡ªå®šä¹‰æ—¶é—´è®¾ç½®
            if (setCustomTimeBtn) {
                setCustomTimeBtn.addEventListener('click', applyCustomTime);
                addLogEntry('è‡ªå®šä¹‰æ—¶é—´æŒ‰é’®ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            } else {
                addLogEntry('è‡ªå®šä¹‰æ—¶é—´æŒ‰é’®å…ƒç´ ä¸å­˜åœ¨', 'error', 'ç³»ç»Ÿ');
            }
            
            // å¿«é€Ÿæµ‹è¯•ä¸­æ–­æŒ‰é’®
            if (quickTestButtons && quickTestButtons.length > 0) {
                quickTestButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const seconds = parseInt(this.dataset.seconds) || 5;
                        quickTestInterrupt(seconds);
                    });
                });
                addLogEntry('å¿«é€Ÿæµ‹è¯•æŒ‰é’®ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            } else {
                addLogEntry('å¿«é€Ÿæµ‹è¯•æŒ‰é’®å…ƒç´ ä¸å­˜åœ¨', 'error', 'ç³»ç»Ÿ');
            }
            
            // æ—¥å¿—æ§åˆ¶æŒ‰é’®
            if (clearLogBtn) {
                clearLogBtn.addEventListener('click', clearLogs);
                addLogEntry('æ¸…ç©ºæ—¥å¿—æŒ‰é’®ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            } else {
                addLogEntry('æ¸…ç©ºæ—¥å¿—æŒ‰é’®å…ƒç´ ä¸å­˜åœ¨', 'error', 'ç³»ç»Ÿ');
            }
            
            if (toggleLogBtn) {
                toggleLogBtn.addEventListener('click', toggleLogVisibility);
                addLogEntry('åˆ‡æ¢æ—¥å¿—æŒ‰é’®ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            } else {
                addLogEntry('åˆ‡æ¢æ—¥å¿—æŒ‰é’®å…ƒç´ ä¸å­˜åœ¨', 'error', 'ç³»ç»Ÿ');
            }
            
            // è¾“å…¥éªŒè¯
            const timeInputs = [focusTimeInput, breakTimeInput, interruptMinutesInput, interruptSecondsInput];
            timeInputs.forEach(input => {
                if (input) {
                    input.addEventListener('input', function() {
                        let value = parseInt(this.value) || 0;
                        
                        if (this === focusTimeInput || this === breakTimeInput) {
                            if (value < 1) this.value = 1;
                            if (value > 120) this.value = 120;
                        } else if (this === interruptMinutesInput) {
                            if (value < 0) this.value = 0;
                            if (value > 120) this.value = 120;
                        } else if (this === interruptSecondsInput) {
                            if (value < 0) this.value = 0;
                            if (value > 59) this.value = 59;
                        }
                    });
                    addLogEntry(`è¾“å…¥éªŒè¯ç›‘å¬å™¨å·²ç»‘å®š: ${input.id}`, 'success', 'äº‹ä»¶');
                }
            });
            
            // è‡ªå®šä¹‰æ—¶é—´è¾“å…¥
            if (customMinutesInput) {
                customMinutesInput.addEventListener('input', function() {
                    let value = parseInt(this.value) || 1;
                    if (value < 1) this.value = 1;
                    if (value > 120) this.value = 120;
                    addLogEntry(`è‡ªå®šä¹‰æ—¶é—´è¾“å…¥: ${value}åˆ†é’Ÿ`, 'info', 'è¾“å…¥');
                });
                addLogEntry('è‡ªå®šä¹‰æ—¶é—´è¾“å…¥ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            }
            
            // ä¸­æ–­åŸå› è¾“å…¥
            if (interruptReasonInput) {
                interruptReasonInput.addEventListener('input', function() {
                    if (this.value.length > 0) {
                        addLogEntry(`ä¸­æ–­åŸå› è¾“å…¥: ${this.value}`, 'info', 'è¾“å…¥');
                    }
                });
                addLogEntry('ä¸­æ–­åŸå› è¾“å…¥ç›‘å¬å™¨å·²ç»‘å®š', 'success', 'äº‹ä»¶');
            }
            
            addLogEntry('äº‹ä»¶ç›‘å¬å™¨åˆå§‹åŒ–å®Œæˆ', 'success', 'ç³»ç»Ÿ');
        }
        
        // åŠ è½½å†å²è®°å½•
        function loadHistory() {
            try {
                const savedHistory = localStorage.getItem('pomodoroInterruptHistory');
                if (savedHistory) {
                    const allHistory = JSON.parse(savedHistory);
                    currentSessionHistory = allHistory.slice(0, 10).map(item => ({
                        time: new Date(item.timestamp).toLocaleTimeString('zh-CN', {
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit'
                        }),
                        duration: item.duration,
                        reason: item.reason,
                        seconds: item.seconds
                    }));
                    updateHistoryDisplay();
                    addLogEntry('åŠ è½½ä¸­æ–­å†å²æˆåŠŸ', 'success', 'å­˜å‚¨');
                } else {
                    addLogEntry('æ— ä¸­æ–­å†å²è®°å½•', 'info', 'å­˜å‚¨');
                }
            } catch (error) {
                addLogEntry(`åŠ è½½ä¸­æ–­å†å²è®°å½•å¤±è´¥: ${error.message}`, 'error', 'å­˜å‚¨');
            }
        }
        
        // æ£€æŸ¥è®¾å¤‡å…¼å®¹æ€§
        function checkDeviceCompatibility() {
            const compatibilityDiv = document.createElement('div');
            compatibilityDiv.id = 'compatibilityStatus';
            compatibilityDiv.className = 'compatibility-warning hidden';
            
            let warnings = [];
            
            // æ£€æŸ¥Web Audio API
            if (!window.AudioContext && !window.webkitAudioContext) {
                warnings.push('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒWeb Audio APIï¼Œå£°éŸ³åŠŸèƒ½å°†ä¸å¯ç”¨');
            }
            
            // æ£€æŸ¥Vibration API
            if (!navigator.vibrate) {
                warnings.push('æ‚¨çš„è®¾å¤‡ä¸æ”¯æŒéœ‡åŠ¨APIï¼Œéœ‡åŠ¨åŠŸèƒ½å°†ä¸å¯ç”¨');
            }
            
            // æ£€æŸ¥LocalStorage
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
            } catch (e) {
                warnings.push('LocalStorageä¸å¯ç”¨ï¼Œè®°å½•å°†æ— æ³•ä¿å­˜');
            }
            
            if (warnings.length > 0) {
                compatibilityDiv.classList.remove('hidden');
                compatibilityDiv.classList.add('warning');
                
                let warningHTML = '<strong>âš ï¸ å…¼å®¹æ€§è­¦å‘Šï¼š</strong><ul>';
                warnings.forEach(warning => {
                    warningHTML += `<li>${warning}</li>`;
                });
                warningHTML += '</ul>';
                
                compatibilityDiv.innerHTML = warningHTML;
                document.querySelector('.container').insertBefore(compatibilityDiv, document.querySelector('.container').firstChild);
                
                warnings.forEach(warning => {
                    addLogEntry(`å…¼å®¹æ€§è­¦å‘Š: ${warning}`, 'warning', 'ç³»ç»Ÿ');
                });
            } else {
                compatibilityDiv.classList.remove('hidden');
                compatibilityDiv.classList.add('success');
                compatibilityDiv.textContent = 'âœ… è®¾å¤‡å…¼å®¹æ€§æ£€æµ‹é€šè¿‡';
                document.querySelector('.container').insertBefore(compatibilityDiv, document.querySelector('.container').firstChild);
                addLogEntry('è®¾å¤‡å…¼å®¹æ€§æ£€æµ‹é€šè¿‡', 'success', 'ç³»ç»Ÿ');
            }
        }
        
        // æ·»åŠ å…¨å±€ç‚¹å‡»äº‹ä»¶å¤„ç†éŸ³é¢‘æ¿€æ´»
        document.addEventListener('click', async function(event) {
            if (window.userInteracted) return;
            
            if (event.target.tagName !== 'INPUT' && 
                event.target.tagName !== 'TEXTAREA' &&
                event.target.tagName !== 'SELECT') {
                
                addLogEntry('ç”¨æˆ·ç‚¹å‡»ï¼Œå°è¯•æ¿€æ´»éŸ³é¢‘', 'info', 'éŸ³é¢‘');
                
                try {
                    const success = await audioGenerator?.ensureRunning();
                    if (success) {
                        window.userInteracted = true;
                        soundEnabled = true;
                        updateDeviceStatus();
                        addLogEntry('éŸ³é¢‘å·²æ¿€æ´»', 'success', 'éŸ³é¢‘');
                        showStatus('âœ… éŸ³é¢‘å·²æ¿€æ´»ï¼', 2000);
                        await playSound('beep');
                    }
                } catch (error) {
                    addLogEntry(`éŸ³é¢‘æ¿€æ´»å¼‚å¸¸: ${error.message}`, 'error', 'éŸ³é¢‘');
                }
            }
            
            // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ
            if (clickSoundEnabled && window.userInteracted && audioGenerator &&
                event.target.tagName === 'BUTTON' && 
                event.target.id !== 'testSoundBtn' &&
                event.target.id !== 'testSoundBtn2' &&
                event.target.id !== 'stopSoundBtn') {
                
                if (event.target._lastClick && (Date.now() - event.target._lastClick) < 300) {
                    return;
                }
                event.target._lastClick = Date.now();
                
                try {
                    await playClickSound('normal');
                } catch (error) {
                    console.error('ç‚¹å‡»éŸ³æ•ˆå¤±è´¥:', error);
                }
            }
        });
        
        // å…¨å±€é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', async function(event) {
            if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') {
                return;
            }
            
            switch(event.code) {
                case 'Space':
                case 'Enter':
                    event.preventDefault();
                    addLogEntry(`é”®ç›˜å¿«æ·é”®: ${event.code}`, 'info', 'é”®ç›˜');
                    if (isPomodoroRunning) {
                        await pausePomodoro();
                    } else {
                        await startPomodoro();
                    }
                    break;
                case 'KeyR':
                    if (event.ctrlKey || event.metaKey) {
                        event.preventDefault();
                        addLogEntry('é”®ç›˜å¿«æ·é”®: Ctrl+R', 'info', 'é”®ç›˜');
                        await resetPomodoro();
                    }
                    break;
                case 'KeyI':
                    if (!isInterruptRunning) {
                        event.preventDefault();
                        addLogEntry('é”®ç›˜å¿«æ·é”®: I', 'info', 'é”®ç›˜');
                        await startInterrupt();
                    }
                    break;
                case 'Escape':
                    if (isInterruptRunning) {
                        event.preventDefault();
                        addLogEntry('é”®ç›˜å¿«æ·é”®: Escape', 'info', 'é”®ç›˜');
                        await cancelInterrupt();
                    }
                    break;
                case 'KeyL':
                    if (event.ctrlKey || event.metaKey) {
                        event.preventDefault();
                        addLogEntry('é”®ç›˜å¿«æ·é”®: Ctrl+L', 'info', 'é”®ç›˜');
                        toggleLogVisibility();
                    }
                    break;
            }
        });
        // === æ–°å¢ï¼šä»»åŠ¡ç®¡ç†æ ¸å¿ƒå‡½æ•° ===

        // ç¡®å®šä»»åŠ¡æ‰€å±è±¡é™ (1:é‡è¦ç´§æ€¥, 2:é‡è¦ä¸ç´§æ€¥, 3:ç´§æ€¥ä¸é‡è¦, 4:ä¸ç´§æ€¥ä¸é‡è¦)
        function getTaskQuadrant(importance, urgency) {
            if (importance === 'high' && urgency === 'high') return 1;
            if (importance === 'high' && urgency !== 'high') return 2;
            if (importance !== 'high' && urgency === 'high') return 3;
            return 4; // ä½é‡è¦ä½ç´§æ€¥
        }

        // æ·»åŠ æ–°ä»»åŠ¡
        function addNewTask() {
            try {
                const name = newTaskNameInput ? newTaskNameInput.value.trim() : '';
                const importance = taskImportanceSelect ? taskImportanceSelect.value : 'medium';
                const urgency = taskUrgencySelect ? taskUrgencySelect.value : 'medium';
                
                if (!name) {
                    showStatus('âš ï¸ è¯·è¾“å…¥ä»»åŠ¡å†…å®¹', 2000);
                    addLogEntry('æ·»åŠ ä»»åŠ¡å¤±è´¥ï¼šä»»åŠ¡å†…å®¹ä¸ºç©º', 'warning', 'ä»»åŠ¡ç®¡ç†');
                    return;
                }
                
                const newTask = {
                    id: Date.now(), // ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºå”¯ä¸€ID
                    name: name,
                    importance: importance,
                    urgency: urgency,
                    quadrant: getTaskQuadrant(importance, urgency),
                    completed: false,
                    createdAt: new Date().toISOString()
                };
                
                tasks.push(newTask);
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                if (newTaskNameInput) newTaskNameInput.value = '';
                
                // æ›´æ–°æ˜¾ç¤ºå’Œå­˜å‚¨
                updateTasksDisplay();
                saveTasks();
                
                // æ›´æ–°æ¨è
                updateTaskRecommendation();
                
                addLogEntry(`ä»»åŠ¡å·²æ·»åŠ ï¼šâ€œ${name}â€ (è±¡é™${newTask.quadrant})`, 'success', 'ä»»åŠ¡ç®¡ç†');
                showStatus(`âœ… ä»»åŠ¡â€œ${name}â€å·²æ·»åŠ `, 2000);
                
            } catch (error) {
                addLogEntry(`æ·»åŠ ä»»åŠ¡å¤±è´¥: ${error.message}`, 'error', 'ä»»åŠ¡ç®¡ç†');
            }
        }

        // æ›´æ–°ä»»åŠ¡æ˜¾ç¤º
        function updateTasksDisplay() {
            // å…ˆæ¸…ç©ºæ‰€æœ‰è±¡é™åˆ—è¡¨
            Object.values(quadrantLists).forEach(list => {
                if (list) list.innerHTML = '';
            });
            
            // å¦‚æœæ²¡æœ‰ä»»åŠ¡ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€
            if (tasks.length === 0) {
                Object.values(quadrantLists).forEach(list => {
                    if (list) {
                        list.innerHTML = '<div class="empty-quadrant">æš‚æ— ä»»åŠ¡</div>';
                    }
                });
                return;
            }
            
            // æŒ‰è±¡é™åˆ†ç»„ä»»åŠ¡
            const tasksByQuadrant = {1: [], 2: [], 3: [], 4: []};
            
            tasks.forEach(task => {
                if (!task.completed) { // åªæ˜¾ç¤ºæœªå®Œæˆçš„ä»»åŠ¡
                    tasksByQuadrant[task.quadrant].push(task);
                }
            });
            
            // æ¸²æŸ“æ¯ä¸ªè±¡é™çš„ä»»åŠ¡
            Object.entries(tasksByQuadrant).forEach(([quadrantNum, quadrantTasks]) => {
                const listEl = quadrantLists[quadrantNum];
                if (!listEl) return;
                
                if (quadrantTasks.length === 0) {
                    listEl.innerHTML = '<div class="empty-quadrant">æš‚æ— ä»»åŠ¡</div>';
                    return;
                }
                
                let html = '';
                quadrantTasks.forEach(task => {
                    const importanceText = task.importance === 'high' ? 'é‡è¦' : task.importance === 'medium' ? 'ä¸­ç­‰' : 'æ¬¡è¦';
                    const urgencyText = task.urgency === 'high' ? 'ç´§æ€¥' : task.urgency === 'medium' ? 'ä¸­ç­‰' : 'å®½æ¾';
                    
                    html += `
                        <div class="task-item" data-task-id="${task.id}">
                            <div class="task-content">
                                <div class="task-name">${task.name}</div>
                                <div class="task-meta">é‡è¦æ€§ï¼š${importanceText} | ç´§æ€¥æ€§ï¼š${urgencyText}</div>
                            </div>
                            <div class="task-actions">
                                <button class="task-action-btn start" onclick="startTaskPomodoro(${task.id})" title="å¼€å§‹ç•ªèŒ„é’Ÿ">â–¶</button>
                                <button class="task-action-btn complete" onclick="toggleTaskComplete(${task.id})" title="æ ‡è®°å®Œæˆ">âœ“</button>
                                <button class="task-action-btn delete" onclick="deleteTask(${task.id})" title="åˆ é™¤">Ã—</button>
                            </div>
                        </div>
                    `;
                });
                
                listEl.innerHTML = html;
            });
        }

        // æ™ºèƒ½æ’åºï¼ˆæŒ‰è±¡é™ä¼˜å…ˆçº§ï¼‰
        function sortTasksByQuadrant() {
            // 1. å…ˆæŒ‰è±¡é™æ’åºï¼ˆ1 > 2 > 3 > 4ï¼‰
            // 2. åŒè±¡é™å†…æŒ‰åˆ›å»ºæ—¶é—´æ’åºï¼ˆæ–°çš„åœ¨å‰ï¼‰
            tasks.sort((a, b) => {
                if (a.quadrant !== b.quadrant) {
                    return a.quadrant - b.quadrant; // è±¡é™æ•°å­—å°çš„ä¼˜å…ˆçº§é«˜
                }
                return new Date(b.createdAt) - new Date(a.createdAt); // æ—¶é—´è¿‘çš„åœ¨å‰
            });
            
            updateTasksDisplay();
            saveTasks();
            
            addLogEntry('ä»»åŠ¡å·²æŒ‰å››è±¡é™æ™ºèƒ½æ’åº', 'success', 'ä»»åŠ¡ç®¡ç†');
            showStatus('âœ… ä»»åŠ¡å·²æ™ºèƒ½æ’åºï¼Œè¯·ä¼˜å…ˆå¤„ç†ç¬¬ä¸€è±¡é™ä»»åŠ¡', 3000);
            
            // æ›´æ–°æ¨è
            updateTaskRecommendation();
        }

        // æ›´æ–°ä»»åŠ¡æ‰§è¡Œå»ºè®®
        function updateTaskRecommendation() {
            if (!taskRecommendationEl) return;
            
            const pendingTasks = tasks.filter(t => !t.completed);
            
            if (pendingTasks.length === 0) {
                taskRecommendationEl.innerHTML = 'ğŸ‰ æ­å–œï¼æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆã€‚';
                return;
            }
            
            // æŒ‰è±¡é™åˆ†ç»„ç»Ÿè®¡
            const quadrantCounts = {1: 0, 2: 0, 3: 0, 4: 0};
            pendingTasks.forEach(task => {
                quadrantCounts[task.quadrant]++;
            });
            
            let recommendation = '';
            
            if (quadrantCounts[1] > 0) {
                const quadrant1Tasks = pendingTasks.filter(t => t.quadrant === 1);
                recommendation = `<strong>ğŸš¨ ç«‹å³å¤„ç†ï¼ˆ${quadrantCounts[1]}é¡¹é‡è¦ä¸”ç´§æ€¥çš„ä»»åŠ¡ï¼‰</strong><br>`;
                recommendation += `å»ºè®®ä¼˜å…ˆå¤„ç†ï¼š<em>â€œ${quadrant1Tasks[0].name}â€</em>`;
            } else if (quadrantCounts[2] > 0) {
                recommendation = `<strong>ğŸ“… è®¡åˆ’æ‰§è¡Œï¼ˆ${quadrantCounts[2]}é¡¹é‡è¦ä½†ä¸ç´§æ€¥çš„ä»»åŠ¡ï¼‰</strong><br>`;
                recommendation += `è¿™æ˜¯æå‡é•¿æœŸä»·å€¼çš„å…³é”®ï¼Œè¯·å®‰æ’æ—¶é—´ä¸“æ³¨å¤„ç†ã€‚`;
            } else if (quadrantCounts[3] > 0) {
                recommendation = `<strong>âš ï¸ é…Œæƒ…å¤„ç†ï¼ˆ${quadrantCounts[3]}é¡¹ç´§æ€¥ä½†ä¸é‡è¦çš„ä»»åŠ¡ï¼‰</strong><br>`;
                recommendation += `è€ƒè™‘å§”æ‰˜æˆ–æ‰¹é‡å¤„ç†ï¼Œé¿å…å ç”¨è¿‡å¤šä¸“æ³¨æ—¶é—´ã€‚`;
            } else {
                recommendation = `<strong>ğŸ•’ ç©ºé—²å¤„ç†ï¼ˆ${quadrantCounts[4]}é¡¹ä¸ç´§æ€¥ä¸é‡è¦çš„ä»»åŠ¡ï¼‰</strong><br>`;
                recommendation += `å¯ä»¥åœ¨ä¼‘æ¯æ—¶é—´æˆ–ç²¾åŠ›ä¸è¶³æ—¶å¤„ç†ã€‚`;
            }
            
            taskRecommendationEl.innerHTML = recommendation;
        }

        // å¼€å§‹ä»»åŠ¡çš„ç•ªèŒ„é’Ÿ
        function startTaskPomodoro(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            // 1. å°†ä»»åŠ¡åç§°å¡«å…¥ç•ªèŒ„é’Ÿçš„ä»»åŠ¡è¾“å…¥æ¡†
            const taskNameInput = document.getElementById('taskNameInput');
            if (taskNameInput) {
                taskNameInput.value = task.name;
                // è§¦å‘inputäº‹ä»¶ä»¥ç¡®ä¿currentTaskNameè¢«æ›´æ–°
                taskNameInput.dispatchEvent(new Event('input', { bubbles: true }));
            }
            
            // 2. é«˜äº®æ˜¾ç¤ºé€‰ä¸­çš„ä»»åŠ¡ï¼ˆå¯é€‰è§†è§‰åé¦ˆï¼‰
            const taskElement = document.querySelector(`[data-task-id="${taskId}"]`);
            if (taskElement) {
                taskElement.style.backgroundColor = '#e3f2fd';
                setTimeout(() => {
                    taskElement.style.backgroundColor = '';
                }, 1000);
            }
            
            // 3. å¼€å§‹ç•ªèŒ„é’Ÿï¼ˆå¦‚æœæœªè¿è¡Œï¼‰
            if (!isPomodoroRunning) {
                // è¿™é‡Œå¯ä»¥è‡ªåŠ¨å¼€å§‹ç•ªèŒ„é’Ÿï¼Œæˆ–è€…åªæ˜¯æç¤ºç”¨æˆ·
                showStatus(`ğŸ¯ å·²é€‰æ‹©ä»»åŠ¡â€œ${task.name}â€ï¼Œç‚¹å‡»â€œå¼€å§‹â€æŒ‰é’®å¯åŠ¨ç•ªèŒ„é’Ÿ`, 3000);
                addLogEntry(`é€‰ä¸­ä»»åŠ¡å‡†å¤‡ä¸“æ³¨: "${task.name}"`, 'info', 'ä»»åŠ¡ç®¡ç†');
            } else {
                showStatus(`ğŸ¯ å·²ä¸ºå½“å‰ç•ªèŒ„é’Ÿè®¾ç½®ä»»åŠ¡ï¼šâ€œ${task.name}â€`, 3000);
                addLogEntry(`ä¸ºè¿›è¡Œä¸­çš„ç•ªèŒ„é’Ÿè®¾ç½®ä»»åŠ¡: "${task.name}"`, 'info', 'ä»»åŠ¡ç®¡ç†');
            }
        }

        // åˆ‡æ¢ä»»åŠ¡å®ŒæˆçŠ¶æ€
        function toggleTaskComplete(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            task.completed = !task.completed;
            
            updateTasksDisplay();
            saveTasks();
            updateTaskRecommendation();
            
            const action = task.completed ? 'å®Œæˆ' : 'æ¢å¤';
            addLogEntry(`ä»»åŠ¡â€œ${task.name}â€æ ‡è®°ä¸º${action}`, 'info', 'ä»»åŠ¡ç®¡ç†');
            showStatus(`âœ… ä»»åŠ¡â€œ${task.name}â€å·²${action}`, 2000);
        }

        // åˆ é™¤ä»»åŠ¡
        function deleteTask(taskId) {
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex === -1) return;
            
            const taskName = tasks[taskIndex].name;
            tasks.splice(taskIndex, 1);
            
            updateTasksDisplay();
            saveTasks();
            updateTaskRecommendation();
            
            addLogEntry(`ä»»åŠ¡â€œ${taskName}â€å·²åˆ é™¤`, 'info', 'ä»»åŠ¡ç®¡ç†');
            showStatus(`ğŸ—‘ï¸ ä»»åŠ¡â€œ${taskName}â€å·²åˆ é™¤`, 2000);
        }

        // æ¸…ç©ºæ‰€æœ‰ä»»åŠ¡
        function clearAllTasks() {
            if (tasks.length === 0) {
                showStatus('ğŸ“­ ä»»åŠ¡åˆ—è¡¨å·²ä¸ºç©º', 2000);
                return;
            }
            
            if (confirm(`ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ ${tasks.length} é¡¹ä»»åŠ¡å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`)) {
                tasks = [];
                updateTasksDisplay();
                saveTasks();
                updateTaskRecommendation();
                
                addLogEntry('æ‰€æœ‰ä»»åŠ¡å·²æ¸…ç©º', 'warning', 'ä»»åŠ¡ç®¡ç†');
                showStatus('ğŸ—‘ï¸ æ‰€æœ‰ä»»åŠ¡å·²æ¸…ç©º', 2000);
            }
        }

        // ä¿å­˜ä»»åŠ¡åˆ°æœ¬åœ°å­˜å‚¨
        function saveTasks() {
            try {
                localStorage.setItem('pomodoroTasks', JSON.stringify(tasks));
            } catch (error) {
                addLogEntry(`ä¿å­˜ä»»åŠ¡å¤±è´¥: ${error.message}`, 'error', 'ä»»åŠ¡ç®¡ç†');
            }
        }

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½ä»»åŠ¡
        function loadTasks() {
            try {
                const savedTasks = localStorage.getItem('pomodoroTasks');
                if (savedTasks) {
                    tasks = JSON.parse(savedTasks);
                    updateTasksDisplay();
                    updateTaskRecommendation();
                    addLogEntry(`å·²åŠ è½½ ${tasks.length} é¡¹ä»»åŠ¡`, 'success', 'ä»»åŠ¡ç®¡ç†');
                }
            } catch (error) {
                addLogEntry(`åŠ è½½ä»»åŠ¡å¤±è´¥: ${error.message}`, 'error', 'ä»»åŠ¡ç®¡ç†');
                tasks = [];
            }
        }
        // åˆå§‹åŒ–åº”ç”¨
        async function initApp() {
            try {
                addLogEntry('åˆå§‹åŒ–ç•ªèŒ„é’Ÿåº”ç”¨ v6.2.0', 'info', 'ç³»ç»Ÿ');
                addLogEntry(`ç”¨æˆ·ä»£ç†: ${navigator.userAgent}`, 'info', 'ç³»ç»Ÿ');
                addLogEntry(`å¹³å°: ${navigator.platform}`, 'info', 'ç³»ç»Ÿ');
                
                // åˆå§‹åŒ–éŸ³é¢‘
                await initAudioSystem();
               // åŠ è½½ä»»åŠ¡æ•°æ®
                loadTasks(); // æ–°å¢è¿™è¡Œ 
                // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
                initEventListeners();
                
                // åŠ è½½å†å²è®°å½•
                loadHistory();
                
                // åŠ è½½ç•ªèŒ„é’Ÿè®°å½•
                loadRecords();
                
                // æ£€æŸ¥éŸ³é¢‘ä¸Šä¸‹æ–‡çŠ¶æ€
                checkAudioContextStatus();
                
                // æ›´æ–°åˆå§‹çŠ¶æ€
                const focusMinutes = focusTimeInput ? parseInt(focusTimeInput.value) || 25 : 25;
                pomodoroSeconds = focusMinutes * 60;
                updateTimerDisplay(pomodoroSeconds);
                updatePomodoroStatus();
                
                // æ£€æŸ¥è®¾å¤‡å…¼å®¹æ€§
                checkDeviceCompatibility();
                
                // åˆå§‹åŒ–å®Œæˆ
                addLogEntry('åº”ç”¨åˆå§‹åŒ–å®Œæˆ', 'success', 'ç³»ç»Ÿ');
                showStatus('ç•ªèŒ„é’Ÿv6.2.0å·²å°±ç»ªï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨ï¼', 3000);
                
            } catch (error) {
                addLogEntry(`åº”ç”¨åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error', 'ç³»ç»Ÿ');
                showStatus('åº”ç”¨åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 5000);
                console.error('åˆå§‹åŒ–é”™è¯¯:', error);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addLogEntry('DOMå·²åŠ è½½ï¼Œå¼€å§‹åˆå§‹åŒ–åº”ç”¨...', 'info', 'ç³»ç»Ÿ');
            
            // æ£€æŸ¥å…³é”®å…ƒç´ 
            const requiredElements = {
                'startBtn': startBtn,
                'pauseBtn': pauseBtn,
                'resetBtn': resetBtn,
                'timerDisplay': timerDisplay,
                'statusBar': statusBar,
                'focusTimeInput': focusTimeInput,
                'breakTimeInput': breakTimeInput
            };
            
            Object.entries(requiredElements).forEach(([name, element]) => {
                if (element) {
                    addLogEntry(`âœ… ${name} å…ƒç´ å­˜åœ¨`, 'success', 'ç³»ç»Ÿ');
                } else {
                    addLogEntry(`âŒ ${name} å…ƒç´ ä¸å­˜åœ¨`, 'error', 'ç³»ç»Ÿ');
                }
            });
            
            // åˆå§‹åŒ–åº”ç”¨
            initApp();
            
            // è®¾ç½®ç”¨æˆ·æ¿€æ´»æ£€æŸ¥
            setTimeout(() => {
                if (!window.userInteracted) {
                    addLogEntry('ç­‰å¾…ç”¨æˆ·äº¤äº’æ¿€æ´»éŸ³é¢‘', 'warning', 'éŸ³é¢‘');
                    showStatus('è¯·ç‚¹å‡»ä»»æ„ä½ç½®æ¿€æ´»å£°éŸ³åŠŸèƒ½', 0);
                }
            }, 2000);
            
            // æœ€ç»ˆçŠ¶æ€æ£€æŸ¥
            setTimeout(() => {
                addLogEntry('æœ€ç»ˆçŠ¶æ€æ£€æŸ¥:', 'info', 'ç³»ç»Ÿ');
                
                const ctx = audioGenerator ? audioGenerator.getAudioContext() : null;
                if (ctx && ctx.state) {
                    addLogEntry(`AudioContextçŠ¶æ€: ${ctx.state}`, ctx.state === 'running' ? 'success' : 'warning', 'éŸ³é¢‘');
                } else {
                    addLogEntry('AudioContext: æœªåˆ›å»ºæˆ–ä¸å¯ç”¨', 'warning', 'éŸ³é¢‘');
                }
                
                addLogEntry(`éŸ³é¢‘çŠ¶æ€: ${soundEnabled ? 'æ­£å¸¸' : 'å¼‚å¸¸'}`, soundEnabled ? 'success' : 'warning', 'éŸ³é¢‘');
                addLogEntry(`ç•ªèŒ„é’ŸçŠ¶æ€: ${isPomodoroRunning ? 'è¿è¡Œä¸­' : 'åœæ­¢'}`, 'info', 'ç•ªèŒ„é’Ÿ');
                addLogEntry(`ç”¨æˆ·äº¤äº’: ${window.userInteracted ? 'æ˜¯' : 'å¦'}`, window.userInteracted ? 'success' : 'warning', 'ç³»ç»Ÿ');
                addLogEntry(`ç‚¹å‡»éŸ³æ•ˆ: ${clickSoundEnabled ? 'å¼€å¯' : 'å…³é—­'}`, 'info', 'éŸ³é¢‘');
                addLogEntry(`è®°å½•æ¡æ•°: ${pomodoroRecords.length}`, 'info', 'è®°å½•');
                addLogEntry(`ä»Šæ—¥å®Œæˆ: ${todayCompleted}`, 'info', 'ç»Ÿè®¡');
                addLogEntry(`æ€»å®Œæˆ: ${totalCompleted}`, 'info', 'ç»Ÿè®¡');
            }, 3000);
            
            // å…¨å±€é”™è¯¯å¤„ç†
            window.addEventListener('error', (event) => {
                addLogEntry(`å…¨å±€JavaScripté”™è¯¯: ${event.message}`, 'error', 'ç³»ç»Ÿ');
                console.error("ğŸš¨ å…¨å±€JavaScripté”™è¯¯:", event.error);
            });
            
            // æœªå¤„ç†çš„Promiseæ‹’ç»
            window.addEventListener('unhandledrejection', (event) => {
                addLogEntry(`æœªå¤„ç†çš„Promiseæ‹’ç»: ${event.reason}`, 'error', 'ç³»ç»Ÿ');
                console.error("ğŸš¨ æœªå¤„ç†çš„Promiseæ‹’ç»:", event.reason);
            });
            
            addLogEntry('ğŸ¯ ç•ªèŒ„é’Ÿv6.2.0 å®Œå…¨åŠ è½½å®Œæˆï¼', 'success', 'ç³»ç»Ÿ');
        });
        
        // é¡µé¢å¯è§æ€§å˜åŒ–å¤„ç†
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                addLogEntry('é¡µé¢éšè—', 'info', 'ç³»ç»Ÿ');
            } else {
                addLogEntry('é¡µé¢å¯è§', 'info', 'ç³»ç»Ÿ');
            }
        });
        
        // é¡µé¢å¸è½½å‰ä¿å­˜æ•°æ®
        window.addEventListener('beforeunload', () => {
            saveRecords();
            addLogEntry('é¡µé¢å¸è½½ï¼Œä¿å­˜æ•°æ®', 'info', 'ç³»ç»Ÿ');
        });
        
        // è§¦æ‘¸åé¦ˆ
        document.addEventListener('touchstart', (e) => {
            if (e.target.tagName === 'BUTTON' || e.target.tagName === 'A' || 
                e.target.classList.contains('preset-time')) {
                e.target.classList.add('touch-feedback');
            }
        }, { passive: true });
        
        document.addEventListener('touchend', (e) => {
            if (e.target.tagName === 'BUTTON' || e.target.tagName === 'A' || 
                e.target.classList.contains('preset-time')) {
                setTimeout(() => {
                    e.target.classList.remove('touch-feedback');
                }, 150);
            }
        }, { passive: true });
    </script>
</body>
</html>
