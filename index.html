<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç•ªèŒ„é’Ÿä¸“æ³¨è®¡æ—¶å™¨ v6.3.0</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* åŸºç¡€é‡ç½®å’Œå…¨å±€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --primary-color: #4a6fa5;
            --primary-dark: #385d8a;
            --primary-light: #6b8cbc;
            --secondary-color: #ff9a76;
            --secondary-dark: #e68966;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #3498db;
            --light-color: #f8f9fa;
            --dark-color: #2c3e50;
            --gray-color: #95a5a6;
            --light-gray: #ecf0f1;
            --border-radius: 12px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark-color);
            line-height: 1.6;
            min-height: 100vh;
            padding: 15px;
            overflow-x: hidden;
        }
        
        /* å®¹å™¨å’Œå¸ƒå±€ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 10px;
        }
        
        .app-header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px 0;
        }
        
        .app-title {
            font-size: 2.2rem;
            color: var(--primary-color);
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .app-subtitle {
            font-size: 1rem;
            color: var(--gray-color);
            max-width: 600px;
            margin: 0 auto 20px;
        }
        
        /* ä¸»å†…å®¹ç½‘æ ¼å¸ƒå±€ */
        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (min-width: 768px) {
            .main-content {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        @media (min-width: 992px) {
            .main-content {
                grid-template-columns: 2fr 1fr;
            }
        }
        
        /* å¡ç‰‡é€šç”¨æ ·å¼ */
        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 20px;
            transition: var(--transition);
        }
        
        .card:hover {
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
        }
        
        .card-title {
            font-size: 1.3rem;
            color: var(--dark-color);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-title i {
            color: var(--primary-color);
        }
        
        /* ç•ªèŒ„é’Ÿè®¡æ—¶å™¨å¡ç‰‡ */
        .timer-card {
            grid-column: 1;
        }
        
        .timer-display-container {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .timer-display {
            font-family: 'Courier New', monospace;
            font-size: 4.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }
        
        .timer-status {
            font-size: 1.3rem;
            color: var(--gray-color);
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        /* æ§åˆ¶æŒ‰é’®ç»„ */
        .control-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-primary {
            background: linear-gradient(to right, var(--primary-color), var(--primary-light));
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(to right, var(--secondary-color), var(--secondary-dark));
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(to right, var(--warning-color), #f1c40f);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(to right, var(--danger-color), #c0392b);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(to right, var(--success-color), #27ae60);
            color: white;
        }
        
        .btn-info {
            background: linear-gradient(to right, var(--info-color), #2980b9);
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }
        
        /* è®¾ç½®åŒºåŸŸ */
        .settings-group {
            margin-bottom: 25px;
        }
        
        .settings-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .settings-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .time-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .time-input {
            width: 80px;
            padding: 12px 15px;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            font-size: 1.1rem;
            text-align: center;
            transition: var(--transition);
        }
        
        .time-input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
        }
        
        .time-label {
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .preset-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .preset-time {
            padding: 10px 18px;
            background: var(--light-gray);
            border: none;
            border-radius: 8px;
            color: var(--dark-color);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .preset-time:hover {
            background: var(--primary-color);
            color: white;
        }
        
        .session-name-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .session-name-input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
        }
        
        /* ä¸­æ–­è®¡æ—¶å™¨å¡ç‰‡ */
        .interrupt-card {
            grid-column: 1;
        }
        
        .interrupt-timer {
            text-align: center;
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--danger-color);
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            display: none;
        }
        
        .interrupt-timer.show {
            display: block;
            animation: pulse 1.5s infinite;
        }
        
        .interrupt-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        /* å£°éŸ³è®¾ç½®å¡ç‰‡ */
        .sound-card {
            grid-column: 1;
        }
        
        .volume-control {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .volume-slider {
            flex-grow: 1;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 4px;
            background: var(--light-gray);
            outline: none;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .volume-value {
            font-weight: 600;
            min-width: 50px;
            text-align: right;
        }
        
        .sound-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .sound-option {
            flex: 1;
            min-width: 120px;
            padding: 12px 15px;
            background: var(--light-gray);
            border: 2px solid transparent;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .sound-option:hover {
            background: #e0e6f0;
        }
        
        .sound-option.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-dark);
        }
        
        .sound-test-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        /* åˆ‡æ¢å¼€å…³ */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        .toggle-label {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        /* è®°å½•å’Œç»Ÿè®¡å¡ç‰‡ */
        .stats-card {
            grid-column: 1;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-item {
            background: var(--light-gray);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--gray-color);
        }
        
        .record-list {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .record-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .record-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .record-list::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        .record-list::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        .record-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            transition: var(--transition);
        }
        
        .record-item:hover {
            background-color: #f9f9f9;
        }
        
        .record-info {
            display: flex;
            flex-direction: column;
        }
        
        .record-time {
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .record-name {
            font-size: 0.9rem;
            color: var(--gray-color);
            margin-top: 3px;
        }
        
        .record-duration {
            font-size: 0.9rem;
            color: var(--gray-color);
        }
        
        .record-type {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .record-type.focus {
            background-color: rgba(46, 204, 113, 0.2);
            color: #27ae60;
        }
        
        .record-type.break {
            background-color: rgba(52, 152, 219, 0.2);
            color: #2980b9;
        }
        
        .no-records {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-color);
            font-style: italic;
        }
        
        /* å†å²è®°å½•å¡ç‰‡ */
        .history-card {
            grid-column: 1;
        }
        
        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .history-item {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            transition: var(--transition);
        }
        
        .history-item:hover {
            background-color: #f9f9f9;
        }
        
        .history-time {
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 5px;
        }
        
        .history-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--gray-color);
        }
        
        .empty-history {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-color);
            font-style: italic;
        }
        
        /* æ—¥å¿—å¡ç‰‡ */
        .log-card {
            grid-column: 1;
        }
        
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .log-controls {
            display: flex;
            gap: 10px;
        }
        
        .log-content {
            max-height: 300px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
        }
        
        .log-entry {
            padding: 8px 10px;
            margin-bottom: 8px;
            border-left: 4px solid var(--gray-color);
            background: white;
            border-radius: 4px;
        }
        
        .log-entry.success {
            border-left-color: var(--success-color);
        }
        
        .log-entry.warning {
            border-left-color: var(--warning-color);
        }
        
        .log-entry.error {
            border-left-color: var(--danger-color);
        }
        
        .log-entry.info {
            border-left-color: var(--info-color);
        }
        
        .log-timestamp {
            color: var(--gray-color);
            margin-right: 10px;
        }
        
        .log-module {
            display: inline-block;
            padding: 2px 8px;
            background: var(--light-gray);
            border-radius: 10px;
            font-size: 0.75rem;
            margin-right: 10px;
        }
        
        /* çŠ¶æ€æ  */
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--dark-color);
            color: white;
            padding: 12px 20px;
            font-size: 0.9rem;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .status-bar.show {
            transform: translateY(0);
        }
        
        /* å…¼å®¹æ€§è­¦å‘Š */
        .compatibility-warning {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
        }
        
        .compatibility-warning.warning {
            background-color: rgba(231, 76, 60, 0.1);
            border-left: 5px solid var(--danger-color);
        }
        
        .compatibility-warning.success {
            background-color: rgba(46, 204, 113, 0.1);
            border-left: 5px solid var(--success-color);
        }
        
        .compatibility-warning.hidden {
            display: none;
        }
        
        /* åŠ¨ç”» */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        /* è§¦æ‘¸åé¦ˆ */
        .touch-feedback {
            transform: scale(0.95);
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 767px) {
            .container {
                padding: 0 8px;
            }
            
            .app-title {
                font-size: 1.8rem;
            }
            
            .timer-display {
                font-size: 3.5rem;
            }
            
            .control-buttons {
                gap: 10px;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 0.9rem;
            }
            
            .card {
                padding: 15px;
            }
            
            .card-title {
                font-size: 1.1rem;
            }
            
            .settings-row {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .time-input-group {
                width: 100%;
                justify-content: space-between;
            }
            
            .interrupt-controls {
                flex-direction: column;
            }
        }
        
        @media (max-width: 480px) {
            .timer-display {
                font-size: 2.8rem;
            }
            
            .control-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* å°å±å¹•è®¾å¤‡ä¼˜åŒ– */
        @media (max-width: 320px) {
            .app-title {
                font-size: 1.5rem;
            }
            
            .timer-display {
                font-size: 2.2rem;
            }
            
            .time-input {
                width: 70px;
                padding: 10px;
            }
        }
        
        /* iOS Safari ç‰¹å®šä¼˜åŒ– */
        @supports (-webkit-touch-callout: none) {
            .btn, .preset-time, .sound-option {
                -webkit-tap-highlight-color: transparent;
            }
            
            .time-input, .session-name-input, select, textarea {
                font-size: 16px; /* é˜²æ­¢iOSç¼©æ”¾ */
            }
        }
        
        /* æš—è‰²æ¨¡å¼æ”¯æŒ */
        @media (prefers-color-scheme: dark) {
            :root {
                --light-color: #1a1a2e;
                --dark-color: #e0e0e0;
                --light-gray: #2d3047;
            }
            
            body {
                background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
                color: var(--dark-color);
            }
            
            .card {
                background: #16213e;
                color: var(--dark-color);
            }
            
            .card-title {
                color: var(--dark-color);
                border-bottom-color: #2d3047;
            }
            
            .time-input, .session-name-input {
                background: #2d3047;
                border-color: #3a3d5e;
                color: var(--dark-color);
            }
            
            .record-item:hover, .history-item:hover {
                background-color: #2d3047;
            }
            
            .no-records, .empty-history {
                color: #8a8a8a;
            }
            
            .log-content {
                background: #2d3047;
            }
            
            .log-entry {
                background: #1a1a2e;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å…¼å®¹æ€§è­¦å‘ŠåŒºåŸŸ -->
        <div id="compatibilityStatus" class="compatibility-warning hidden"></div>
        
        <!-- åº”ç”¨æ ‡é¢˜ -->
        <div class="app-header">
            <h1 class="app-title">ğŸ… ç•ªèŒ„é’Ÿä¸“æ³¨è®¡æ—¶å™¨</h1>
            <p class="app-subtitle">ä¸“æ³¨å·¥ä½œï¼Œå®šæ—¶ä¼‘æ¯ï¼Œæé«˜æ•ˆç‡ | ç‰ˆæœ¬ 6.3.0</p>
        </div>
        
        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- ç•ªèŒ„é’Ÿè®¡æ—¶å™¨ -->
            <div class="card timer-card">
                <h2 class="card-title"><i class="fas fa-clock"></i> ç•ªèŒ„é’Ÿè®¡æ—¶å™¨</h2>
                
                <div class="timer-display-container">
                    <div id="pomodoroStatus" class="timer-status">ğŸ¯ å‡†å¤‡å¼€å§‹ä¸“æ³¨</div>
                    <div id="timerDisplay" class="timer-display">25:00</div>
                </div>
                
                <!-- æ–°å¢ï¼šç•ªèŒ„é’Ÿå‘½åè¾“å…¥ -->
                <div class="settings-group">
                    <label for="sessionName" class="settings-label">ğŸ… ç•ªèŒ„é’Ÿåç§° (å¯é€‰)</label>
                    <input type="text" id="sessionName" class="session-name-input" placeholder="ä¾‹å¦‚ï¼šé¡¹ç›®Aå¼€å‘ã€å­¦ä¹ è‹±è¯­ã€é˜…è¯»è®ºæ–‡..." maxlength="50">
                </div>
                
                <div class="control-buttons">
                    <button id="startBtn" class="btn btn-primary">
                        <i class="fas fa-play"></i> å¼€å§‹ä¸“æ³¨
                    </button>
                    <button id="pauseBtn" class="btn btn-warning" disabled>
                        <i class="fas fa-pause"></i> æš‚åœ
                    </button>
                    <button id="resetBtn" class="btn btn-outline">
                        <i class="fas fa-redo"></i> é‡ç½®
                    </button>
                </div>
                
                <!-- ç•ªèŒ„é’Ÿæ—¶é—´è®¾ç½® -->
                <div class="settings-group">
                    <div class="settings-row">
                        <div>
                            <label for="focusTime" class="settings-label">ä¸“æ³¨æ—¶é—´ (åˆ†é’Ÿ)</label>
                            <input type="number" id="focusTime" class="time-input" min="1" max="120" value="25">
                        </div>
                        <div>
                            <label for="breakTime" class="settings-label">ä¼‘æ¯æ—¶é—´ (åˆ†é’Ÿ)</label>
                            <input type="number" id="breakTime" class="time-input" min="1" max="60" value="5">
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <label class="settings-label">å¿«é€Ÿè®¾ç½®</label>
                        <div class="preset-buttons">
                            <button class="preset-time" data-minutes="15">15åˆ†é’Ÿ</button>
                            <button class="preset-time" data-minutes="25">25åˆ†é’Ÿ</button>
                            <button class="preset-time" data-minutes="30">30åˆ†é’Ÿ</button>
                            <button class="preset-time" data-minutes="45">45åˆ†é’Ÿ</button>
                            <button class="preset-time" data-minutes="60">60åˆ†é’Ÿ</button>
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <div class="settings-row">
                            <input type="number" id="customMinutes" class="time-input" min="1" max="120" placeholder="è‡ªå®šä¹‰" value="25">
                            <button id="setCustomTimeBtn" class="btn btn-outline">
                                <i class="fas fa-check"></i> åº”ç”¨
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ä¸­æ–­è®¡æ—¶å™¨ -->
            <div class="card interrupt-card">
                <h2 class="card-title"><i class="fas fa-stopwatch"></i> ä¸­æ–­è®¡æ—¶å™¨</h2>
                
                <div id="interruptTimerDisplay" class="interrupt-timer">00:00</div>
                
                <div class="settings-group">
                    <div class="settings-row">
                        <div class="time-input-group">
                            <input type="number" id="interruptMinutes" class="time-input" min="0" max="120" value="0">
                            <span class="time-label">åˆ†é’Ÿ</span>
                        </div>
                        <div class="time-input-group">
                            <input type="number" id="interruptSeconds" class="time-input" min="0" max="59" value="30">
                            <span class="time-label">ç§’</span>
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <label for="interruptReason" class="settings-label">ä¸­æ–­åŸå›  (å¯é€‰)</label>
                        <input type="text" id="interruptReason" class="session-name-input" placeholder="ä¾‹å¦‚ï¼šæ¥ç”µè¯ã€å–æ°´ã€å›å¤æ¶ˆæ¯...">
                    </div>
                    
                    <div class="interrupt-controls">
                        <button id="startInterruptBtn" class="btn btn-danger">
                            <i class="fas fa-hourglass-start"></i> å¼€å§‹ä¸­æ–­
                        </button>
                        <button id="cancelInterruptBtn" class="btn btn-outline" style="display: none;">
                            <i class="fas fa-times"></i> å–æ¶ˆä¸­æ–­
                        </button>
                    </div>
                    
                    <div class="settings-group">
                        <label class="settings-label">å¿«é€Ÿæµ‹è¯•</label>
                        <div class="preset-buttons">
                            <button class="btn btn-outline quick-test-btn" data-seconds="5">5ç§’</button>
                            <button class="btn btn-outline quick-test-btn" data-seconds="10">10ç§’</button>
                            <button class="btn btn-outline quick-test-btn" data-seconds="30">30ç§’</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- å£°éŸ³è®¾ç½® -->
            <div class="card sound-card">
                <h2 class="card-title"><i class="fas fa-volume-up"></i> å£°éŸ³è®¾ç½®</h2>
                
                <div class="settings-group">
                    <label class="settings-label">éŸ³é‡æ§åˆ¶</label>
                    <div class="volume-control">
                        <i class="fas fa-volume-down"></i>
                        <input type="range" id="volumeControl" class="volume-slider" min="0" max="100" value="50">
                        <i class="fas fa-volume-up"></i>
                        <span id="volumeValue" class="volume-value">50%</span>
                    </div>
                </div>
                
                <div class="settings-group">
                    <label class="settings-label">æç¤ºéŸ³ç±»å‹</label>
                    <div class="sound-options">
                        <div class="sound-option active" data-sound="beep">
                            <i class="fas fa-bell"></i> èœ‚é¸£å£°
                        </div>
                        <div class="sound-option" data-sound="bell">
                            <i class="fas fa-bell"></i> é’Ÿå£°
                        </div>
                        <div class="sound-option" data-sound="chord">
                            <i class="fas fa-music"></i> å’Œå¼¦
                        </div>
                    </div>
                </div>
                
                <div class="settings-group">
                    <div class="toggle-label">
                        <input type="checkbox" id="vibrationToggle" class="toggle-switch" checked>
                        <label for="vibrationToggle">éœ‡åŠ¨æé†’</label>
                    </div>
                    
                    <div class="toggle-label">
                        <input type="checkbox" id="clickSoundToggle" class="toggle-switch" checked>
                        <label for="clickSoundToggle">ç‚¹å‡»éŸ³æ•ˆ</label>
                    </div>
                </div>
                
                <div class="settings-group">
                    <label class="settings-label">å£°éŸ³æµ‹è¯•</label>
                    <div class="sound-test-buttons">
                        <button id="testSoundBtn" class="btn btn-info">
                            <i class="fas fa-play"></i> æµ‹è¯•å£°éŸ³
                        </button>
                        <button id="testSoundBtn2" class="btn btn-outline">
                            <i class="fas fa-play-circle"></i> æµ‹è¯•
                        </button>
                        <button id="stopSoundBtn" class="btn btn-outline">
                            <i class="fas fa-stop"></i> åœæ­¢
                        </button>
                    </div>
                </div>
                
                <div class="settings-group">
                    <div id="deviceStatus" class="stat-label">ğŸ”§ éŸ³é¢‘çŠ¶æ€æ£€æµ‹ä¸­...</div>
                </div>
            </div>
            
            <!-- è®°å½•å’Œç»Ÿè®¡ -->
            <div class="card stats-card">
                <h2 class="card-title"><i class="fas fa-chart-bar"></i> è®°å½•å’Œç»Ÿè®¡</h2>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <div id="todayCompleted" class="stat-value">0</div>
                        <div class="stat-label">ä»Šæ—¥å®Œæˆ</div>
                    </div>
                    <div class="stat-item">
                        <div id="totalCompleted" class="stat-value">0</div>
                        <div class="stat-label">æ€»è®¡å®Œæˆ</div>
                    </div>
                    <div class="stat-item">
                        <div id="totalFocusTime" class="stat-value">0.0</div>
                        <div class="stat-label">æ€»ä¸“æ³¨(å°æ—¶)</div>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h3 class="settings-label">æœ€è¿‘è®°å½•</h3>
                    <div id="recordList" class="record-list">
                        <div class="no-records">æš‚æ— è®°å½•ï¼Œå¼€å§‹æ‚¨çš„ç¬¬ä¸€ä¸ªç•ªèŒ„é’Ÿå§ï¼</div>
                    </div>
                </div>
                
                <div class="control-buttons">
                    <button id="exportRecordsBtn" class="btn btn-outline">
                        <i class="fas fa-download"></i> å¯¼å‡ºè®°å½•
                    </button>
                    <button id="clearRecordsBtn" class="btn btn-outline">
                        <i class="fas fa-trash"></i> æ¸…ç©ºè®°å½•
                    </button>
                </div>
            </div>
            
            <!-- ä¸­æ–­å†å² -->
            <div class="card history-card">
                <h2 class="card-title"><i class="fas fa-history"></i> ä¸­æ–­å†å²</h2>
                
                <div id="historyList" class="history-list">
                    <div class="empty-history">æš‚æ— ä¸­æ–­è®°å½•</div>
                </div>
                
                <div class="control-buttons">
                    <button id="clearHistoryBtn" class="btn btn-outline">
                        <i class="fas fa-trash-alt"></i> æ¸…é™¤å†å²
                    </button>
                </div>
            </div>
            
            <!-- ç³»ç»Ÿæ—¥å¿— -->
            <div class="card log-card">
                <div class="log-header">
                    <h2 class="card-title"><i class="fas fa-clipboard-list"></i> ç³»ç»Ÿæ—¥å¿—</h2>
                    <div class="log-controls">
                        <button id="toggleLogBtn" class="btn btn-outline">
                            <i class="fas fa-eye-slash"></i> éšè—æ—¥å¿—
                        </button>
                        <button id="clearLogBtn" class="btn btn-outline">
                            <i class="fas fa-broom"></i> æ¸…ç©ºæ—¥å¿—
                        </button>
                    </div>
                </div>
                
                <div id="logContent" class="log-content">
                    <!-- æ—¥å¿—å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                </div>
            </div>
        </div>
        
        <!-- çŠ¶æ€æ  -->
        <div id="statusBar" class="status-bar"></div>
    </div>

    <script>
        'use strict';
        
        // éŸ³é¢‘ç”Ÿæˆå™¨ç±»
        class AudioGenerator {
            constructor() {
                this.audioContext = null;
                this.activeSounds = new Set();
                this.initialized = false;
                this.initialize();
            }
            
            initialize() {
                try {
                    if (window.AudioContext || window.webkitAudioContext) {
                        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        this.initialized = true;
                        this.addLogEntry('éŸ³é¢‘ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ', 'success', 'éŸ³é¢‘');
                    } else {
                        this.addLogEntry('æµè§ˆå™¨ä¸æ”¯æŒWeb Audio API', 'warning', 'éŸ³é¢‘');
                    }
                } catch (error) {
                    this.addLogEntry(`éŸ³é¢‘ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error', 'éŸ³é¢‘');
                }
            }
            
            async ensureRunning() {
                try {
                    if (!this.audioContext) {
                        this.initialize();
                        if (!this.audioContext) {
                            return false;
                        }
                    }
                    
                    if (this.audioContext.state === 'suspended') {
                        await this.audioContext.resume();
                        this.addLogEntry('AudioContextæ¢å¤æˆåŠŸ', 'success', 'éŸ³é¢‘');
                    }
                    
                    return this.audioContext.state === 'running';
                } catch (error) {
                    this.addLogEntry(`AudioContextå¯åŠ¨å¤±è´¥: ${error.message}`, 'error', 'éŸ³é¢‘');
                    return false;
                }
            }
            
            getAudioContext() {
                try {
                    return this.audioContext || null;
                } catch (error) {
                    this.addLogEntry(`è·å–AudioContextå¤±è´¥: ${error.message}`, 'error', 'éŸ³é¢‘');
                    return null;
                }
            }
            
            playBeep(frequency = 800, duration = 0.5, volume = 0.5) {
                return this.playTone(frequency, duration, volume, 'sine');
            }
            
            playBell(frequency = 440, duration = 1, volume = 0.5) {
                return this.playTone(frequency, duration, volume, 'sine', true);
            }
            
            playChord(duration = 1, volume = 0.5) {
                return this.playTone(440, duration, volume, 'sine', true, [523.25, 659.25]);
            }
            
            playClick(frequency = 1000, duration = 0.1, volume = 0.3) {
                return this.playTone(frequency, duration, volume, 'square');
            }
            
            playTone(baseFrequency, duration, volume, type = 'sine', fadeOut = false, additionalFrequencies = []) {
                if (!this.audioContext || !window.userInteracted) {
                    this.addLogEntry('éŸ³é¢‘æœªåˆå§‹åŒ–æˆ–æœªæ¿€æ´»', 'warning', 'éŸ³é¢‘');
                    return false;
                }
                
                try {
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    oscillator.type = type;
                    oscillator.frequency.value = baseFrequency;
                    gainNode.gain.value = volume;
                    
                    const now = this.audioContext.currentTime;
                    oscillator.start(now);
                    
                    if (fadeOut) {
                        gainNode.gain.setValueAtTime(volume, now);
                        gainNode.gain.exponentialRampToValueAtTime(0.001, now + duration);
                    }
                    
                    if (additionalFrequencies && additionalFrequencies.length > 0) {
                        additionalFrequencies.forEach(freq => {
                            const extraOsc = this.audioContext.createOscillator();
                            const extraGain = this.audioContext.createGain();
                            
                            extraOsc.connect(extraGain);
                            extraGain.connect(this.audioContext.destination);
                            
                            extraOsc.type = type;
                            extraOsc.frequency.value = freq;
                            extraGain.gain.value = volume * 0.7;
                            
                            extraOsc.start(now);
                            if (fadeOut) {
                                extraGain.gain.setValueAtTime(volume * 0.7, now);
                                extraGain.gain.exponentialRampToValueAtTime(0.001, now + duration);
                            }
                            extraOsc.stop(now + duration);
                        });
                    }
                    
                    oscillator.stop(now + duration);
                    
                    const soundId = Symbol('sound');
                    this.activeSounds.add(soundId);
                    
                    setTimeout(() => {
                        this.activeSounds.delete(soundId);
                    }, duration * 1000 + 100);
                    
                    this.addLogEntry(`æ’­æ”¾å£°éŸ³: ${baseFrequency}Hz, ç±»å‹: ${type}`, 'info', 'éŸ³é¢‘');
                    return true;
                } catch (error) {
                    this.addLogEntry(`æ’­æ”¾å£°éŸ³å¤±è´¥: ${error.message}`, 'error', 'éŸ³é¢‘');
                    return false;
                }
            }
            
            stopAll() {
                try {
                    if (this.audioContext) {
                        this.audioContext.close();
                        this.audioContext = null;
                    }
                    this.activeSounds.clear();
                    this.initialized = false;
                    this.addLogEntry('åœæ­¢æ‰€æœ‰å£°éŸ³', 'info', 'éŸ³é¢‘');
                } catch (error) {
                    this.addLogEntry(`åœæ­¢å£°éŸ³å¤±è´¥: ${error.message}`, 'error', 'éŸ³é¢‘');
                }
            }
            
            addLogEntry(message, type = 'info', module = 'éŸ³é¢‘') {
                if (typeof window.addLogEntry === 'function') {
                    window.addLogEntry(message, type, module);
                } else {
                    console.log(`[${module}] ${message}`);
                }
            }
        }
        
        // ä¸»åº”ç”¨å˜é‡
        let audioGenerator = null;
        let pomodoroSeconds = 1500; // 25åˆ†é’Ÿ
        let isPomodoroRunning = false;
        let isPomodoroBreak = false;
        let pomodoroInterval = null;
        let interruptSeconds = 0;
        let isInterruptRunning = false;
        let interruptInterval = null;
        let soundEnabled = false;
        let vibrationEnabled = true;
        let clickSoundEnabled = true;
        let volume = 0.5;
        let currentSoundType = 'beep';
        let pomodoroRecords = [];
        let currentSessionHistory = [];
        let todayCompleted = 0;
        let totalCompleted = 0;
        let totalFocusTime = 0;
        let isLogVisible = true;
        let currentSessionName = ''; // æ–°å¢ï¼šå½“å‰ç•ªèŒ„é’Ÿåç§°
        
        // DOMå…ƒç´ å¼•ç”¨
        const timerDisplay = document.getElementById('timerDisplay');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const sessionNameInput = document.getElementById('sessionName'); // æ–°å¢
        const focusTimeInput = document.getElementById('focusTime');
        const breakTimeInput = document.getElementById('breakTime');
        const customMinutesInput = document.getElementById('customMinutes');
        const setCustomTimeBtn = document.getElementById('setCustomTimeBtn');
        const interruptMinutesInput = document.getElementById('interruptMinutes');
        const interruptSecondsInput = document.getElementById('interruptSeconds');
        const interruptReasonInput = document.getElementById('interruptReason');
        const startInterruptBtn = document.getElementById('startInterruptBtn');
        const cancelInterruptBtn = document.getElementById('cancelInterruptBtn');
        const interruptTimerDisplay = document.getElementById('interruptTimerDisplay');
        const volumeControl = document.getElementById('volumeControl');
        const volumeValue = document.getElementById('volumeValue');
        const vibrationToggle = document.getElementById('vibrationToggle');
        const clickSoundToggle = document.getElementById('clickSoundToggle');
        const soundOptions = document.querySelectorAll('.sound-option');
        const testSoundBtn = document.getElementById('testSoundBtn');
        const testSoundBtn2 = document.getElementById('testSoundBtn2');
        const stopSoundBtn = document.getElementById('stopSoundBtn');
        const presetTimeButtons = document.querySelectorAll('.preset-time');
        const quickTestButtons = document.querySelectorAll('.quick-test-btn');
        const exportRecordsBtn = document.getElementById('exportRecordsBtn');
        const clearRecordsBtn = document.getElementById('clearRecordsBtn');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');
        const clearLogBtn = document.getElementById('clearLogBtn');
        const toggleLogBtn = document.getElementById('toggleLogBtn');
        const pomodoroStatus = document.getElementById('pomodoroStatus');
        const deviceStatusElement = document.getElementById('deviceStatus');
        const statusBar = document.getElementById('statusBar');
        const recordList = document.getElementById('recordList');
        const historyList = document.getElementById('historyList');
        const logContent = document.getElementById('logContent');
        const todayCompletedEl = document.getElementById('todayCompleted');
        const totalCompletedEl = document.getElementById('totalCompleted');
        const totalFocusTimeEl = document.getElementById('totalFocusTime');
        
        // éŸ³é¢‘åˆå§‹åŒ–
        async function initAudioSystem() {
            try {
                if (!audioGenerator) {
                    audioGenerator = new AudioGenerator();
                }
                
                const success = await audioGenerator.ensureRunning();
                if (success) {
                    soundEnabled = true;
                    window.userInteracted = true;
                    updateDeviceStatus();
                    addLogEntry('éŸ³é¢‘ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ', 'success', 'éŸ³é¢‘');
                    return true;
                } else {
                    addLogEntry('éŸ³é¢‘ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’', 'warning', 'éŸ³é¢‘');
                    return false;
                }
            } catch (error) {
                addLogEntry(`éŸ³é¢‘ç³»ç»Ÿåˆå§‹åŒ–é”™è¯¯: ${error.message}`, 'error', 'éŸ³é¢‘');
                return false;
            }
        }
        
        // æ’­æ”¾å£°éŸ³
        async function playSound(type = 'beep') {
            if (!soundEnabled || !audioGenerator) {
                addLogEntry('å£°éŸ³æ’­æ”¾è¢«è·³è¿‡: éŸ³é¢‘æœªå¯ç”¨', 'warning', 'éŸ³é¢‘');
                return false;
            }
            
            try {
                let result = false;
                const currentVolume = volume;
                
                switch(type) {
                    case 'beep':
                        result = audioGenerator.playBeep(800, 0.5, currentVolume);
                        break;
                    case 'bell':
                        result = audioGenerator.playBell(440, 1, currentVolume);
                        break;
                    case 'chord':
                        result = audioGenerator.playChord(1, currentVolume);
                        break;
                    default:
                        result = audioGenerator.playBeep(800, 0.5, currentVolume);
                }
                
                if (result && vibrationEnabled && navigator.vibrate) {
                    navigator.vibrate(200);
                }
                
                return result;
            } catch (error) {
                addLogEntry(`æ’­æ”¾å£°éŸ³å¤±è´¥: ${error.message}`, 'error', 'éŸ³é¢‘');
                return false;
            }
        }
        
        // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ
        async function playClickSound(type = 'normal') {
            if (!clickSoundEnabled || !audioGenerator || !window.userInteracted) {
                return false;
            }
            
            try {
                if (type === 'test') {
                    return audioGenerator.playBeep(600, 0.1, volume * 0.3);
                } else {
                    return audioGenerator.playClick(1000, 0.1, volume * 0.3);
                }
            } catch (error) {
                console.error('ç‚¹å‡»éŸ³æ•ˆé”™è¯¯:', error);
                return false;
            }
        }
        
        // éœ‡åŠ¨åŠŸèƒ½
        function vibrate(pattern) {
            if (vibrationEnabled && navigator.vibrate) {
                try {
                    navigator.vibrate(pattern);
                } catch (error) {
                    addLogEntry(`éœ‡åŠ¨å¤±è´¥: ${error.message}`, 'error', 'è®¾å¤‡');
                }
            }
        }
        
        // æ›´æ–°è®¾å¤‡çŠ¶æ€æ˜¾ç¤º
        function updateDeviceStatus() {
            if (!deviceStatusElement) return;
            
            const ctx = audioGenerator ? audioGenerator.getAudioContext() : null;
            let statusText = '';
            
            if (ctx) {
                switch(ctx.state) {
                    case 'running':
                        statusText = 'âœ… éŸ³é¢‘å·²æ¿€æ´»';
                        break;
                    case 'suspended':
                        statusText = 'â¸ï¸ éŸ³é¢‘å·²æš‚åœ';
                        break;
                    case 'closed':
                        statusText = 'âŒ éŸ³é¢‘å·²å…³é—­';
                        break;
                    default:
                        statusText = 'ğŸ”§ éŸ³é¢‘çŠ¶æ€æœªçŸ¥';
                }
            } else {
                statusText = soundEnabled ? 'âœ… éŸ³é¢‘å·²å‡†å¤‡' : 'ğŸ”§ ç­‰å¾…ç”¨æˆ·ç‚¹å‡»æ¿€æ´»';
            }
            
            deviceStatusElement.textContent = statusText;
        }
        
        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(message, duration = 3000) {
            if (!statusBar) return;
            
            statusBar.textContent = message;
            statusBar.classList.add('show');
            
            if (duration > 0) {
                setTimeout(() => {
                    statusBar.classList.remove('show');
                }, duration);
            }
        }
        
        // æ·»åŠ æ—¥å¿—æ¡ç›®
        function addLogEntry(message, type = 'info', module = 'ç³»ç»Ÿ') {
            if (!logContent) return;
            
            const now = new Date();
            const timestamp = now.toLocaleTimeString('zh-CN', { 
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.innerHTML = `
                <span class="log-timestamp">${timestamp}</span>
                <span class="log-module">${module}</span>
                ${message}
            `;
            
            logContent.appendChild(logEntry);
            logContent.scrollTop = logContent.scrollHeight;
            
            console.log(`[${timestamp}] [${module}] ${message}`);
        }
        
        // æ¸…ç©ºæ—¥å¿—
        function clearLogs() {
            if (logContent) {
                logContent.innerHTML = '';
                addLogEntry('æ—¥å¿—å·²æ¸…ç©º', 'info', 'ç³»ç»Ÿ');
            }
        }
        
        // åˆ‡æ¢æ—¥å¿—å¯è§æ€§
        function toggleLogVisibility() {
            if (logContent) {
                isLogVisible = !isLogVisible;
                logContent.style.display = isLogVisible ? 'block' : 'none';
                if (toggleLogBtn) {
                    toggleLogBtn.innerHTML = isLogVisible ? 
                        '<i class="fas fa-eye-slash"></i> éšè—æ—¥å¿—' : 
                        '<i class="fas fa-eye"></i> æ˜¾ç¤ºæ—¥å¿—';
                }
                addLogEntry(`æ—¥å¿—å·²${isLogVisible ? 'æ˜¾ç¤º' : 'éšè—'}`, 'info', 'ç³»ç»Ÿ');
            }
        }
        
        // æµ‹è¯•å£°éŸ³
        async function testSound() {
            addLogEntry('æµ‹è¯•å£°éŸ³æ’­æ”¾', 'info', 'éŸ³é¢‘');
            
            if (!window.userInteracted) {
                showStatus('è¯·å…ˆç‚¹å‡»é¡µé¢ä»»æ„ä½ç½®æ¿€æ´»éŸ³é¢‘', 3000);
                addLogEntry('éœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½æ’­æ”¾å£°éŸ³', 'warning', 'éŸ³é¢‘');
                return;
            }
            
            try {
                const audioSuccess = await playSound(currentSoundType);
                if (audioSuccess) {
                    showStatus('âœ… å£°éŸ³æµ‹è¯•æˆåŠŸ', 2000);
                } else {
                    showStatus('âŒ å£°éŸ³æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥éŸ³é¢‘è®¾ç½®', 3000);
                }
            } catch (error) {
                addLogEntry(`å£°éŸ³æµ‹è¯•é”™è¯¯: ${error.message}`, 'error', 'éŸ³é¢‘');
                showStatus('âŒ å£°éŸ³æµ‹è¯•å‡ºé”™', 2000);
            }
        }
        
        // åœæ­¢æ‰€æœ‰å£°éŸ³
        function stopAllSounds() {
            if (audioGenerator) {
                audioGenerator.stopAll();
                addLogEntry('å·²åœæ­¢æ‰€æœ‰å£°éŸ³', 'info', 'éŸ³é¢‘');
                showStatus('ğŸ”‡ å·²åœæ­¢æ‰€æœ‰å£°éŸ³', 2000);
            }
        }
        
        // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // æ›´æ–°ç•ªèŒ„é’Ÿæ˜¾ç¤º
        function updateTimerDisplay(seconds) {
            if (timerDisplay) {
                timerDisplay.textContent = formatTime(seconds);
            }
        }
        
        // æ›´æ–°ç•ªèŒ„é’ŸçŠ¶æ€
        function updatePomodoroStatus() {
            if (!pomodoroStatus) return;
            
            let status = '';
            if (isPomodoroRunning) {
                if (isPomodoroBreak) {
                    status = 'â˜• ä¼‘æ¯ä¸­';
                    timerDisplay && timerDisplay.classList.add('pulse');
                } else {
                    status = 'ğŸ¯ ä¸“æ³¨ä¸­';
                    timerDisplay && timerDisplay.classList.remove('pulse');
                }
            } else {
                if (isPomodoroBreak) {
                    status = 'â¸ï¸ ä¼‘æ¯æš‚åœ';
                } else {
                    status = 'ğŸ¯ å‡†å¤‡å¼€å§‹ä¸“æ³¨';
                }
                timerDisplay && timerDisplay.classList.remove('pulse');
            }
            
            pomodoroStatus.textContent = status;
        }
        
        // å¼€å§‹ç•ªèŒ„é’Ÿ
        async function startPomodoro() {
            if (isPomodoroRunning) return;
            
            try {
                if (clickSoundEnabled) {
                    await playClickSound('normal');
                }
                
                // è·å–ç•ªèŒ„é’Ÿåç§°
                currentSessionName = sessionNameInput ? sessionNameInput.value.trim() : '';
                
                isPomodoroRunning = true;
                updatePomodoroStatus();
                
                if (startBtn) startBtn.disabled = true;
                if (pauseBtn) pauseBtn.disabled = false;
                
                // æ·»åŠ å¼€å§‹æ—¥å¿—
                const sessionType = isPomodoroBreak ? 'ä¼‘æ¯' : 'ä¸“æ³¨';
                const sessionNameInfo = currentSessionName ? ` (${currentSessionName})` : '';
                addLogEntry(`å¼€å§‹${sessionType}è®¡æ—¶${sessionNameInfo}`, 'success', 'ç•ªèŒ„é’Ÿ');
                showStatus(`âœ… ${sessionType}è®¡æ—¶å¼€å§‹${sessionNameInfo ? ': ' + currentSessionName : ''}`, 2000);
                
                pomodoroInterval = setInterval(() => {
                    pomodoroSeconds--;
                    updateTimerDisplay(pomodoroSeconds);
                    
                    if (pomodoroSeconds <= 0) {
                        finishPomodoro();
                    }
                }, 1000);
                
            } catch (error) {
                addLogEntry(`å¼€å§‹ç•ªèŒ„é’Ÿå¤±è´¥: ${error.message}`, 'error', 'ç•ªèŒ„é’Ÿ');
                isPomodoroRunning = false;
                updatePomodoroStatus();
                if (startBtn) startBtn.disabled = false;
                if (pauseBtn) pauseBtn.disabled = true;
            }
        }
        
        // æš‚åœç•ªèŒ„é’Ÿ
        async function pausePomodoro() {
            if (!isPomodoroRunning) return;
            
            try {
                if (clickSoundEnabled) {
                    await playClickSound('normal');
                }
                
                isPomodoroRunning = false;
                clearInterval(pomodoroInterval);
                pomodoroInterval = null;
                
                updatePomodoroStatus();
                if (startBtn) startBtn.disabled = false;
                if (pauseBtn) pauseBtn.disabled = true;
                
                addLogEntry(`${isPomodoroBreak ? 'ä¼‘æ¯' : 'ä¸“æ³¨'}å·²æš‚åœ`, 'info', 'ç•ªèŒ„é’Ÿ');
                showStatus('â¸ï¸ å·²æš‚åœ', 2000);
                
            } catch (error) {
                addLogEntry(`æš‚åœç•ªèŒ„é’Ÿå¤±è´¥: ${error.message}`, 'error', 'ç•ªèŒ„é’Ÿ');
            }
        }
        
        // å®Œæˆç•ªèŒ„é’Ÿ
        async function finishPomodoro() {
            try {
                clearInterval(pomodoroInterval);
                pomodoroInterval = null;
                isPomodoroRunning = false;
                
                const isFocusFinished = !isPomodoroBreak;
                const currentTime = new Date().toLocaleTimeString('zh-CN');
                const currentDate = new Date().toISOString().split('T')[0];
                
                if (isFocusFinished) {
                    addLogEntry('ä¸“æ³¨æ—¶é—´åˆ°ï¼', 'success', 'ç•ªèŒ„é’Ÿ');
                    showStatus('ğŸ‰ ä¸“æ³¨æ—¶é—´åˆ°ï¼Œè¯·å¼€å§‹ä¼‘æ¯ï¼', 5000);
                    
                    await playSound('bell');
                    vibrate([200, 100, 200, 100, 200]);
                    
                    todayCompleted++;
                    totalCompleted++;
                    const focusTimeMinutes = parseInt(focusTimeInput ? focusTimeInput.value : 25);
                    totalFocusTime += focusTimeMinutes / 60;
                    
                    // ä¿å­˜è®°å½•ï¼ŒåŒ…å«ç•ªèŒ„é’Ÿåç§°
                    const sessionName = currentSessionName || 'æœªå‘½å';
                    pomodoroRecords.unshift({
                        time: currentTime,
                        name: sessionName,
                        duration: `${focusTimeMinutes}åˆ†é’Ÿ`,
                        type: 'focus',
                        date: currentDate
                    });
                    
                    // è®°å½•åˆ°æ—¥å¿—
                    addLogEntry(`å®Œæˆä¸“æ³¨: ${sessionName}, æ—¶é•¿: ${focusTimeMinutes}åˆ†é’Ÿ`, 'success', 'è®°å½•');
                    
                    saveRecords();
                    updateRecordsDisplay();
                    
                    isPomodoroBreak = true;
                    pomodoroSeconds = (breakTimeInput ? parseInt(breakTimeInput.value) : 5) * 60;
                    
                    // é‡ç½®ç•ªèŒ„é’Ÿåç§°
                    if (sessionNameInput) {
                        sessionNameInput.value = '';
                        currentSessionName = '';
                    }
                } else {
                    addLogEntry('ä¼‘æ¯æ—¶é—´åˆ°ï¼', 'info', 'ç•ªèŒ„é’Ÿ');
                    showStatus('ğŸ”” ä¼‘æ¯æ—¶é—´åˆ°ï¼Œè¯·ç»§ç»­ä¸“æ³¨ï¼', 3000);
                    
                    await playSound('beep');
                    vibrate([300, 100, 300]);
                    
                    pomodoroRecords.unshift({
                        time: currentTime,
                        name: 'ä¼‘æ¯æ—¶æ®µ',
                        duration: `${breakTimeInput ? parseInt(breakTimeInput.value) : 5}åˆ†é’Ÿ`,
                        type: 'break',
                        date: currentDate
                    });
                    
                    saveRecords();
                    updateRecordsDisplay();
                    
                    isPomodoroBreak = false;
                    pomodoroSeconds = (focusTimeInput ? parseInt(focusTimeInput.value) : 25) * 60;
                }
                
                updateTimerDisplay(pomodoroSeconds);
                updatePomodoroStatus();
                
                if (startBtn) startBtn.disabled = false;
                if (pauseBtn) pauseBtn.disabled = true;
                
            } catch (error) {
                addLogEntry(`å®Œæˆç•ªèŒ„é’Ÿå¤±è´¥: ${error.message}`, 'error', 'ç•ªèŒ„é’Ÿ');
            }
        }
        
        // é‡ç½®ç•ªèŒ„é’Ÿ
        async function resetPomodoro() {
            try {
                if (clickSoundEnabled) {
                    await playClickSound('normal');
                }
                
                isPomodoroRunning = false;
                isPomodoroBreak = false;
                
                clearInterval(pomodoroInterval);
                pomodoroInterval = null;
                
                const focusMinutes = focusTimeInput ? parseInt(focusTimeInput.value) : 25;
                pomodoroSeconds = focusMinutes * 60;
                
                updateTimerDisplay(pomodoroSeconds);
                updatePomodoroStatus();
                
                if (startBtn) startBtn.disabled = false;
                if (pauseBtn) pauseBtn.disabled = true;
                
                addLogEntry('ç•ªèŒ„é’Ÿå·²é‡ç½®', 'info', 'ç•ªèŒ„é’Ÿ');
                showStatus('ğŸ”„ ç•ªèŒ„é’Ÿå·²é‡ç½®', 2000);
                
            } catch (error) {
                addLogEntry(`é‡ç½®ç•ªèŒ„é’Ÿå¤±è´¥: ${error.message}`, 'error', 'ç•ªèŒ„é’Ÿ');
            }
        }
        
        // å¼€å§‹ä¸­æ–­è®¡æ—¶
        async function startInterrupt() {
            if (isInterruptRunning || isPomodoroRunning) return;
            
            try {
                if (clickSoundEnabled) {
                    await playClickSound('normal');
                }
                
                const minutes = interruptMinutesInput ? parseInt(interruptMinutesInput.value) || 0 : 0;
                const seconds = interruptSecondsInput ? parseInt(interruptSecondsInput.value) || 0 : 0;
                const reason = interruptReasonInput ? interruptReasonInput.value.trim() : '';
                
                if (minutes === 0 && seconds === 0) {
                    showStatus('âš ï¸ è¯·è®¾ç½®ä¸­æ–­æ—¶é—´', 2000);
                    addLogEntry('ä¸­æ–­æ—¶é—´æœªè®¾ç½®', 'warning', 'ä¸­æ–­');
                    return;
                }
                
                interruptSeconds = minutes * 60 + seconds;
                isInterruptRunning = true;
                
                if (interruptTimerDisplay) {
                    interruptTimerDisplay.textContent = formatTime(interruptSeconds);
                    interruptTimerDisplay.classList.add('show');
                }
                
                if (startInterruptBtn) startInterruptBtn.style.display = 'none';
                if (cancelInterruptBtn) cancelInterruptBtn.style.display = 'inline-block';
                
                addLogEntry(`å¼€å§‹ä¸­æ–­è®¡æ—¶: ${minutes}åˆ†${seconds}ç§’${reason ? `, åŸå› : ${reason}` : ''}`, 'info', 'ä¸­æ–­');
                showStatus('â±ï¸ ä¸­æ–­è®¡æ—¶å¼€å§‹', 2000);
                
                interruptInterval = setInterval(() => {
                    interruptSeconds--;
                    if (interruptTimerDisplay) {
                        interruptTimerDisplay.textContent = formatTime(interruptSeconds);
                    }
                    
                    if (interruptSeconds <= 0) {
                        finishInterrupt(reason);
                    }
                }, 1000);
                
            } catch (error) {
                addLogEntry(`å¼€å§‹ä¸­æ–­å¤±è´¥: ${error.message}`, 'error', 'ä¸­æ–­');
                isInterruptRunning = false;
                if (interruptTimerDisplay) interruptTimerDisplay.classList.remove('show');
                if (startInterruptBtn) startInterruptBtn.style.display = 'inline-block';
                if (cancelInterruptBtn) cancelInterruptBtn.style.display = 'none';
            }
        }
        
        // å®Œæˆä¸­æ–­è®¡æ—¶
        async function finishInterrupt(reason = '') {
            try {
                clearInterval(interruptInterval);
                interruptInterval = null;
                isInterruptRunning = false;
                
                if (interruptTimerDisplay) {
                    interruptTimerDisplay.classList.remove('show');
                }
                if (startInterruptBtn) startInterruptBtn.style.display = 'inline-block';
                if (cancelInterruptBtn) cancelInterruptBtn.style.display = 'none';
                
                const duration = `${Math.floor((interruptSecondsInput ? parseInt(interruptSecondsInput.value) : 0) + (interruptMinutesInput ? parseInt(interruptMinutesInput.value) : 0) * 60)}ç§’`;
                
                currentSessionHistory.unshift({
                    time: new Date().toLocaleTimeString('zh-CN'),
                    duration: duration,
                    reason: reason || 'æ— åŸå› ',
                    seconds: interruptSeconds
                });
                
                if (currentSessionHistory.length > 10) {
                    currentSessionHistory = currentSessionHistory.slice(0, 10);
                }
                
                updateHistoryDisplay();
                saveHistory();
                
                await playSound('chord');
                vibrate([100, 50, 100, 50, 100, 50, 100]);
                
                addLogEntry('ä¸­æ–­æ—¶é—´åˆ°ï¼', 'success', 'ä¸­æ–­');
                showStatus('ğŸ”” ä¸­æ–­æ—¶é—´åˆ°ï¼', 5000);
                
            } catch (error) {
                addLogEntry(`å®Œæˆä¸­æ–­å¤±è´¥: ${error.message}`, 'error', 'ä¸­æ–­');
            }
        }
        
        // å–æ¶ˆä¸­æ–­
        async function cancelInterrupt() {
            try {
                if (clickSoundEnabled) {
                    await playClickSound('normal');
                }
                
                clearInterval(interruptInterval);
                interruptInterval = null;
                isInterruptRunning = false;
                
                if (interruptTimerDisplay) {
                    interruptTimerDisplay.classList.remove('show');
                }
                if (startInterruptBtn) startInterruptBtn.style.display = 'inline-block';
                if (cancelInterruptBtn) cancelInterruptBtn.style.display = 'none';
                
                addLogEntry('ä¸­æ–­å·²å–æ¶ˆ', 'info', 'ä¸­æ–­');
                showStatus('âŒ ä¸­æ–­å·²å–æ¶ˆ', 2000);
                
            } catch (error) {
                addLogEntry(`å–æ¶ˆä¸­æ–­å¤±è´¥: ${error.message}`, 'error', 'ä¸­æ–­');
            }
        }
        
        // åº”ç”¨é¢„è®¾æ—¶é—´
        function applyPresetTime(minutes) {
            try {
                if (clickSoundEnabled) {
                    playClickSound('normal');
                }
                
                pomodoroSeconds = minutes * 60;
                isPomodoroBreak = false;
                isPomodoroRunning = false;
                
                clearInterval(pomodoroInterval);
                pomodoroInterval = null;
                
                updateTimerDisplay(pomodoroSeconds);
                updatePomodoroStatus();
                
                if (startBtn) startBtn.disabled = false;
                if (pauseBtn) pauseBtn.disabled = true;
                
                if (focusTimeInput) {
                    focusTimeInput.value = minutes;
                }
                
                addLogEntry(`åº”ç”¨é¢„è®¾æ—¶é—´: ${minutes}åˆ†é’Ÿ`, 'info', 'è®¾ç½®');
                showStatus(`âœ… å·²è®¾ç½®ä¸º${minutes}åˆ†é’Ÿä¸“æ³¨`, 2000);
                
            } catch (error) {
                addLogEntry(`åº”ç”¨é¢„è®¾æ—¶é—´å¤±è´¥: ${error.message}`, 'error', 'è®¾ç½®');
            }
        }
        
        // åº”ç”¨è‡ªå®šä¹‰æ—¶é—´
        async function applyCustomTime() {
            try {
                if (clickSoundEnabled) {
                    await playClickSound('normal');
                }
                
                const minutes = customMinutesInput ? parseInt(customMinutesInput.value) : 25;
                if (minutes < 1 || minutes > 120) {
                    showStatus('âŒ æ—¶é—´èŒƒå›´: 1-120åˆ†é’Ÿ', 2000);
                    addLogEntry('è‡ªå®šä¹‰æ—¶é—´è¶…å‡ºèŒƒå›´', 'warning', 'è®¾ç½®');
                    return;
                }
                
                applyPresetTime(minutes);
                
            } catch (error) {
                addLogEntry(`åº”ç”¨è‡ªå®šä¹‰æ—¶é—´å¤±è´¥: ${error.message}`, 'error', 'è®¾ç½®');
            }
        }
        
        // å¿«é€Ÿæµ‹è¯•ä¸­æ–­
        async function quickTestInterrupt(seconds) {
            try {
                if (clickSoundEnabled) {
                    await playClickSound('normal');
                }
                
                if (isPomodoroRunning) {
                    showStatus('âš ï¸ è¯·å…ˆæš‚åœç•ªèŒ„é’Ÿ', 2000);
                    addLogEntry('æ— æ³•åœ¨ç•ªèŒ„é’Ÿè¿è¡Œæ—¶æµ‹è¯•ä¸­æ–­', 'warning', 'ä¸­æ–­');
                    return;
                }
                
                if (isInterruptRunning) {
                    showStatus('âš ï¸ å·²æœ‰ä¸­æ–­åœ¨è¿è¡Œ', 2000);
                    addLogEntry('å·²æœ‰ä¸­æ–­åœ¨è¿è¡Œ', 'warning', 'ä¸­æ–­');
                    return;
                }
                
                if (interruptSecondsInput) {
                    interruptSecondsInput.value = seconds;
                }
                if (interruptMinutesInput) {
                    interruptMinutesInput.value = 0;
                }
                
                addLogEntry(`å¿«é€Ÿæµ‹è¯•ä¸­æ–­: ${seconds}ç§’`, 'info', 'ä¸­æ–­');
                showStatus(`â±ï¸ æµ‹è¯•${seconds}ç§’ä¸­æ–­`, 2000);
                
                await startInterrupt();
                
            } catch (error) {
                addLogEntry(`å¿«é€Ÿæµ‹è¯•ä¸­æ–­å¤±è´¥: ${error.message}`, 'error', 'ä¸­æ–­');
            }
        }
        
        // æ›´æ–°è®°å½•æ˜¾ç¤º
        function updateRecordsDisplay() {
            if (!recordList) return;
            
            if (todayCompletedEl) todayCompletedEl.textContent = todayCompleted;
            if (totalCompletedEl) totalCompletedEl.textContent = totalCompleted;
            if (totalFocusTimeEl) {
                totalFocusTimeEl.textContent = totalFocusTime.toFixed(1);
            }
            
            if (pomodoroRecords.length === 0) {
                recordList.innerHTML = '<div class="no-records">æš‚æ— è®°å½•ï¼Œå¼€å§‹æ‚¨çš„ç¬¬ä¸€ä¸ªç•ªèŒ„é’Ÿå§ï¼</div>';
                return;
            }
            
            let html = '';
            pomodoroRecords.slice(0, 20).forEach(record => {
                html += `
                    <div class="record-item">
                        <div class="record-info">
                            <div class="record-time">${record.time}</div>
                            <div class="record-name">${record.name}</div>
                            <div class="record-duration">${record.duration}</div>
                        </div>
                        <div class="record-type ${record.type}">${record.type === 'focus' ? 'ä¸“æ³¨' : 'ä¼‘æ¯'}</div>
                    </div>
                `;
            });
            
            recordList.innerHTML = html;
        }
        
        // ä¿å­˜è®°å½•
        function saveRecords() {
            try {
                const data = {
                    records: pomodoroRecords,
                    todayCompleted: todayCompleted,
                    totalCompleted: totalCompleted,
                    totalFocusTime: totalFocusTime,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem('pomodoroRecords', JSON.stringify(data));
                addLogEntry('è®°å½•å·²ä¿å­˜', 'info', 'å­˜å‚¨');
            } catch (error) {
                addLogEntry(`ä¿å­˜è®°å½•å¤±è´¥: ${error.message}`, 'error', 'å­˜å‚¨');
            }
        }
        
        // åŠ è½½è®°å½•
        function loadRecords() {
            try {
                const savedData = localStorage.getItem('pomodoroRecords');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    pomodoroRecords = data.records || [];
                    todayCompleted = data.todayCompleted || 0;
                    totalCompleted = data.totalCompleted || 0;
                    totalFocusTime = data.totalFocusTime || 0;
                    
                    updateRecordsDisplay();
                    addLogEntry('è®°å½•å·²åŠ è½½', 'success', 'å­˜å‚¨');
                } else {
                    addLogEntry('æ— å†å²è®°å½•', 'info', 'å­˜å‚¨');
                }
            } catch (error) {
                addLogEntry(`åŠ è½½è®°å½•å¤±è´¥: ${error.message}`, 'error', 'å­˜å‚¨');
            }
        }
        
        // å¯¼å‡ºè®°å½•
        function exportRecords() {
            try {
                if (pomodoroRecords.length === 0) {
                    showStatus('ğŸ“­ æš‚æ— è®°å½•å¯å¯¼å‡º', 2000);
                    addLogEntry('æš‚æ— è®°å½•å¯å¯¼å‡º', 'warning', 'è®°å½•');
                    return;
                }
                
                const dataStr = JSON.stringify(pomodoroRecords, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `pomodoro-records-${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                addLogEntry('è®°å½•å·²å¯¼å‡º', 'success', 'è®°å½•');
                showStatus('âœ… è®°å½•å¯¼å‡ºæˆåŠŸ', 2000);
                
            } catch (error) {
                addLogEntry(`å¯¼å‡ºè®°å½•å¤±è´¥: ${error.message}`, 'error', 'è®°å½•');
                showStatus('âŒ è®°å½•å¯¼å‡ºå¤±è´¥', 2000);
            }
        }
        
        // æ¸…ç©ºæ‰€æœ‰è®°å½•
        function clearAllRecords() {
            try {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                    pomodoroRecords = [];
                    todayCompleted = 0;
                    totalCompleted = 0;
                    totalFocusTime = 0;
                    
                    saveRecords();
                    updateRecordsDisplay();
                    
                    addLogEntry('æ‰€æœ‰è®°å½•å·²æ¸…ç©º', 'warning', 'è®°å½•');
                    showStatus('ğŸ—‘ï¸ è®°å½•å·²æ¸…ç©º', 2000);
                }
            } catch (error) {
                addLogEntry(`æ¸…ç©ºè®°å½•å¤±è´¥: ${error.message}`, 'error', 'è®°å½•');
            }
        }
        // æ›´æ–°å†å²æ˜¾ç¤º
        function updateHistoryDisplay() {
            if (!historyList) return;
            
            if (currentSessionHistory.length === 0) {
                historyList.innerHTML = '<div class="empty-history">æš‚æ— ä¸­æ–­è®°å½•</div>';
                return;
            }
            
            let html = '';
            currentSessionHistory.forEach(item => {
                html += `
                    <div class="history-item">
                        <div class="history-time">${item.time}</div>
                        <div class="history-details">
                            <span>æ—¶é•¿: ${item.duration}</span>
                            <span>åŸå› : ${item.reason}</span>
                        </div>
                    </div>
                `;
            });
            
            historyList.innerHTML = html;
        }
        
        // ä¿å­˜å†å²è®°å½•
        function saveHistory() {
            try {
                const data = {
                    history: currentSessionHistory,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem('pomodoroHistory', JSON.stringify(data));
                addLogEntry('ä¸­æ–­å†å²å·²ä¿å­˜', 'info', 'å­˜å‚¨');
            } catch (error) {
                addLogEntry(`ä¿å­˜ä¸­æ–­å†å²å¤±è´¥: ${error.message}`, 'error', 'å­˜å‚¨');
            }
        }
        
        // åŠ è½½å†å²è®°å½•
        function loadHistory() {
            try {
                const savedData = localStorage.getItem('pomodoroHistory');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    currentSessionHistory = data.history || [];
                    updateHistoryDisplay();
                    addLogEntry('ä¸­æ–­å†å²å·²åŠ è½½', 'success', 'å­˜å‚¨');
                } else {
                    addLogEntry('æ— ä¸­æ–­å†å²', 'info', 'å­˜å‚¨');
                }
            } catch (error) {
                addLogEntry(`åŠ è½½ä¸­æ–­å†å²å¤±è´¥: ${error.message}`, 'error', 'å­˜å‚¨');
            }
        }
        
        // æ¸…ç©ºå†å²è®°å½•
        function clearHistory() {
            try {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºä¸­æ–­å†å²å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                    currentSessionHistory = [];
                    saveHistory();
                    updateHistoryDisplay();
                    addLogEntry('ä¸­æ–­å†å²å·²æ¸…ç©º', 'warning', 'å†å²');
                    showStatus('ğŸ—‘ï¸ ä¸­æ–­å†å²å·²æ¸…ç©º', 2000);
                }
            } catch (error) {
                addLogEntry(`æ¸…ç©ºå†å²å¤±è´¥: ${error.message}`, 'error', 'å†å²');
            }
        }
        
        // åŠ è½½è®¾ç½®
        function loadSettings() {
            try {
                const savedSettings = localStorage.getItem('pomodoroSettings');
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    
                    if (focusTimeInput) focusTimeInput.value = settings.focusTime || 25;
                    if (breakTimeInput) breakTimeInput.value = settings.breakTime || 5;
                    
                    volume = settings.volume !== undefined ? settings.volume : 0.5;
                    if (volumeControl) volumeControl.value = volume * 100;
                    if (volumeValue) volumeValue.textContent = `${Math.round(volume * 100)}%`;
                    
                    currentSoundType = settings.soundType || 'beep';
                    if (soundOptions) {
                        soundOptions.forEach(option => {
                            if (option.dataset.sound === currentSoundType) {
                                option.classList.add('active');
                            } else {
                                option.classList.remove('active');
                            }
                        });
                    }
                    
                    vibrationEnabled = settings.vibration !== undefined ? settings.vibration : true;
                    if (vibrationToggle) vibrationToggle.checked = vibrationEnabled;
                    
                    clickSoundEnabled = settings.clickSound !== undefined ? settings.clickSound : true;
                    if (clickSoundToggle) clickSoundToggle.checked = clickSoundEnabled;
                    
                    isLogVisible = settings.logVisible !== undefined ? settings.logVisible : true;
                    if (logContent) {
                        logContent.style.display = isLogVisible ? 'block' : 'none';
                    }
                    if (toggleLogBtn) {
                        toggleLogBtn.innerHTML = isLogVisible ? 
                            '<i class="fas fa-eye-slash"></i> éšè—æ—¥å¿—' : 
                            '<i class="fas fa-eye"></i> æ˜¾ç¤ºæ—¥å¿—';
                    }
                    
                    pomodoroSeconds = (settings.focusTime || 25) * 60;
                    updateTimerDisplay(pomodoroSeconds);
                    
                    addLogEntry('è®¾ç½®å·²åŠ è½½', 'success', 'è®¾ç½®');
                } else {
                    addLogEntry('ä½¿ç”¨é»˜è®¤è®¾ç½®', 'info', 'è®¾ç½®');
                }
            } catch (error) {
                addLogEntry(`åŠ è½½è®¾ç½®å¤±è´¥: ${error.message}`, 'error', 'è®¾ç½®');
            }
        }
        
        // ä¿å­˜è®¾ç½®
        function saveSettings() {
            try {
                const settings = {
                    focusTime: focusTimeInput ? parseInt(focusTimeInput.value) : 25,
                    breakTime: breakTimeInput ? parseInt(breakTimeInput.value) : 5,
                    volume: volume,
                    soundType: currentSoundType,
                    vibration: vibrationEnabled,
                    clickSound: clickSoundEnabled,
                    logVisible: isLogVisible,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem('pomodoroSettings', JSON.stringify(settings));
                addLogEntry('è®¾ç½®å·²ä¿å­˜', 'info', 'è®¾ç½®');
            } catch (error) {
                addLogEntry(`ä¿å­˜è®¾ç½®å¤±è´¥: ${error.message}`, 'error', 'è®¾ç½®');
            }
        }
        
        // æ£€æŸ¥è®¾å¤‡å…¼å®¹æ€§
        function checkCompatibility() {
            const compatibilityStatus = document.getElementById('compatibilityStatus');
            if (!compatibilityStatus) return;
            
            const issues = [];
            let isCompatible = true;
            
            // æ£€æŸ¥Web Audio API
            if (!window.AudioContext && !window.webkitAudioContext) {
                issues.push('ä¸æ”¯æŒWeb Audio APIï¼Œå£°éŸ³åŠŸèƒ½ä¸å¯ç”¨');
                isCompatible = false;
            }
            
            // æ£€æŸ¥localStorage
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
            } catch (error) {
                issues.push('localStorageä¸å¯ç”¨ï¼Œæ— æ³•ä¿å­˜è®¾ç½®å’Œè®°å½•');
                isCompatible = false;
            }
            
            // æ£€æŸ¥éœ‡åŠ¨API
            if (!navigator.vibrate) {
                issues.push('ä¸æ”¯æŒéœ‡åŠ¨APIï¼Œéœ‡åŠ¨æé†’ä¸å¯ç”¨');
            }
            
            if (issues.length > 0) {
                compatibilityStatus.textContent = issues.join('; ');
                compatibilityStatus.className = isCompatible ? 
                    'compatibility-warning success' : 
                    'compatibility-warning warning';
                compatibilityStatus.classList.remove('hidden');
            } else {
                compatibilityStatus.textContent = 'âœ… æ‰€æœ‰åŠŸèƒ½éƒ½å¯ç”¨';
                compatibilityStatus.className = 'compatibility-warning success';
                compatibilityStatus.classList.remove('hidden');
            }
            
            setTimeout(() => {
                compatibilityStatus.classList.add('hidden');
            }, 10000);
            
            addLogEntry(`è®¾å¤‡å…¼å®¹æ€§æ£€æŸ¥: ${isCompatible ? 'é€šè¿‡' : 'éƒ¨åˆ†åŠŸèƒ½ä¸å¯ç”¨'}`, 
                       isCompatible ? 'success' : 'warning', 
                       'ç³»ç»Ÿ');
        }
        
        // æ·»åŠ è§¦æ‘¸åé¦ˆ
        function addTouchFeedback(element) {
            element.addEventListener('touchstart', function(e) {
                this.classList.add('touch-feedback');
            }, { passive: true });
            
            element.addEventListener('touchend', function(e) {
                this.classList.remove('touch-feedback');
            }, { passive: true });
            
            element.addEventListener('touchcancel', function(e) {
                this.classList.remove('touch-feedback');
            }, { passive: true });
        }
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
        function initializeEventListeners() {
            try {
                // ç•ªèŒ„é’Ÿæ§åˆ¶æŒ‰é’®
                if (startBtn) {
                    startBtn.addEventListener('click', startPomodoro);
                    addTouchFeedback(startBtn);
                }
                
                if (pauseBtn) {
                    pauseBtn.addEventListener('click', pausePomodoro);
                    addTouchFeedback(pauseBtn);
                }
                
                if (resetBtn) {
                    resetBtn.addEventListener('click', resetPomodoro);
                    addTouchFeedback(resetBtn);
                }
                
                // ç•ªèŒ„é’Ÿæ—¶é—´è®¾ç½®
                if (focusTimeInput) {
                    focusTimeInput.addEventListener('change', function() {
                        const minutes = parseInt(this.value) || 25;
                        if (minutes < 1) this.value = 1;
                        if (minutes > 120) this.value = 120;
                        pomodoroSeconds = minutes * 60;
                        updateTimerDisplay(pomodoroSeconds);
                        saveSettings();
                    });
                }
                
                if (breakTimeInput) {
                    breakTimeInput.addEventListener('change', function() {
                        const minutes = parseInt(this.value) || 5;
                        if (minutes < 1) this.value = 1;
                        if (minutes > 60) this.value = 60;
                        saveSettings();
                    });
                }
                
                // é¢„è®¾æ—¶é—´æŒ‰é’®
                if (presetTimeButtons) {
                    presetTimeButtons.forEach(button => {
                        button.addEventListener('click', function() {
                            const minutes = parseInt(this.dataset.minutes) || 25;
                            applyPresetTime(minutes);
                        });
                        addTouchFeedback(button);
                    });
                }
                
                // è‡ªå®šä¹‰æ—¶é—´è®¾ç½®
                if (setCustomTimeBtn) {
                    setCustomTimeBtn.addEventListener('click', applyCustomTime);
                    addTouchFeedback(setCustomTimeBtn);
                }
                
                if (customMinutesInput) {
                    customMinutesInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            applyCustomTime();
                        }
                    });
                }
                
                // ä¸­æ–­è®¡æ—¶å™¨æ§åˆ¶
                if (startInterruptBtn) {
                    startInterruptBtn.addEventListener('click', startInterrupt);
                    addTouchFeedback(startInterruptBtn);
                }
                
                if (cancelInterruptBtn) {
                    cancelInterruptBtn.addEventListener('click', cancelInterrupt);
                    addTouchFeedback(cancelInterruptBtn);
                }
                
                // ä¸­æ–­æ—¶é—´è¾“å…¥
                if (interruptMinutesInput) {
                    interruptMinutesInput.addEventListener('change', function() {
                        const minutes = parseInt(this.value) || 0;
                        if (minutes < 0) this.value = 0;
                        if (minutes > 120) this.value = 120;
                    });
                }
                
                if (interruptSecondsInput) {
                    interruptSecondsInput.addEventListener('change', function() {
                        const seconds = parseInt(this.value) || 0;
                        if (seconds < 0) this.value = 0;
                        if (seconds > 59) this.value = 59;
                    });
                }
                
                if (interruptReasonInput) {
                    interruptReasonInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter' && !isInterruptRunning) {
                            startInterrupt();
                        }
                    });
                }
                
                // å¿«é€Ÿæµ‹è¯•æŒ‰é’®
                if (quickTestButtons) {
                    quickTestButtons.forEach(button => {
                        button.addEventListener('click', function() {
                            const seconds = parseInt(this.dataset.seconds) || 5;
                            quickTestInterrupt(seconds);
                        });
                        addTouchFeedback(button);
                    });
                }
                
                // å£°éŸ³æ§åˆ¶
                if (volumeControl) {
                    volumeControl.addEventListener('input', function() {
                        volume = parseInt(this.value) / 100;
                        if (volumeValue) {
                            volumeValue.textContent = `${this.value}%`;
                        }
                        saveSettings();
                    });
                }
                
                // å£°éŸ³ç±»å‹é€‰æ‹©
                if (soundOptions) {
                    soundOptions.forEach(option => {
                        option.addEventListener('click', function() {
                            soundOptions.forEach(opt => opt.classList.remove('active'));
                            this.classList.add('active');
                            currentSoundType = this.dataset.sound;
                            saveSettings();
                            playClickSound('test');
                        });
                        addTouchFeedback(option);
                    });
                }
                
                // éœ‡åŠ¨å¼€å…³
                if (vibrationToggle) {
                    vibrationToggle.addEventListener('change', function() {
                        vibrationEnabled = this.checked;
                        saveSettings();
                        addLogEntry(`éœ‡åŠ¨åŠŸèƒ½å·²${vibrationEnabled ? 'å¼€å¯' : 'å…³é—­'}`, 'info', 'è®¾ç½®');
                    });
                }
                
                // ç‚¹å‡»éŸ³æ•ˆå¼€å…³
                if (clickSoundToggle) {
                    clickSoundToggle.addEventListener('change', function() {
                        clickSoundEnabled = this.checked;
                        saveSettings();
                        addLogEntry(`ç‚¹å‡»éŸ³æ•ˆå·²${clickSoundEnabled ? 'å¼€å¯' : 'å…³é—­'}`, 'info', 'è®¾ç½®');
                    });
                }
                
                // å£°éŸ³æµ‹è¯•æŒ‰é’®
                if (testSoundBtn) {
                    testSoundBtn.addEventListener('click', testSound);
                    addTouchFeedback(testSoundBtn);
                }
                
                if (testSoundBtn2) {
                    testSoundBtn2.addEventListener('click', testSound);
                    addTouchFeedback(testSoundBtn2);
                }
                
                if (stopSoundBtn) {
                    stopSoundBtn.addEventListener('click', stopAllSounds);
                    addTouchFeedback(stopSoundBtn);
                }
                
                // è®°å½•å’Œç»Ÿè®¡æŒ‰é’®
                if (exportRecordsBtn) {
                    exportRecordsBtn.addEventListener('click', exportRecords);
                    addTouchFeedback(exportRecordsBtn);
                }
                
                if (clearRecordsBtn) {
                    clearRecordsBtn.addEventListener('click', clearAllRecords);
                    addTouchFeedback(clearRecordsBtn);
                }
                
                if (clearHistoryBtn) {
                    clearHistoryBtn.addEventListener('click', clearHistory);
                    addTouchFeedback(clearHistoryBtn);
                }
                
                // æ—¥å¿—æ§åˆ¶æŒ‰é’®
                if (clearLogBtn) {
                    clearLogBtn.addEventListener('click', clearLogs);
                    addTouchFeedback(clearLogBtn);
                }
                
                if (toggleLogBtn) {
                    toggleLogBtn.addEventListener('click', toggleLogVisibility);
                    addTouchFeedback(toggleLogBtn);
                }
                
                // å…¨å±€ç”¨æˆ·äº¤äº’ç›‘å¬ï¼ˆç”¨äºæ¿€æ´»éŸ³é¢‘ï¼‰
                document.addEventListener('click', async function() {
                    if (!window.userInteracted) {
                        window.userInteracted = true;
                        const audioInitialized = await initAudioSystem();
                        if (audioInitialized) {
                            addLogEntry('ç”¨æˆ·äº¤äº’æ£€æµ‹ï¼ŒéŸ³é¢‘ç³»ç»Ÿå·²æ¿€æ´»', 'success', 'ç³»ç»Ÿ');
                            showStatus('âœ… éŸ³é¢‘ç³»ç»Ÿå·²æ¿€æ´»', 2000);
                        }
                    }
                }, { once: false, passive: true });
                
                // é”®ç›˜å¿«æ·é”®
                document.addEventListener('keydown', function(e) {
                    // ç©ºæ ¼é”®ï¼šå¼€å§‹/æš‚åœç•ªèŒ„é’Ÿ
                    if (e.code === 'Space' && !e.target.matches('input, textarea, button, select')) {
                        e.preventDefault();
                        if (isPomodoroRunning) {
                            pausePomodoro();
                        } else {
                            startPomodoro();
                        }
                    }
                    
                    // Escé”®ï¼šé‡ç½®ç•ªèŒ„é’Ÿ
                    if (e.code === 'Escape' && !e.target.matches('input, textarea, button, select')) {
                        e.preventDefault();
                        resetPomodoro();
                    }
                    
                    // Enteré”®ï¼šå½“ç„¦ç‚¹åœ¨ç•ªèŒ„é’Ÿåç§°è¾“å…¥æ¡†æ—¶å¼€å§‹è®¡æ—¶
                    if (e.code === 'Enter' && sessionNameInput && document.activeElement === sessionNameInput) {
                        e.preventDefault();
                        startPomodoro();
                    }
                    
                    // å¿«æ·é”®ï¼šCtrl+1 æµ‹è¯•å£°éŸ³
                    if (e.ctrlKey && e.code === 'Digit1') {
                        e.preventDefault();
                        testSound();
                    }
                });
                
                // çª—å£å¤±å»ç„¦ç‚¹å¤„ç†
                document.addEventListener('visibilitychange', function() {
                    if (document.visibilityState === 'hidden') {
                        addLogEntry('é¡µé¢åˆ‡æ¢è‡³åå°', 'info', 'ç³»ç»Ÿ');
                    } else {
                        addLogEntry('é¡µé¢æ¢å¤å‰å°', 'info', 'ç³»ç»Ÿ');
                    }
                });
                
                addLogEntry('æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨å·²åˆå§‹åŒ–', 'success', 'ç³»ç»Ÿ');
            } catch (error) {
                addLogEntry(`äº‹ä»¶ç›‘å¬å™¨åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error', 'ç³»ç»Ÿ');
            }
        }
        
        // åˆå§‹åŒ–åº”ç”¨
        async function initializeApp() {
            try {
                addLogEntry('ç•ªèŒ„é’Ÿè®¡æ—¶å™¨åˆå§‹åŒ–ä¸­...', 'info', 'ç³»ç»Ÿ');
                addLogEntry('ç‰ˆæœ¬: 6.3.0 | æ”¯æŒç•ªèŒ„é’Ÿå‘½ååŠŸèƒ½', 'info', 'ç³»ç»Ÿ');
                
                // æ£€æŸ¥å…¼å®¹æ€§
                checkCompatibility();
                
                // åˆå§‹åŒ–éŸ³é¢‘ç³»ç»Ÿ
                await initAudioSystem();
                
                // åŠ è½½ä¿å­˜çš„æ•°æ®
                loadSettings();
                loadRecords();
                loadHistory();
                
                // è®¾ç½®åˆå§‹çŠ¶æ€
                updateTimerDisplay(pomodoroSeconds);
                updatePomodoroStatus();
                updateDeviceStatus();
                
                // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
                initializeEventListeners();
                
                // æ·»åŠ åˆå§‹æ—¥å¿—
                addLogEntry('ç•ªèŒ„é’Ÿè®¡æ—¶å™¨åˆå§‹åŒ–å®Œæˆ', 'success', 'ç³»ç»Ÿ');
                addLogEntry('åŠŸèƒ½å·²å°±ç»ªï¼Œç‚¹å‡»ä»»æ„æŒ‰é’®å¼€å§‹', 'info', 'ç³»ç»Ÿ');
                
                // æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯
                setTimeout(() => {
                    showStatus('ğŸ… ç•ªèŒ„é’Ÿè®¡æ—¶å™¨å·²å‡†å¤‡å°±ç»ªï¼Œç‚¹å‡»"å¼€å§‹ä¸“æ³¨"å¼€å§‹æ‚¨çš„å·¥ä½œï¼', 5000);
                }, 1000);
                
            } catch (error) {
                addLogEntry(`åº”ç”¨åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error', 'ç³»ç»Ÿ');
                showStatus('âŒ åº”ç”¨åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 5000);
            }
        }
        
        // å¯åŠ¨åº”ç”¨
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
        
        // çª—å£å…³é—­å‰ä¿å­˜æ•°æ®
        window.addEventListener('beforeunload', function(e) {
            saveSettings();
            saveRecords();
            saveHistory();
            addLogEntry('é¡µé¢å…³é—­ï¼Œæ•°æ®å·²ä¿å­˜', 'info', 'ç³»ç»Ÿ');
        });
    </script>
</body>
</html>
